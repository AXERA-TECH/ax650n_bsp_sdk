(self["webpackChunkwebapp"]=self["webpackChunkwebapp"]||[]).push([[53],{4053:function(e,t,r){r(1703),r(7658),r(541),r(8675),r(3408),r(4590),r(3767),r(8585),r(8696),r(2087),function(t){e.exports=t()}((function(){return function(){function e(t,r,n){function i(a,s){if(!r[a]){if(!t[a]){var u=void 0;if(!s&&u)return require(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[a]={exports:{}};t[a][0].call(l.exports,(function(e){var r=t[a][1][e];return i(r||e)}),l,l.exports,e,t,r,n)}return r[a].exports}for(var o=void 0,a=0;a<n.length;a++)i(n[a]);return i}return e}()({1:[function(e,t,r){"use strict";var n,i="object"===typeof Reflect?Reflect:null,o=i&&"function"===typeof i.apply?i.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};function a(e){console&&console.warn&&console.warn(e)}n=i&&"function"===typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!==e};function u(){u.init.call(this)}t.exports=u,t.exports.once=_,u.EventEmitter=u,u.prototype._events=void 0,u.prototype._eventsCount=0,u.prototype._maxListeners=void 0;var c=10;function l(e){if("function"!==typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function f(e){return void 0===e._maxListeners?u.defaultMaxListeners:e._maxListeners}function d(e,t,r,n){var i,o,s;if(l(r),o=e._events,void 0===o?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),s=o[t]),void 0===s)s=o[t]=r,++e._eventsCount;else if("function"===typeof s?s=o[t]=n?[r,s]:[s,r]:n?s.unshift(r):s.push(r),i=f(e),i>0&&s.length>i&&!s.warned){s.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=s.length,a(u)}return e}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=h.bind(n);return i.listener=r,n.wrapFn=i,i}function y(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"===typeof i?r?[i.listener||i]:[i]:r?b(i):m(i,i.length)}function v(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"===typeof r)return 1;if(void 0!==r)return r.length}return 0}function m(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function g(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function b(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}function _(e,t){return new Promise((function(r,n){function i(r){e.removeListener(t,o),n(r)}function o(){"function"===typeof e.removeListener&&e.removeListener("error",i),r([].slice.call(arguments))}E(e,t,o,{once:!0}),"error"!==t&&w(e,i,{once:!0})}))}function w(e,t,r){"function"===typeof e.on&&E(e,"error",t,r)}function E(e,t,r,n){if("function"===typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!==typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(o){n.once&&e.removeEventListener(t,i),r(o)}))}}Object.defineProperty(u,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!==typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),u.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},u.prototype.setMaxListeners=function(e){if("number"!==typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},u.prototype.getMaxListeners=function(){return f(this)},u.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,i=this._events;if(void 0!==i)n=n&&void 0===i.error;else if(!n)return!1;if(n){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var u=i[e];if(void 0===u)return!1;if("function"===typeof u)o(u,this,t);else{var c=u.length,l=m(u,c);for(r=0;r<c;++r)o(l[r],this,t)}return!0},u.prototype.addListener=function(e,t){return d(this,e,t,!1)},u.prototype.on=u.prototype.addListener,u.prototype.prependListener=function(e,t){return d(this,e,t,!0)},u.prototype.once=function(e,t){return l(t),this.on(e,p(this,e,t)),this},u.prototype.prependOnceListener=function(e,t){return l(t),this.prependListener(e,p(this,e,t)),this},u.prototype.removeListener=function(e,t){var r,n,i,o,a;if(l(t),n=this._events,void 0===n)return this;if(r=n[e],void 0===r)return this;if(r===t||r.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!==typeof r){for(i=-1,o=r.length-1;o>=0;o--)if(r[o]===t||r[o].listener===t){a=r[o].listener,i=o;break}if(i<0)return this;0===i?r.shift():g(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,a||t)}return this},u.prototype.off=u.prototype.removeListener,u.prototype.removeAllListeners=function(e){var t,r,n;if(r=this._events,void 0===r)return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,o=Object.keys(r);for(n=0;n<o.length;++n)i=o[n],"removeListener"!==i&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=r[e],"function"===typeof t)this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},u.prototype.listeners=function(e){return y(this,e,!0)},u.prototype.rawListeners=function(e){return y(this,e,!1)},u.listenerCount=function(e,t){return"function"===typeof e.listenerCount?e.listenerCount(t):v.call(e,t)},u.prototype.listenerCount=v,u.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},{}],2:[function(e,t,r){var n,i,o=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function u(t){if(n===setTimeout)return setTimeout(t,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}function c(t){if(i===clearTimeout)return clearTimeout(t);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{return i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(function(){try{n="function"===typeof setTimeout?setTimeout:a}catch(e){n=a}try{i="function"===typeof clearTimeout?clearTimeout:s}catch(e){i=s}})();var l,f=[],d=!1,h=-1;function p(){d&&l&&(d=!1,l.length?f=l.concat(f):h=-1,f.length&&y())}function y(){if(!d){var e=u(p);d=!0;var t=f.length;while(t){l=f,f=[];while(++h<t)l&&l[h].run();h=-1,t=f.length}l=null,d=!1,c(e)}}function v(e,t){this.fun=e,this.array=t}function m(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];f.push(new v(e,t)),1!==f.length||d||u(y)},v.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=m,o.addListener=m,o.once=m,o.off=m,o.removeListener=m,o.removeAllListeners=m,o.emit=m,o.prependListener=m,o.prependOnceListener=m,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],3:[function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,s(n.key),n)}}function a(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e){var t=u(e,"string");return"symbol"===n(t)?t:String(t)}function u(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!==n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var c=function(){function e(t){i(this,e),this.remuxer=t,this.track=t.mp4track}return a(e,[{key:"extractAAC",value:function(t){var r,n,i=0,o=t.byteLength,a=[];if(!e.isAACPattern(t))return a;r=e.getHeaderLength(t),this.aacHeader||(this.aacHeader=t.subarray(0,r));while(i<o)n=e.getFrameLength(t),a.push(t.subarray(r,n)),t=t.slice(n),i+=n;return a}},{key:"setAACConfig",value:function(t){var r,n,i,o=new Uint8Array(2),a=this.aacHeader;a&&(r=1+((192&a[2])>>>6),n=e.getSampleRateIndex(t),i=(1&a[2])<<2,i|=(192&a[3])>>>6,o[0]=r<<3,o[0]|=(14&n)>>1,o[1]|=(1&n)<<7,o[1]|=i<<3,this.track.codec="mp4a.40."+r,this.track.channelCount=i,this.track.config=o,this.track.duration=1024/t*this.track.timescale,this.track.audioSampleRate=t)}}],[{key:"samplingRateMap",get:function(){return[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350]}},{key:"getHeaderLength",value:function(e){return 1&e[1]?7:9}},{key:"getSampleRateIndex",value:function(t){for(var r=e.samplingRateMap,n=0;n<r.length;++n)if(r[n]===t)return n;return n}},{key:"getFrameLength",value:function(e){return(3&e[3])<<11|e[4]<<3|(224&e[5])>>>5}},{key:"isAACPattern",value:function(e){return 255===e[0]&&240===(240&e[1])&&0===(6&e[1])}},{key:"appendByteArray",value:function(e,t){var r=new Uint8Array((0|e.byteLength)+(0|t.byteLength));return r.set(e,0),r.set(t,0|e.byteLength),r}},{key:"parseAACConfig",value:function(t,r){if(!e.isAACPattern(t))return null;var n,i,o,a=e.getHeaderLength(t),s=t.subarray(0,a),u=new Uint8Array(2),c=s;n=1+((192&c[2])>>>6),i=e.getSampleRateIndex(r),o=(1&c[2])<<2,o|=(192&c[3])>>>6,u[0]=n<<3,u[0]|=(14&i)>>1,u[1]|=(1&i)<<7,u[1]|=o<<3;var l={headerLength:a,sampleRate:r,channelCount:o,config:u};return l}}]),e}(),l=c;r.default=l},{}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=i(e("./aac-parser.js"));function i(e){return e&&e.__esModule?e:{default:e}}function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,c(n.key),n)}}function u(e,t,r){return t&&s(e.prototype,t),r&&s(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function c(e){var t=l(e,"string");return"symbol"===o(t)?t:String(t)}function l(e,t){if("object"!==o(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var f=function(){function e(t,r){a(this,e),this.readyToDecode=!1,this.nextDts=0,this.dts=0,this.mp4track={id:2,type:"audio",channelCount:0,len:0,fragmented:!0,timescale:r,duration:0,samples:[],config:"",codec:""},this.wfs=t,this.samples=[],this.aacParser=new n.default(this)}return u(e,[{key:"resetTrack",value:function(){this.readyToDecode=!1,this.mp4track.codec="",this.mp4track.channelCount="",this.mp4track.config="",this.mp4track.timescale=this.timescale,this.nextDts=0,this.dts=0,this.samples=[]}},{key:"resetSamples",value:function(){this.mp4track.len=0,this.samples=[]}},{key:"remux",value:function(e){if(e.length>0){this.readyToDecode||(this.aacParser.setAACConfig(this.wfs.audioInfo.sampleRate),this.readyToDecode=!0);for(var t=0;t<e.length;t++){var r=e[t],n=r.units,i=n.byteLength;this.samples.push({units:n,size:i,duration:this.mp4track.duration}),this.mp4track.len+=i}}}},{key:"getPayload",value:function(){if(0==this.mp4track.len)return null;var e,t=new Uint8Array(this.mp4track.len),r=0,n=this.mp4track.samples;this.dts=this.nextDts;while(this.samples.length){var i=this.samples.shift(),o=i.duration;o<=0?this.mp4track.len-=i.size:(this.nextDts+=o,e={size:i.size,duration:o,cts:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},t.set(i.units,r),r+=i.size,n.push(e))}return n.length?new Uint8Array(t.buffer,0,this.mp4track.len):null}},{key:"getAacParser",value:function(){return this.aacParser}}]),e}(),d=f;r.default=d},{"./aac-parser.js":3}],5:[function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,s(n.key),n)}}function a(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e){var t=u(e,"string");return"symbol"===n(t)?t:String(t)}function u(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!==n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var c=function(){function t(e){i(this,t),this.sourceBuffer=e,this.type="audio",this.appending=!1,this.onsbue=this.onSBUpdateEnd.bind(this),this.sourceBuffer.addEventListener("updateend",this.onsbue),this.segments=[]}return a(t,[{key:"appendBuffer",value:function(e){this.segments.push(e),this.doAppending()}},{key:"onSBUpdateEnd",value:function(e){this.appending=!1,this.doAppending()}},{key:"doAppending",value:function(){var t=this.sourceBuffer,r=this.segments;if(!this.appending&&r&&r.length){var n=r.shift();try{t&&(t.appendBuffer(n.data),this.appendError=0,this.appended++,this.appending=!0)}catch(e){}}}}]),t}(),l=c;r.default=l},{}],6:[function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=u(e("../events")),o=u(e("../event-handler")),a=u(e("./aac-remuxer")),s=u(e("../remux/mp4-generator"));u(e("./aac-parser"));function u(e){return e&&e.__esModule?e:{default:e}}function c(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=l(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function l(e,t){if(e){if("string"===typeof e)return f(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(e,t):void 0}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,y(n.key),n)}}function p(e,t,r){return t&&h(e.prototype,t),r&&h(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function y(e){var t=v(e,"string");return"symbol"===n(t)?t:String(t)}function v(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!==n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function m(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&g(e,t)}function g(e,t){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},g(e,t)}function b(e){var t=E();return function(){var r,n=A(e);if(t){var i=A(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _(this,r)}}function _(e,t){if(t&&("object"===n(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return w(e)}function w(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function E(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function A(e){return A=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},A(e)}var S=function(e){m(r,e);var t=b(r);function r(e){var n;d(this,r),n=t.call(this,e,i.default.AUDIO_DATA_PARSING,i.default.AUDIO_DATA_REMUXER),n.observer=n.wfs,n.readyToDecode=!1,n.timescale=n.wfs.config.timescale;var o=new a.default(e,n.timescale);return n.aacParser=o.getAacParser(),n.audioRemuxer=o,n.lastPTS=0,n}return p(r,[{key:"destroy",value:function(){o.default.prototype.destroy.call(this)}},{key:"onAudioDataParsing",value:function(e){var t=(e.pts-this.lastPTS)/1e3*this.timescale;(this.lastPTS=0)&&(t=500);var r=this.audioRemuxer;this.wfs.config.videoReady||r.resetSamples(),r.mp4track.duration=t,this.lastPTS=e.pts;var n=this.aacParser.extractAAC(e.data);if(n.length>0){var i=this.getAudioFrames(n,t);r.remux(i)}this.onAudioDataRemuxer(null)}},{key:"onAudioDataRemuxer",value:function(e){var t=this.audioRemuxer;if(this.wfs.config.videoReady){var r=t.getPayload();if(r&&(this.readyToDecode||this.initSegment(),r.byteLength)){var n=s.default.moof(this.seq++,t.dts,t.mp4track),o=s.default.mdat(r),a={type:"audio",data1:n,data2:o};this.observer.trigger(i.default.FRAG_PARSING_DATA,a),t.mp4track.samples=[],t.mp4track.len=0}}}},{key:"getAudioFrames",value:function e(t,r){var n,i=[],o=c(t);try{for(o.s();!(n=o.n()).done;){var a=n.value;i.push({units:a})}}catch(e){o.e(e)}finally{o.f()}return i.map((function(e){e.duration=r})),i}},{key:"initSegment",value:function(){var e=this.audioRemuxer,t={};t.audio={initSegment:s.default.initSegment([e.mp4track])},this.observer.trigger(i.default.FRAG_PARSING_INIT_SEGMENT,{tracks:t}),this.readyToDecode=!0}}]),r}(o.default),T=S;r.default=T},{"../event-handler":13,"../events":14,"../remux/mp4-generator":23,"./aac-parser":3,"./aac-remuxer":4}],7:[function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=e("../errors"),o=c(e("../events")),a=c(e("../event-handler")),s=c(e("./audio-demuxer")),u=c(e("../utils/libfaac"));function c(e){return e&&e.__esModule?e:{default:e}}function l(){l=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(t){c=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var o=t&&t.prototype instanceof p?t:p,a=Object.create(o.prototype),s=new R(n||[]);return i(a,"_invoke",{value:A(e,r,s)}),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=f;var h={};function p(){}function y(){}function v(){}var m={};c(m,a,(function(){return this}));var g=Object.getPrototypeOf,b=g&&g(g(P([])));b&&b!==t&&r.call(b,a)&&(m=b);var _=v.prototype=p.prototype=Object.create(m);function w(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){function o(i,a,s,u){var c=d(e[i],e,a);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==n(f)&&r.call(f,"__await")?t.resolve(f.__await).then((function(e){o("next",e,s,u)}),(function(e){o("throw",e,s,u)})):t.resolve(f).then((function(e){l.value=e,s(l)}),(function(e){return o("throw",e,s,u)}))}u(c.arg)}var a;i(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){o(e,r,t,n)}))}return a=a?a.then(n,n):n()}})}function A(e,t,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return O()}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=S(a,r);if(s){if(s===h)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=d(e,t,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===h)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function S(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),h;var i=d(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,h;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function R(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function P(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:O}}function O(){return{value:void 0,done:!0}}return y.prototype=v,i(_,"constructor",{value:v,configurable:!0}),i(v,"constructor",{value:y,configurable:!0}),y.displayName=c(v,u,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,c(e,u,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},w(E.prototype),c(E.prototype,s,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,i,o){void 0===o&&(o=Promise);var a=new E(f(t,r,n,i),o);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},w(_),c(_,u,"Generator"),c(_,a,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=P,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,h):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),k(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;k(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:P(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},e}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,p(n.key),n)}}function h(e,t,r){return t&&d(e.prototype,t),r&&d(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function p(e){var t=y(e,"string");return"symbol"===n(t)?t:String(t)}function y(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!==n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function v(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&m(e,t)}function m(e,t){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},m(e,t)}function g(e){var t=w();return function(){var r,n=E(e);if(t){var i=E(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return b(this,r)}}function b(e,t){if(t&&("object"===n(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _(e)}function _(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function w(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function E(e){return E=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},E(e)}function A(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}function S(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){A(o,n,i,a,s,"next",e)}function s(e){A(o,n,i,a,s,"throw",e)}a(void 0)}))}}var T=null;function k(){return R.apply(this,arguments)}function R(){return R=S(l().mark((function e(){return l().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,u.default)().then((function(e){T=e}));case 2:case"end":return e.stop()}}),e)}))),R.apply(this,arguments)}var P=function(e){v(r,e);var t=g(r);function r(e){var n;return f(this,r),n=t.call(this,e),n.audioDemuxer=new s.default(n.wfs),n.pcmModuleOpened=!1,n.mediaCode=0,n.audioInfo=n.wfs.audioInfo,n.isForceClosed=!1,n}return h(r,[{key:"destroy",value:function(){console.log("AudioLoader.destroy +++"),this.isForceClosed=!0,this.unload(),this.client&&this.client.close(),a.default.prototype.destroy.call(this.audioDemuxer),a.default.prototype.destroy.call(this),console.log("AudioLoader.destroy ---")}},{key:"onWSAttaching",value:function(e){switch(console.log("onAudioWSAttaching:",this.audioInfo.mediaType),this.isForceClosed=!1,this.audioInfo.mediaType){case"g711a":k(),this.mediaCode=1;break;case"g711u":k(),this.mediaCode=2;break;case"lpcm":k(),this.mediaCode=3;break;case"aac":default:this.mediaCode=0;break}e.websocket instanceof WebSocket&&(this.client=e.websocket,this.client.onopen=this.initSocketClient.bind(this),this.client.onclose=this.closeSocketClient.bind(this),this.client.onerror=this.errorSocketClient.bind(this))}},{key:"errorSocketClient",value:function(e){this.unload(),console.log("Audio webSocket error: ",e)}},{key:"closeSocketClient",value:function(e){this.unload(),console.log("Audio websocket closed: ",e)}},{key:"initSocketClient",value:function(e){this.loaded(),console.log("Audio  websocket Open!")}},{key:"pcm_2_aac",value:function(t){var r=new Uint8Array(t);if(!r||!r.byteLength)return console.log("pcm_2_aac input null!"),null;var n=T._malloc(r.byteLength);if(!n)return console.log("faacModule._malloc failed!"),null;try{T.HEAPU8.set(r,n);var a=T._pcm_2_aac(n,r.byteLength),s=T._getByteLen(),u=Uint8Array.from(T.HEAPU8.subarray(a,a+s));return T._free(n),T._free_buf(a),u}catch(e){this.unload(),console.log("faacModule _pcm_2_aac failed!");var c={type:i.ErrorTypes.MEDIA_ERROR};c.details=i.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,c.fatal=!0,this.wfs.trigger(o.default.ERROR,c)}return u}},{key:"receiveSocketMessage",value:function(e){if(!this.isForceClosed){if(1===this.mediaCode||2===this.mediaCode||3===this.mediaCode){if(!T)return;if(!this.pcmModuleOpened){var t=this.mediaCode-1;console.log("faacModule._turn_on_encoder"),T._turn_on_encoder(this.audioInfo.numChannels,this.audioInfo.sampleRate,t,this.audioInfo.bitWidth),this.pcmModuleOpened=!0}}this.buf=null;var r=new Uint8Array(e.data),n=new DataView(r.buffer),i=1414092865,a=16,s=n.getUint32(0,!0),u=n.getUint32(4,!0);if(s==i&&u+a===n.byteLength){var c=Number(n.getBigUint64(8,!0)/BigInt(1e3)),l=r.subarray(a);l&&l.byteLength&&(this.pcmModuleOpened?this.buf=new Uint8Array(this.pcm_2_aac(l)):this.buf=new Uint8Array(l),r=null,l=null,this.wfs.trigger(o.default.AUDIO_DATA_PARSING,{data:this.buf,pts:c}),this.wfs.trigger(o.default.AAC_DATA_APPENDING,{data:this.buf,pts:c}))}}}},{key:"closeWS",value:function(){this.client&&this.client.close(),this.client=null}},{key:"loaded",value:function(){this.client.binaryType="arraybuffer",this.client.onmessage=this.receiveSocketMessage.bind(this),this.audioInfo.client=this.client}},{key:"unload",value:function(){this.client=null,this.audioInfo.client=this.client}}]),r}(a.default),O=P;r.default=O},{"../errors":12,"../event-handler":13,"../events":14,"../utils/libfaac":25,"./audio-demuxer":6}],8:[function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=e("../errors"),o=l(e("../events")),a=l(e("../event-handler")),s=l(e("../utils/mp4-encoder")),u=l(e("../audio/aac-parser")),c=l(e("../audio/audio-buffer"));function l(e){return e&&e.__esModule?e:{default:e}}function f(){f=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(t){c=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var o=t&&t.prototype instanceof p?t:p,a=Object.create(o.prototype),s=new R(n||[]);return i(a,"_invoke",{value:A(e,r,s)}),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var h={};function p(){}function y(){}function v(){}var m={};c(m,a,(function(){return this}));var g=Object.getPrototypeOf,b=g&&g(g(P([])));b&&b!==t&&r.call(b,a)&&(m=b);var _=v.prototype=p.prototype=Object.create(m);function w(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){function o(i,a,s,u){var c=d(e[i],e,a);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==n(f)&&r.call(f,"__await")?t.resolve(f.__await).then((function(e){o("next",e,s,u)}),(function(e){o("throw",e,s,u)})):t.resolve(f).then((function(e){l.value=e,s(l)}),(function(e){return o("throw",e,s,u)}))}u(c.arg)}var a;i(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){o(e,r,t,n)}))}return a=a?a.then(n,n):n()}})}function A(e,t,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return O()}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=S(a,r);if(s){if(s===h)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=d(e,t,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===h)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function S(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),h;var i=d(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,h;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function R(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function P(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:O}}function O(){return{value:void 0,done:!0}}return y.prototype=v,i(_,"constructor",{value:v,configurable:!0}),i(v,"constructor",{value:y,configurable:!0}),y.displayName=c(v,u,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,c(e,u,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},w(E.prototype),c(E.prototype,s,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,i,o){void 0===o&&(o=Promise);var a=new E(l(t,r,n,i),o);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},w(_),c(_,u,"Generator"),c(_,a,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=P,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,h):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),k(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;k(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:P(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},e}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,y(n.key),n)}}function p(e,t,r){return t&&h(e.prototype,t),r&&h(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function y(e){var t=v(e,"string");return"symbol"===n(t)?t:String(t)}function v(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!==n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function m(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&g(e,t)}function g(e,t){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},g(e,t)}function b(e){var t=E();return function(){var r,n=A(e);if(t){var i=A(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _(this,r)}}function _(e,t){if(t&&("object"===n(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return w(e)}function w(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function E(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function A(e){return A=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},A(e)}function S(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}function T(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){S(o,n,i,a,s,"next",e)}function s(e){S(o,n,i,a,s,"throw",e)}a(void 0)}))}}var k=null;function R(){return P.apply(this,arguments)}function P(){return P=T(f().mark((function e(){return f().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,s.default)().then((function(e){k=e}));case 2:case"end":return e.stop()}}),e)}))),P.apply(this,arguments)}var O=function(e){m(r,e);var t=b(r);function r(e){var n;return d(this,r),n=t.call(this,e,o.default.MEDIA_ATTACHING,o.default.BUFFER_APPENDING,o.default.BUFFER_RESET,o.default.RECORDING_START,o.default.RECORDING_STOP,o.default.H264_DATA_APPENDING,o.default.AAC_DATA_APPENDING,o.default.PLAYER_SEEK_NOW),n.config=n.wfs.config,n.rec_threshold_total=17179869184,n.rec_threshold_single=1073741824,n.rec_timer=void 0,n.rec_file="",n.rec_result_cb=void 0,n.rec_state_cb=void 0,n.mediaElement=void 0,n.mediaSource=void 0,n.mediaSize=0,n.sourceBuffers={},n.segments=[],n.h264Frames=[],n.aacFrames=[],n.aac_config=null,n.mp4Encoder=void 0,n.appended=0,n.mediaErrorCount=0,n.count=0,n.onsbue=n.onSBUpdateEnd.bind(w(n)),n.browserType=0,n.mediaType="",n.websocketName=void 0,n._fs=null,n.track_info={width:0,height:0},n.last_pts={audio:0,video:0},R(),n.mp4BlobBuffer=[],n.needSeek=!0,window.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&n.onPlayerSeekNow()})),n}return p(r,[{key:"destroy",value:function(){a.default.prototype.destroy.call(this)}},{key:"pad2",value:function(e){return e<10?"0"+e:e}},{key:"onRecordingProc",value:function(){var e=this;if(null==e._fs)return e.rec_result_cb&&e.rec_result_cb(!1),void console.log("fs is not authorized");e.rec_timer&&(clearInterval(e.rec_timer),e.rec_timer=void 0),e.count=0,e.rec_timer=setInterval((function(){if(e.appended>10){clearInterval(e.rec_timer),e.rec_timer=void 0;var t=new Date,r=1900+t.getYear()+"-"+e.pad2(t.getMonth()+1)+"-"+e.pad2(t.getDate())+"_"+e.pad2(t.getHours())+"-"+e.pad2(t.getMinutes())+"-"+e.pad2(t.getSeconds());e.rec_file="ax_"+r+".mp4",console.log("MediaRecorder started: "+e.rec_file),e.mediaSize=0,e.config.recording=!0,e.rec_result_cb&&e.rec_result_cb(!0)}else e.count++;e.count>=10&&(clearInterval(e.rec_timer),e.rec_timer=void 0,e.rec_result_cb&&e.rec_result_cb(!1))}),1e3)}},{key:"onRecordingStart",value:function(e){if(this.config.recording)console.log("recording is in progress");else{void 0!=e&&(this.rec_threshold_single=e.rec_file_threshold,this.rec_result_cb=e.result_cb,this.rec_state_cb=e.state_cb),this.last_pts={audio:0,video:0};var t=this;navigator.webkitPersistentStorage.queryUsageAndQuota((function(e,r){""==r?t.requestFs():window.webkitRequestFileSystem(window.PERSISTENT,t.rec_threshold_total,(function(e){t._fs=e,e.root.getDirectory("ax_video",{create:!0},(function(e){console.log("Directory: "+e.name+" fs requested"),t.onRecordingProc()}),t.errorHandler)}))}),this.errorHandler)}}},{key:"onRecordingStop",value:function(){this.config.recording=!1,this.rec_timer&&(clearInterval(this.rec_timer),this.rec_timer=void 0),this.saveToMP4Blob(),this.h264Frames=[],this.aacFrames=[]}},{key:"errorHandler",value:function(e){var t="An error occured(errcd): ";console.log(t+e.code)}},{key:"requestFs",value:function(){var e=this;navigator.webkitPersistentStorage.requestQuota(this.rec_threshold_total,(function(t){t<1?e.rec_result_cb&&e.rec_result_cb(!1):window.webkitRequestFileSystem(window.PERSISTENT,t,(function(t){e._fs=t,t.root.getDirectory("ax_video",{create:!0},(function(t){console.log("Directory: "+t.name+" exists or just created."),e.onRecordingProc()}),e.errorHandler)}))}))}},{key:"onMediaAttaching",value:function(e){this.mediaElement=e.media.video,void 0===this.mediaElement&&(this.mediaElement=e.media);var t=this.mediaElement;if(this.mediaType=e.mediaType,this.websocketName=e.websocketName,console.log("onMediaAttaching: mediaType="+this.mediaType),t){var r=this.mediaSource=new MediaSource;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),r.addEventListener("sourceopen",this.onmso),r.addEventListener("sourceended",this.onmse),r.addEventListener("sourceclose",this.onmsc),t.renderingBufferHint="none",t.src=URL.createObjectURL(r)}}},{key:"onMediaDetaching",value:function(){}},{key:"onH264DataAppending",value:function(e){if(this.config.recording&&e.data){var t=this;t.h264Frames.push(e),t.mediaSize+=e.data.length,t.mediaSize>=t.rec_threshold_single&&(t.rec_state_cb&&t.rec_state_cb(!1),t.onRecordingStop(),t.onRecordingStart(),t.rec_state_cb&&t.rec_state_cb(!0)),this.mp4Encoder||"video"!=this.config.mode||this.createMp4Encoder(),this.encodeToMp4File()}}},{key:"onAACDataAppending",value:function(e){if(this.config.recording&&e.data){var t=this;t.aacFrames.push(e),t.mediaSize+=e.data.length,this.mp4Encoder||this.createMp4Encoder(),t.mediaSize>=t.rec_threshold_single&&(t.rec_state_cb&&t.rec_state_cb(!1),t.onRecordingStop(),t.onRecordingStart(),t.rec_state_cb&&t.rec_state_cb(!0)),this.encodeToMp4File()}}},{key:"createMp4Encoder",value:function(){var e=this.config.fps;0===e&&(e=30);var t="H265Raw"===this.mediaType,r=this.track_info.width,n=this.track_info.height,i=0,o=null;this.aacFrames.length>0&&(this.aac_track=u.default.parseAACConfig(this.aacFrames[0].data,this.wfs.audioInfo.sampleRate),i=this.aac_track.channelCount,this.aac_track.sampleRate=this.wfs.audioInfo.sampleRate,o=this.aac_track.config,this.aac_track.duration=1024/this.aac_track.sampleRate*this.config.timescale),this.mp4Encoder=k.createEncoder({width:r,height:n,fps:e,hevc:t,audio_channel_count:i},o)}},{key:"encodeToMp4File",value:function(){if(this.mp4Encoder){var e=this.config.timescale,t=this.last_pts.video;while(this.h264Frames.length){var r=this.h264Frames.shift(),n=(r.pts-t)*e/1e3;0==t&&(n=500),this.mp4Encoder.addNalu(r.data,n),t=r.pts}this.last_pts.video=t;var i=this.last_pts.audio;while(this.aacFrames.length){var o=this.aacFrames.shift(),a=(o.pts-i)*e/1e3;0==i&&(a=500);var s=this.aac_track.headerLength,c=o.data,l=u.default.getFrameLength(c);this.mp4Encoder.addAAC(c.subarray(s,l),a),i=o.pts}this.last_pts.audio=i}}},{key:"saveToMP4Blob",value:function(){var e=new Blob([this.mp4Encoder.end()]);this.writeMP4Data(e),this.mp4Encoder=null}},{key:"writeMP4Data",value:function(e){var t=this;t._fs.root.getFile("ax_video/"+t.rec_file,{create:!0},(function(r){r.createWriter((function(t){t.onwriteend=function(e){},t.onerror=function(e){console.log("Write rec data failed: "+e.toString())},t.seek(t.length),t.write(e)}),t.errorHandler)}),t.errorHandler)}},{key:"onBufferAppending",value:function(e){"audio"!=e.type?(this.segments.push(e),this.doAppending()):this.audioBuffer.appendBuffer(e)}},{key:"onMediaSourceClose",value:function(){console.log("media source closed")}},{key:"onMediaSourceEnded",value:function(){console.log("media source ended")}},{key:"onSBUpdateEnd",value:function(e){this.appending=!1,this.doAppending(),this.needSeek&&(this.mediaElement.play(),this.needSeek=!1)}},{key:"onMediaSourceOpen",value:function(){console.log("media source open"),this.wfs.trigger(o.default.MEDIA_ATTACHED,{media:this.media,mediaType:this.mediaType,websocketName:this.websocketName})}},{key:"onBufferReset",value:function(e){this.createSourceBuffers({type:e.type,mimeType:e.mimeType}),this.track_info.width=e.width,this.track_info.height=e.height}},{key:"createSourceBuffers",value:function e(t){var r=this.sourceBuffers,n=this.mediaSource,i="video/mp4;codecs="+t.mimeType;try{var a=r[t.type]=n.addSourceBuffer(i);if(a.addEventListener("updateend",this.onsbue),"both"===this.config.mode){i='audio/mp4; codecs="'+this.config.audioCodecs+'"';var s=n.addSourceBuffer(i);this.audioBuffer=new c.default(s),this.config.videoReady=!0,this.wfs.trigger(o.default.AUDIO_DATA_REMUXER,null)}}catch(e){console.log("AddSourceBuffer failed, errcode: "+e.code+" err message: "+e.message)}this.mediaElement.play()}},{key:"onPlayerSeekNow",value:function(){if(this.mediaElement&&this.mediaElement.buffered){var e=this.mediaElement.buffered.end(0);this.mediaElement.currentTime=e}}},{key:"doAppending",value:function e(){var t=this.wfs,r=this.sourceBuffers,n=this.segments;if(Object.keys(r).length){if(this.mediaElement.error){if(this.segments=[],this.mediaErrorCount++,this.mediaErrorCount<100)console.log("doAppending although a media error occured, error code:",this.mediaElement.error.code,"message:",this.mediaElement.error.message);else{var a={type:i.ErrorTypes.MEDIA_ERROR};a.details=i.ErrorDetails.BUFFER_APPEND_ERROR,a.frag=this.fragCurrent,a.fatal=!0,this.wfs.trigger(o.default.ERROR,a)}return}if(this.mediaErrorCount=0,this.appending)return;if(n&&n.length){var s=n.shift();try{r[s.type]&&(r[s.type].appendBuffer(s.data),this.appendError=0,this.appended++,this.appending=!0,s.data=null)}catch(e){n.unshift(s),console.log("errcode: "+e.code+" err message: "+e.message);var u={type:i.ErrorTypes.MEDIA_ERROR};22!==e.code?(this.appendError++,u.details=i.ErrorDetails.BUFFER_APPEND_ERROR,u.frag=this.fragCurrent,this.appendError>t.config.appendErrorMaxRetry?(n=[],u.fatal=!0):u.fatal=!1):(this.segments=[],u.details=i.ErrorDetails.BUFFER_FULL_ERROR,u.fatal=!0),this.wfs.trigger(o.default.ERROR,u)}}}}}]),r}(a.default),L=O;r.default=L},{"../audio/aac-parser":3,"../audio/audio-buffer":5,"../errors":12,"../event-handler":13,"../events":14,"../utils/mp4-encoder":27}],9:[function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=a(e("../events")),o=a(e("../event-handler"));function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,l(n.key),n)}}function c(e,t,r){return t&&u(e.prototype,t),r&&u(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function l(e){var t=f(e,"string");return"symbol"===n(t)?t:String(t)}function f(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!==n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function d(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}function h(e,t){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},h(e,t)}function p(e){var t=m();return function(){var r,n=g(e);if(t){var i=g(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return y(this,r)}}function y(e,t){if(t&&("object"===n(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return v(e)}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function g(e){return g=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},g(e)}var b=function(e){d(r,e);var t=p(r);function r(e){return s(this,r),t.call(this,e,i.default.MEDIA_ATTACHED,i.default.WEBSOCKET_ATTACHED,i.default.FRAG_PARSING_DATA,i.default.FRAG_PARSING_INIT_SEGMENT)}return c(r,[{key:"destroy",value:function(){o.default.prototype.destroy.call(this)}},{key:"onMediaAttached",value:function(e){if(console.log("media attached"),void 0!=e.websocketName){var t="ws://"+window.location.host+"/"+e.websocketName,r="binary";console.log("websocket: ",t);var n=new WebSocket(t,r),i={};if("both"===this.wfs.config.mode&&this.wfs.audioInfo){var o="ws://"+window.location.host+"/"+this.wfs.audioInfo.websocketName;i.websocket=new WebSocket(o,r),i.mediaType=this.wfs.audioInfo.mediaType}else this.wfs.config.mode="video",i=void 0;this.wfs.attachWebsocket(n,i)}else console.log("websocketName ERROE!!!")}},{key:"onFragParsingInitSegment",value:function(e){var t,r=e.tracks;for(t in r){var n=r[t],o=n.initSegment;o&&this.wfs.trigger(i.default.BUFFER_APPENDING,{type:t,data:o})}}},{key:"onFragParsingData",value:function(e){var t=this;[e.data1,e.data2].forEach((function(r){r&&t.wfs.trigger(i.default.BUFFER_APPENDING,{type:e.type,data:r})}))}}]),r}(o.default),_=b;r.default=_},{"../event-handler":13,"../events":14}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("../utils/logger");function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,u(n.key),n)}}function s(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function u(e){var t=c(e,"string");return"symbol"===i(t)?t:String(t)}function c(e,t){if("object"!==i(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var l=function(){function e(t){o(this,e),this.data=t,this.bytesAvailable=this.data.byteLength,this.word=0,this.bitsAvailable=0}return s(e,[{key:"loadWord",value:function(){var e=this.data.byteLength-this.bytesAvailable,t=new Uint8Array(4),r=Math.min(4,this.bytesAvailable);if(0===r)throw new Error("no bytes available");t.set(this.data.subarray(e,e+r)),this.word=new DataView(t.buffer).getUint32(0),this.bitsAvailable=8*r,this.bytesAvailable-=r}},{key:"skipBits",value:function(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}},{key:"readBits",value:function(e){var t=Math.min(this.bitsAvailable,e),r=this.word>>>32-t;return e>32&&n.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),t=e-t,t>0?r<<t|this.readBits(t):r}},{key:"skipLZ",value:function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!==(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}},{key:"skipScalingList",value:function(e){var t,r,n=8,i=8;for(t=0;t<e;t++)0!==i&&(r=this.readEG(),i=(n+r+256)%256),n=0===i?n:i}},{key:"readSPS",value:function(){var e,t,r,n,i,o,a,s=0,u=0,c=0,l=0,f=1;if(this.readUByte(),e=this.readUByte(),this.readBits(5),this.skipBits(3),this.readUByte(),this.skipUEG(),100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e){var d=this.readUEG();if(3===d&&this.skipBits(1),this.skipUEG(),this.skipUEG(),this.skipBits(1),this.readBoolean())for(o=3!==d?8:12,a=0;a<o;a++)this.readBoolean()&&(a<6?this.skipScalingList(16):this.skipScalingList(64))}this.skipUEG();var h=this.readUEG();if(0===h)this.readUEG();else if(1===h)for(this.skipBits(1),this.skipEG(),this.skipEG(),t=this.readUEG(),a=0;a<t;a++)this.skipEG();if(this.skipUEG(),this.skipBits(1),r=this.readUEG(),n=this.readUEG(),i=this.readBits(1),0===i&&this.skipBits(1),this.skipBits(1),this.readBoolean()&&(s=this.readUEG(),u=this.readUEG(),c=this.readUEG(),l=this.readUEG()),this.readBoolean()&&this.readBoolean()){var p,y=this.readUByte();switch(y){case 1:p=[1,1];break;case 2:p=[12,11];break;case 3:p=[10,11];break;case 4:p=[16,11];break;case 5:p=[40,33];break;case 6:p=[24,11];break;case 7:p=[20,11];break;case 8:p=[32,11];break;case 9:p=[80,33];break;case 10:p=[18,11];break;case 11:p=[15,11];break;case 12:p=[64,33];break;case 13:p=[160,99];break;case 14:p=[4,3];break;case 15:p=[3,2];break;case 16:p=[2,1];break;case 255:p=[this.readUByte()<<8|this.readUByte(),this.readUByte()<<8|this.readUByte()];break}p&&(f=p[0]/p[1])}return{width:Math.ceil((16*(r+1)-2*s-2*u)*f),height:(2-i)*(n+1)*16-(i?2:4)*(c+l)}}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),e}(),f=l;r.default=f},{"../utils/logger":26}],11:[function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=u(e("../events")),o=u(e("./exp-golomb")),a=u(e("../event-handler")),s=u(e("../remux/mp4-remuxer"));function u(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,d(n.key),n)}}function f(e,t,r){return t&&l(e.prototype,t),r&&l(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function d(e){var t=h(e,"string");return"symbol"===n(t)?t:String(t)}function h(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!==n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function p(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&y(e,t)}function y(e,t){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},y(e,t)}function v(e){var t=b();return function(){var r,n=_(e);if(t){var i=_(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return m(this,r)}}function m(e,t){if(t&&("object"===n(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return g(e)}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function b(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _(e){return _=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},_(e)}var w=function(e){p(r,e);var t=v(r);function r(e){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return c(this,r),n=t.call(this,e,i.default.H264_DATA_PARSING),n.config=n.wfs.config||o,n.wfs=e,n.id="main",n.remuxer=new s.default(n.wfs,n.id,n.config),n.contiguous=!0,n.timeOffset=1,n.sn=0,n.timestamp=0,n.H264_TIMEBASE=n.config.mp4Duration,n._avcTrack={container:"video/mp4",type:"video",id:1,sequenceNumber:0,samples:[],len:0,nbNalu:0,dropped:0,count:0},n.browserType=0,n}return f(r,[{key:"destroy",value:function(){a.default.prototype.destroy.call(this)}},{key:"getTimestampM",value:function(){return this.timestamp+=this.H264_TIMEBASE,this.timestamp}},{key:"onH264DataParsing",value:function(e){var t=this.getTimestampM();"both"===this.config.mode&&(t=e.pts),this._parseAVCTrack(e.data,t),this.remuxer.pushVideo(0,this.sn,this._avcTrack,this.timeOffset,this.contiguous),this.sn+=1,e.data=null}},{key:"_parseAVCTrack",value:function(e,t){var r,n,a,s,u=this,c=this._avcTrack,l=c.samples,f=this._parseAVCNALu(e),d=[],h=!1,p=!1,y=0,v="",m=function(){if(d.length){if(!this.config.forceKeyFrameOnDiscontinuity||!0===p||c.sps&&(l.length||this.contiguous)){var e=t;n={units:{units:d,length:y},pts:e,dts:e,key:p},l.push(n),c.len+=y,c.nbNalu+=d.length}else c.dropped++;d=[],y=0}}.bind(this);f.forEach((function(e){switch(e.type){case 1:a=!0,h&&(v+="NDR ");break;case 5:a=!0,h&&(v+="IDR "),p=!0;break;case 6:e.data=u.discardEPB(e.data),r=new o.default(e.data),r.readUByte();break;case 7:if(a=!1,h&&(v+="SPS "),!c.sps){r=new o.default(e.data);var t=r.readSPS();c.width=t.width,c.height=t.height,c.sps=[e.data],c.duration=0;var n=e.data.subarray(1,4),l="avc1.";for(s=0;s<3;s++){var f=n[s].toString(16);f.length<2&&(f="0"+f),l+=f}c.codec=l,u.wfs.trigger(i.default.BUFFER_RESET,{type:"video",mimeType:c.codec,width:c.width,height:c.height}),a=!0}break;case 8:a=!1,h&&(v+="PPS "),c.pps||(c.pps=[e.data],a=!0);break;case 9:a=!1,h&&(v+="AUD "),m();break;default:a=!1,v+="unknown NAL "+e.type+" ";break}a&&(d.push(e),y+=e.data.byteLength)})),h&&v.length&&console.log(v),m()}},{key:"_parseAVCNALu",value:function(e){var t,r,n,i,o,a=0,s=e.byteLength,u=0,c=[];while(a<s)switch(t=e[a++],u){case 0:0===t&&(u=1);break;case 1:u=0===t?2:0;break;case 2:case 3:0===t?u=3:1===t&&a<s?(n=31&e[a],i&&(r={data:e.subarray(i,a-u-1),type:o},c.push(r)),i=a,o=n,u=0):u=0;break;default:break}return i&&(r={data:e.subarray(i,s),type:o,state:u},c.push(r)),c}},{key:"discardEPB",value:function(e){var t,r,n=e.byteLength,i=[],o=1;while(o<n-2)0===e[o]&&0===e[o+1]&&3===e[o+2]?(i.push(o+2),o+=2):o++;if(0===i.length)return e;t=n-i.length,r=new Uint8Array(t);var a=0;for(o=0;o<t;a++,o++)a===i[0]&&(a++,i.shift()),r[o]=e[a];return r}}]),r}(a.default),E=w;r.default=E},{"../event-handler":13,"../events":14,"../remux/mp4-remuxer":24,"./exp-golomb":10}],12:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ErrorTypes=r.ErrorDetails=void 0;var n={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",OTHER_ERROR:"otherError"};r.ErrorTypes=n;var i={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",INTERNAL_EXCEPTION:"internalException",NETWORK_RECV_DATA_TIMEOUT:"networkRecvDataTimeout"};r.ErrorDetails=i},{}],13:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;n(e("./events"));function n(e){return e&&e.__esModule?e:{default:e}}function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,u(n.key),n)}}function s(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function u(e){var t=c(e,"string");return"symbol"===i(t)?t:String(t)}function c(e,t){if("object"!==i(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var l=function(){function e(t){o(this,e),this.wfs=t,this.onEvent=this.onEvent.bind(this);for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];this.handledEvents=n,this.useGenericHandler=!0,this.registerListeners()}return s(e,[{key:"destroy",value:function(){this.unregisterListeners()}},{key:"isEventHandler",value:function(){return"object"===i(this.handledEvents)&&this.handledEvents.length&&"function"===typeof this.onEvent}},{key:"registerListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.wfs.on(e,this.onEvent)}.bind(this))}},{key:"unregisterListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.wfs.off(e,this.onEvent)}.bind(this))}},{key:"onEvent",value:function(e,t){this.onEventGeneric(e,t)}},{key:"onEventGeneric",value:function e(t,r){var n=function(e,t){var r="on"+e.replace("wfs","");return this[r],this[r].bind(this,t)};try{n.call(this,t,r).call()}catch(e){console.log("internal error happened while processing ".concat(t,":").concat(e.message))}}}]),e}(),f=l;r.default=f},{"./events":14}],14:[function(e,t,r){"use strict";t.exports={MEDIA_ATTACHING:"wfsMediaAttaching",MEDIA_ATTACHED:"wfsMediaAttached",FRAG_LOADING:"wfsFragLoading",BUFFER_CREATED:"wfsBufferCreated",BUFFER_APPENDING:"wfsBufferAppending",BUFFER_RESET:"wfsBufferReset",BUFFER_CLEAR:"wfsBufferClear",FRAG_PARSING_DATA:"wfsFragParsingData",FRAG_PARSING_INIT_SEGMENT:"wfsFragParsingInitSegment",H264_DATA_APPENDING:"wfsH264DataAppending",AAC_DATA_APPENDING:"wfsAACDataAppending",H264_DATA_PARSING:"wfsH264DataParsing",AUDIO_DATA_PARSING:"wfsAudioDataParsing",AUDIO_DATA_REMUXER:"wfsAudioDataRemuxer",H265_DATA_APPENDING:"wfsH265DataAppending",H265_DATA_PARSING:"wfsH265DataParsing",WEBSOCKET_ATTACHED:"wfsWebsocketAttached",WEBSOCKET_ATTACHING:"wfsWebsocketAttaching",WEBSOCKET_DATA_UPLOADING:"wfsWebsocketDataUploading",FILE_HEAD_LOADING:"wfsFileHeadLoading",FILE_HEAD_LOADED:"wfsFileHeadLoaded",FILE_DATA_LOADING:"wfsFileDataLoading",FILE_DATA_LOADED:"wfsFileDataLoaded",FILE_PARSING_DATA:"wfsFileParsingData",RECORDING_START:"wfsRecordingStart",PLAYER_SEEK_NOW:"wfsPlayerSeekNow",RECORDING_STOP:"wfsRecordingStop",IMAGE_PLAYER_RENDER_END:"wfsImagePlayerRenderEnd",IMAGE_PLAYER_WAIT:"wfsImagePlayerWait",IMAGE_PLAYER_READY:"wfsImagePlayerReady",IMAGE_PLAYER_END:"wfsImagePlayerEnd",IMAGE_PLAYER_BUFFER_UPDATE:"wfsImagePlayerBufferUpdate",PLAYER_PLAY:"wfsPlayerPlay",PLAYER_RESET:"wfsPlayerReset",PLAYER_LOADED_META_DATA:"wfsPlayerRoadedMetaData",ERROR:"wfsError"}},{}],15:[function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,s(n.key),n)}}function a(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e){var t=u(e,"string");return"symbol"===n(t)?t:String(t)}function u(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!==n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var c=function(){function e(t){i(this,e),this._buffer=t,this._buffer_index=0,this._total_bytes=t.byteLength,this._current_word=0,this._current_word_bits_left=0}return a(e,[{key:"destroy",value:function(){this._buffer=null}},{key:"_fillCurrentWord",value:function(){var e=this._total_bytes-this._buffer_index;if(!(e<=0)){var t=Math.min(4,e),r=new Uint8Array(4);r.set(this._buffer.subarray(this._buffer_index,this._buffer_index+t)),this._current_word=new DataView(r.buffer).getUint32(0,!1),this._buffer_index+=t,this._current_word_bits_left=8*t}}},{key:"readBits",value:function(e){if(e>32)return null;if(e<=this._current_word_bits_left){var t=this._current_word>>>32-e;return this._current_word<<=e,this._current_word_bits_left-=e,t}var r=this._current_word_bits_left?this._current_word:0;r>>>=32-this._current_word_bits_left;var n=e-this._current_word_bits_left;this._fillCurrentWord();var i=Math.min(n,this._current_word_bits_left),o=this._current_word>>>32-i;return this._current_word<<=i,this._current_word_bits_left-=i,r=r<<i|o,r}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readByte",value:function(){return this.readBits(8)}},{key:"_skipLeadingZero",value:function(){var e;for(e=0;e<this._current_word_bits_left;e++)if(0!==(this._current_word&2147483648>>>e))return this._current_word<<=e,this._current_word_bits_left-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()}},{key:"readUEG",value:function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1}},{key:"readSEG",value:function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)}}]),e}(),l=c;r.default=l},{}],16:[function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,s(n.key),n)}}function a(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e){var t=u(e,"string");return"symbol"===n(t)?t:String(t)}function u(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!==n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var c=function(){function e(){i(this,e)}return a(e,null,[{key:"init",value:function(){for(var t in e.types={hvc1:[],hvcC:[],avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],pasp:[],".mp3":[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var r=e.constants={};r.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),r.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),r.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),r.STSC=r.STCO=r.STTS,r.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),r.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),r.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),r.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}},{key:"box",value:function(e){for(var t=8,r=null,n=Array.prototype.slice.call(arguments,1),i=n.length,o=0;o<i;o++)t+=n[o].byteLength;r=new Uint8Array(t),r[0]=t>>>24&255,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r.set(e,4);var a=8;for(o=0;o<i;o++)r.set(n[o],a),a+=n[o].byteLength;return r}},{key:"moov",value:function(t){var r=e.mvhd(t.timescale,t.duration),n=e.trak(t),i=e.mvex(t);return e.box(e.types.moov,r,n,i)}},{key:"mvhd",value:function(t,r){return e.box(e.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,r>>>24&255,r>>>16&255,r>>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))}},{key:"trak",value:function(t){return e.box(e.types.trak,e.tkhd(t),e.mdia(t))}},{key:"tkhd",value:function(t){var r=t.id,n=t.duration,i=t.presentWidth,o=t.presentHeight;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r,0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>>8&255,255&i,0,0,o>>>8&255,255&o,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t),e.hdlr(t),e.minf(t))}},{key:"mdhd",value:function(t){var r=t.timescale,n=t.duration;return e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r,n>>>24&255,n>>>16&255,n>>>8&255,255&n,85,196,0,0]))}},{key:"hdlr",value:function(t){var r=null;return r="audio"===t.type?e.constants.HDLR_AUDIO:e.constants.HDLR_VIDEO,e.box(e.types.hdlr,r)}},{key:"minf",value:function(t){var r=null;return r="audio"===t.type?e.box(e.types.smhd,e.constants.SMHD):e.box(e.types.vmhd,e.constants.VMHD),e.box(e.types.minf,r,e.dinf(),e.stbl(t))}},{key:"dinf",value:function(){var t=e.box(e.types.dinf,e.box(e.types.dref,e.constants.DREF));return t}},{key:"stbl",value:function(t){var r=e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.constants.STTS),e.box(e.types.stsc,e.constants.STSC),e.box(e.types.stsz,e.constants.STSZ),e.box(e.types.stco,e.constants.STCO));return r}},{key:"stsd",value:function(t){return"audio"===t.type?"mp3"===t.codec?e.box(e.types.stsd,e.constants.STSD_PREFIX,e.mp3(t)):e.box(e.types.stsd,e.constants.STSD_PREFIX,e.mp4a(t)):e.box(e.types.stsd,e.constants.STSD_PREFIX,e.avc1(t))}},{key:"mp3",value:function(t){var r=t.channelCount,n=t.audioSampleRate,i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r,0,16,0,0,0,0,n>>>8&255,255&n,0,0]);return e.box(e.types[".mp3"],i)}},{key:"mp4a",value:function(t){var r=t.channelCount,n=t.audioSampleRate,i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r,0,16,0,0,0,0,n>>>8&255,255&n,0,0]);return e.box(e.types.mp4a,i,e.esds(t))}},{key:"esds",value:function(t){var r=t.config||[],n=r.length,i=new Uint8Array([0,0,0,0,3,23+n,0,1,0,4,15+n,64,0,0,0,0,0,0,0,0,0,0,0,5].concat([n]).concat(r).concat([6,1,2]));return e.box(e.types.esds,i)}},{key:"avc1",value:function(t){var r=t.avcc,n=t.codecWidth,i=t.codecHeight,o=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,n>>>8&255,255&n,i>>>8&255,255&i,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return t.codec.indexOf("avc1")>=0?e.box(e.types.avc1,o,e.box(e.types.avcC,r)):e.box(e.types.hvc1,o,e.box(e.types.hvcC,r))}},{key:"mvex",value:function(t){return e.box(e.types.mvex,e.trex(t))}},{key:"trex",value:function(t){var r=t.id,n=new Uint8Array([0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return e.box(e.types.trex,n)}},{key:"moof",value:function(t,r){return e.box(e.types.moof,e.mfhd(t.sequenceNumber),e.traf(t,r))}},{key:"mfhd",value:function(t){var r=new Uint8Array([0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t]);return e.box(e.types.mfhd,r)}},{key:"traf",value:function(t,r){var n=t.id,i=e.box(e.types.tfhd,new Uint8Array([0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n])),o=e.box(e.types.tfdt,new Uint8Array([0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r])),a=e.sdtp(t),s=e.trun(t,a.byteLength+16+16+8+16+8+8);return e.box(e.types.traf,i,o,s,a)}},{key:"sdtp",value:function(t){for(var r=t.samples||[],n=r.length,i=new Uint8Array(4+n),o=0;o<n;o++){var a=r[o].flags;i[o+4]=a.isLeading<<6|a.dependsOn<<4|a.isDependedOn<<2|a.hasRedundancy}return e.box(e.types.sdtp,i)}},{key:"trun",value:function(t,r){var n=t.samples||[],i=n.length,o=12+16*i,a=new Uint8Array(o);r+=8+o,a.set([0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,255&i,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0);for(var s=0;s<i;s++){var u=n[s].duration,c=n[s].size,l=n[s].flags,f=n[s].cts;a.set([u>>>24&255,u>>>16&255,u>>>8&255,255&u,c>>>24&255,c>>>16&255,c>>>8&255,255&c,l.isLeading<<2|l.dependsOn,l.isDependedOn<<6|l.hasRedundancy<<4|l.isNonSync,0,0,f>>>24&255,f>>>16&255,f>>>8&255,255&f],12+16*s)}return e.box(e.types.trun,a)}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}},{key:"initSegment",value:function(t){e.types||e.init();var r=e.box(e.types.ftyp,e.constants.FTYP),n=e.moov(t),i=new Uint8Array(r.byteLength+n.byteLength);return i.set(r,0),i.set(n,r.byteLength),i}}]),e}(),l=c;r.default=l},{}],17:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("../events")),i=s(e("../event-handler")),o=s(e("./hevc-spsparser")),a=s(e("./h265-remuxer"));function s(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}function c(e,t){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},c(e,t)}function l(e){var t=h();return function(){var r,n=p(e);if(t){var i=p(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return f(this,r)}}function f(e,t){if(t&&("object"===y(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return d(e)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function p(e){return p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},p(e)}function y(e){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y(e)}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,b(n.key),n)}}function g(e,t,r){return t&&m(e.prototype,t),r&&m(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function b(e){var t=_(e,"string");return"symbol"===y(t)?t:String(t)}function _(e,t){if("object"!==y(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==y(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var w=function(){function e(t){v(this,e),this._buffer=t,this._buffer_index=0}return g(e,[{key:"destroy",value:function(){this._buffer=null}},{key:"w8",value:function(e){this._buffer[this._buffer_index++]=e}},{key:"wb16",value:function(e){this.w8(e>>8&255),this.w8(255&e)}},{key:"wb32",value:function(e){this.w8(e>>24&255),this.w8(e>>16&255),this.w8(e>>8&255),this.w8(255&e)}}]),e}(),E=function(e){u(r,e);var t=l(r);function r(e){var i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return v(this,r),i=t.call(this,e,n.default.H265_DATA_PARSING),i.config=i.wfs.config||o,i.wfs=e,i.id="main",i.remuxer=new a.default(i.wfs,i.id,i.config),i.sn=0,i.timestamp=0,i.H265_TIMEBASE=i.config.mp4Duration,i._avcTrack={container:"video/mp4",type:"video",id:1,sequenceNumber:0,samples:[],len:0,nbNalu:0,dropped:0,count:0,meta:{}},i.browserType=0,-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&(i.browserType=1),i.avccReady=!1,i}return g(r,[{key:"destroy",value:function(){i.default.prototype.destroy.call(this)}},{key:"getTimestampM",value:function(){return this.timestamp+=this.H265_TIMEBASE,this.timestamp}},{key:"onH265DataParsing",value:function(e){this._parseAVCTrack(e.data,e.pts);var t=this._avcTrack;if(!this.avccReady&&t.sps){var r=t.meta,n=32,i=33,o=34,a=this.packet_nalu(n,t.vps[0]),s=this.packet_nalu(i,t.sps[0]),u=this.packet_nalu(o,t.pps[0]),c=new Uint8Array(r.avcc.byteLength+a.byteLength+s.byteLength+u.byteLength),l=0;c.set(r.avcc,l),l=r.avcc.byteLength,c.set(a,l),l+=a.byteLength,c.set(s,l),l+=s.byteLength,c.set(u,l),r.avcc=c,this.avccReady=!0}this.remuxer.pushVideo(this.sn,this._avcTrack)}},{key:"packet_nalu",value:function(e,t){var r=new Uint8Array(5),n=new w(r),i=0,o=e,a=1;n.w8(i<<7|63&o),n.wb16(a),n.wb16(t.byteLength);var s=new Uint8Array(t.byteLength+r.byteLength);return s.set(r),s.set(t,r.byteLength),s}},{key:"_parseAVCTrack",value:function(e,t){var r,i=this,a=this._avcTrack,s=a.samples,u=this._parseAVCNALu(e),c=[],l=!1,f=0,d=!1,h=function(){if(c.length){if(!this.config.forceKeyFrameOnDiscontinuity||!0===l||a.sps){var e=this.getTimestampM();"both"===this.config.mode&&(e=t),r={units:{units:c,length:f},pts:e,dts:e,key:l},s.push(r),a.len+=f,a.nbNalu+=c.length}c=[],f=0}}.bind(this);u.forEach((function(e){switch(e.type){case 1:d=!0;break;case 32:a.vps||(a.vps=[e.data]);break;case 33:if(d=!1,!a.sps){var t=new o.default,r=t.parseSPS(e.data),s={type:"video"};s.id=a.id,s.duration=0,s.codecWidth=r.codec_size.width,s.codecHeight=r.codec_size.height,s.presentWidth=r.present_size.width,s.presentHeight=r.present_size.height,s.profile=r.profile_string,s.level=r.level_string,s.profile_idc=r.profile_idc,s.level_idc=r.level_idc,s.bitDepth=r.bit_depth,s.chromaFormat=r.chroma_format,s.sarRatio=r.sar_ratio,s.frameRate=r.frame_rate;var u="hvc1."+s.profile_idc+".1.L"+s.level_idc+".B0";s.codec=u,s.avcc=i._generalAvccData(r.avcc),a.width=r.codec_size.width,a.height=r.codec_size.height,a.sps=[e.data],a.duration=s.duration,a.codec=u,a.meta=s,i.wfs.trigger(n.default.BUFFER_RESET,{type:"video",mimeType:a.codec,width:a.width,height:a.height}),d=!0}break;case 34:d=!1,a.pps||(a.pps=[e.data]);break;default:e.data&&e.type>=16&&e.type<=23&&(d=!0,l=!0);break}d&&a.sps&&(c.push(e),f+=e.data.byteLength)})),h()}},{key:"_parseAVCNALu",value:function(e){var t,r,n,i,o,a=0,s=e.byteLength,u=0,c=[];while(a<s)switch(t=e[a++],u){case 0:0===t&&(u=1);break;case 1:u=0===t?2:0;break;case 2:case 3:0===t?u=3:1===t&&a<s?(n=(126&e[a])>>>1,i&&(r={data:e.subarray(i,a-u-1),type:o},c.push(r)),i=a,o=n,u=0):u=0;break;default:break}return i&&(r={data:e.subarray(i,s),type:o,state:u},c.push(r)),c}},{key:"_generalAvccData",value:function(e){var t=new Uint8Array(23),r=new w(t);return r.w8(e.configurationVersion),r.w8(e.profile_space<<6|e.tier_flag<<5|e.profile_idc),r.wb32(e.profile_compatibility_flags),r.wb32(e.constraint_indicator_flags>>16),r.wb16(e.constraint_indicator_flags),r.w8(e.level_idc),r.wb16(61440|e.min_spatial_segmentation_idc),r.w8(252|e.parallelismType),r.w8(252|e.chromaFormat),r.w8(248|e.bitDepthLumaMinus8),r.w8(248|e.bitDepthChromaMinus8),r.wb16(e.avgFrameRate),r.w8(e.constantFrameRate<<6|e.numTemporalLayers<<3|e.temporalIdNested<<2|e.lengthSizeMinusOne),r.w8(e.numOfArrays),t}}]),r}(i.default),A=E;r.default=A},{"../event-handler":13,"../events":14,"./h265-remuxer":18,"./hevc-spsparser":19}],18:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=o(e("../events")),i=o(e("./fmp4-generator"));function o(e){return e&&e.__esModule?e:{default:e}}function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,l(n.key),n)}}function c(e,t,r){return t&&u(e.prototype,t),r&&u(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function l(e){var t=f(e,"string");return"symbol"===a(t)?t:String(t)}function f(e,t){if("object"!==a(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}e("../utils/polyfill");var d=function(){function e(t,r,n){s(this,e),this.observer=t,this.id=r,this.config=n,this.ISGenerated=!1,this.PES_TIMESCALE=this.config.timescale,this.nextAvcDts=this.PES_TIMESCALE+300,this.H264_TIMEBASE=this.config.mp4Duration,this.lastDTS=0,this.baseDecodeTime=0}return c(e,[{key:"passthrough",get:function(){return!1}},{key:"destroy",value:function(){}},{key:"insertDiscontinuity",value:function(){this._initPTS=this._initDTS=void 0}},{key:"pushVideo",value:function(e,t){this.sn=e,this.ISGenerated||this.generateVideoIS(t),this.ISGenerated&&("both"===this.config.mode?this.remuxVideoWithAudio(t):this.remuxVideo(t))}},{key:"remuxVideoWithAudio",value:function(e){var t,r,o=8,a=e.samples,s=[];t=new Uint8Array(e.len+4*e.nbNalu+8);var u=new DataView(t.buffer);u.setUint32(0,t.byteLength),t.set(i.default.types.mdat,4);for(var c=0,l=0;l<a.length;l++){var f=a[l],d=0;while(f.units.units.length){var h=f.units.units.shift();u.setUint32(o,h.data.byteLength),o+=4,t.set(h.data,o),o+=h.data.byteLength,d+=4+h.data.byteLength}var p=(f.dts-this.lastDTS)/1e3*this.PES_TIMESCALE;0==this.lastDTS&&(p=500),c+=p,s.push({size:d,duration:p,cts:0,flags:{isLeading:0,hasRedundancy:0,degradPrio:0,dependsOn:f.key?2:1,isDependedOn:f.key?1:0,isNonSync:f.key?0:1}}),this.lastDTS=f.dts}e.len=0,e.samples=s,r=i.default.moof(e,this.baseDecodeTime),e.sequenceNumber++,this.baseDecodeTime+=c,e.samples=[];var y={data1:r,data2:t,type:"video"};return this.observer.trigger(n.default.FRAG_PARSING_DATA,y),y}},{key:"remuxVideo",value:function(e){var t,r,o=8,a=e.samples,s=[];if(!(a.length<1)){t=new Uint8Array(e.len+4*e.nbNalu+8);var u=new DataView(t.buffer);u.setUint32(0,t.byteLength),t.set(i.default.types.mdat,4);for(var c,l,f,d=0,h=0;h<a.length;h++){var p=a[h],y=0;while(p.units.units.length){var v=p.units.units.shift();u.setUint32(o,v.data.byteLength),o+=4,t.set(v.data,o),o+=v.data.byteLength,y+=4+v.data.byteLength}var m=p.pts-this._initPTS,g=p.dts-this._initDTS;if(g=Math.min(m,g),void 0!==f)c=this._PTSNormalize(m,f),l=this._PTSNormalize(g,f),d=l-f,d<=0&&(d=1);else{var b,_=this.nextAvcDts;c=this._PTSNormalize(m,_),l=this._PTSNormalize(g,_),_&&(b=Math.round(l-_),Math.abs(b)<600&&b&&(l=_,c=Math.max(c-b,l))),this.firstPTS=Math.max(0,c),this.firstDTS=Math.max(0,l),d=.03}s.push({size:y,duration:this.H264_TIMEBASE,cts:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:p.key?2:1,isNonSync:p.key?0:1}}),f=l}var w=0;if(s.length>=2&&(w=s[s.length-2].duration,s[0].duration=w),this.nextAvcDts=l+w,e.len=0,e.nbNalu=0,e.dropped=0,s.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var E=s[0].flags;E.dependsOn=2,E.isNonSync=0}e.samples=s,r=i.default.moof(e,l),e.sequenceNumber++,e.samples=[];var A={data1:r,data2:t,type:"video"};return this.observer.trigger(n.default.FRAG_PARSING_DATA,A),A}}},{key:"generateVideoIS",value:function(e){var t,r,o=this.observer,a=e.samples,s={},u={id:this.id,tracks:s},c=void 0===this._initPTS;c&&(t=r=1/0),e.sps&&a.length&&(e.meta.timescale=this.PES_TIMESCALE,s.video={type:"video",container:"video/mp4",initSegment:i.default.initSegment(e.meta),metadata:{width:e.width,height:e.height}},c&&(t=Math.min(t,a[0].pts-this.H264_TIMEBASE),r=Math.min(r,a[0].dts-this.H264_TIMEBASE))),Object.keys(s).length&&(o.trigger(n.default.FRAG_PARSING_INIT_SEGMENT,u),this.ISGenerated=!0,c&&(this._initPTS=t,this._initDTS=r))}},{key:"_PTSNormalize",value:function(e,t){var r;if(void 0===t)return e;r=t<e?-8589934592:8589934592;while(Math.abs(e-t)>4294967296)e+=r;return e}}]),e}(),h=d;r.default=h},{"../events":14,"../utils/polyfill":28,"./fmp4-generator":16}],19:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=i(e("./exp-golomb"));function i(e){return e&&e.__esModule?e:{default:e}}function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,c(n.key),n)}}function u(e,t,r){return t&&s(e.prototype,t),r&&s(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function c(e){var t=l(e,"string");return"symbol"===o(t)?t:String(t)}function l(e,t){if("object"!==o(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var f=function(){function e(){a(this,e)}return u(e,[{key:"_ebsp2rbsp",value:function(e){for(var t=e,r=t.byteLength,n=new Uint8Array(r),i=0,o=0;o<r;o++)o>=2&&3===t[o]&&0===t[o-1]&&0===t[o-2]||(n[i]=t[o],i++);return new Uint8Array(n.buffer,0,i)}},{key:"parseSPS",value:function(e){var t=this._ebsp2rbsp(e),r=new n.default(t),i={},o={configurationVersion:1,lengthSizeMinusOne:3,numOfArrays:3};r.readBits(16),r.readBits(4);var a=r.readBits(3);o.numTemporalLayers=a+1,o.temporalIdNested=r.readBits(1),this._hvcc_parse_ptl(r,i,o,a),r.readUEG();var s=0,u=r.readUEG();3==u&&(s=r.readBits(1)),i.sar_width=i.sar_height=1,i.conf_win_left_offset=i.conf_win_right_offset=i.conf_win_top_offset=i.conf_win_bottom_offset=0,i.def_disp_win_left_offset=i.def_disp_win_right_offset=i.def_disp_win_top_offset=i.def_disp_win_bottom_offset=0;var c=r.readUEG(),l=r.readUEG();o.parallelismType=1,o.bitDepthLumaMinus8=0;var f=r.readBits(1);f&&(i.conf_win_left_offset=r.readUEG(),i.conf_win_right_offset=r.readUEG(),i.conf_win_top_offset=r.readUEG(),i.conf_win_bottom_offset=r.readUEG(),1===i.default_display_window_flag&&(i.conf_win_left_offset+i.def_disp_win_left_offset,i.conf_win_right_offset+i.def_disp_win_right_offset,i.conf_win_top_offset+i.def_disp_win_top_offset,i.conf_win_bottom_offset,i.def_disp_win_bottom_offset));var d=r.readUEG()+8;o.bitDepthLumaMinus8=d-8,o.bitDepthChromaMinus8=r.readUEG(),o.min_spatial_segmentation_idc=0;for(var h=r.readUEG(),p=r.readBits(1)?0:a;p<=a;p++)this._skip_sub_layer_ordering_info(r);r.readUEG(),r.readUEG(),r.readUEG(),r.readUEG(),r.readUEG(),r.readUEG(),r.readBits(1)&&r.readBits(1)&&this._skip_scaling_list_data(r),r.readBits(1),r.readBits(1),r.readBits(1)&&(r.readBits(4),r.readBits(4),r.readUEG(),r.readUEG(),r.readBits(1));var y=[],v=r.readUEG();for(p=0;p<v;p++){var m=this._parse_rps(r,p,v,y);if(m<0)return m}if(r.readBits(1)){var g=r.readUEG();for(p=0;p<g;p++){var b=Math.min(h+4,16);if(b>32){for(var _=b/32,w=b%32,E=0;E<_;E++)r.readBits(32);r.readBits(w)}else r.readBits(b);r.readBits(1)}}var A=1;r.readBits(1),r.readBits(1),r.readBits(1)&&this._hvcc_parse_vui(r,i,o,a);var S=this.getProfileString(i.profile_idc),T=this.getLevelString(i.level_idc),k=1;1===i.sar_width&&1===i.sar_height||(k=i.sar_width/i.sar_height);var R=c,P=l,O=1!==u&&2!=u||0!==s?1:2,L=1===u&&0===s?2:1;R-=O*(i.conf_win_left_offset+i.conf_win_right_offset),P-=L*(i.conf_win_top_offset+i.conf_win_bottom_offset);var x=Math.ceil(R*k);return r.destroy(),r=null,o.chromaFormat=u,o.avgFrameRate=i.fps,o.constantFrameRate=i.fps,o.numOfArrays=3,o.profile_space=0,{profile_string:S,level_string:T,profile_idc:i.profile_idc,level_idc:i.level_idc,bit_depth:d,ref_frames:A,chroma_format:u,chroma_format_string:this.getChromaFormatString(u),frame_rate:{fixed:i.fps_fixed,fps:i.fps,fps_den:i.fps_den,fps_num:i.fps_num},sar_ratio:{width:i.sar_width,height:i.sar_height},codec_size:{width:R,height:P},present_size:{width:x,height:P},avcc:o}}},{key:"_hvcc_parse_ptl",value:function(e,t,r,n){e.readBits(2);var i=e.readBits(1);r.tier_flag=i;var o=e.readBits(5);r.profile_compatibility_flags=e.readBits(32),r.constraint_indicator_flags=e.readBits(32),e.readBits(16);var a=e.readByte();void 0===t.tier_flag||void 0===t.level_idc||t.tier_flag<i?t.level_idc=a:t.level_idc=Math.max(t.level_idc,a),r.level_idc=t.level_idc,t.profile_idc=Math.max(void 0===t.profile_idc?0:t.profile_idc,o),r.profile_idc=t.profile_idc;for(var s=[],u=[],c=0;c<n;c++)s.push(e.readBits(1)),u.push(e.readBits(1));if(n>0)for(c=n;c<8;c++)e.readBits(2);for(c=0;c<n;c++)s[c]&&(e.readBits(32),e.readBits(32),e.readBits(24)),u[c]&&e.readByte()}},{key:"_parse_rps",value:function(e,t,r,n){if(t&&e.readBits(1)){if(t>=r)return-1;e.readBits(1),e.readUEG(),n[t]=0;for(var i=0;i<=n[t-1];i++){var o=0,a=e.readBits(1);a||(o=e.readBits(1)),(a||o)&&n[t]++}}else{var s=e.readUEG(),u=e.readUEG();n[t]=s+u;for(i=0;i<s;i++)e.readUEG(),e.readBits(1);for(i=0;i<u;i++)e.readUEG(),e.readBits(1)}return 0}},{key:"_hvcc_parse_vui",value:function(e,t,r,n){e.readBits(1)&&255==e.readByte()&&(t.sar_width=e.readBits(16),t.sar_height=e.readBits(16)),e.readBits(1)&&e.readBits(1),e.readBits(1)&&(e.readBits(4),e.readBits(1)&&e.readBits(24)),e.readBits(1)&&(e.readUEG(),e.readUEG()),e.readBits(3),t.default_display_window_flag=e.readBits(1),t.default_display_window_flag&&(t.def_disp_win_left_offset=e.readUEG(),t.def_disp_win_right_offset=e.readUEG(),t.def_disp_win_top_offset=e.readUEG(),t.def_disp_win_bottom_offset=e.readUEG()),e.readBits(1)&&(this._skip_timing_info(e,t),e.readBits(1)&&this._skip_hrd_parameters(e,t,1,n)),e.readBits(1)&&(e.readBits(3),r.min_spatial_segmentation_idc=e.readUEG(),e.readUEG(),e.readUEG(),e.readUEG(),e.readUEG())}},{key:"_skip_sub_layer_ordering_info",value:function(e,t){e.readUEG(),e.readUEG(),e.readUEG()}},{key:"_skip_scaling_list_data",value:function(e){for(var t=0;t<4;t++)for(var r=0;r<(3==t?2:6);r++)if(e.readBits(1)){var n=Math.min(64,1<<4+(t<<1));t>1&&e.readSEG();for(var i=0;i<n;i++)e.readSEG()}else e.readUEG()}},{key:"_skip_sub_layer_hrd_parameters",value:function(e,t,r){for(var n=0;n<=t;n++)e.readUEG(),e.readUEG(),r&&(e.readUEG(),e.readUEG()),e.readBits(1)}},{key:"_skip_timing_info",value:function(e,t){t.fps_den=e.readBits(32),t.fps_num=e.readBits(32),t.fps_den>0&&(t.fps=t.fps_num/t.fps_den);var r=0;e.readBits(1)&&(r=e.readUEG(),r>=0&&(t.fps/=r+1))}},{key:"_skip_hrd_parameters",value:function(e,t,r){var n=0,i=0,o=0;if(t&&(i=e.readBits(1),o=e.readBits(1),i||o)){var a=e.readBits(1);a&&e.readBits(19),e.readByte(),a&&e.readBits(4),e.readBits(15)}for(var s=0;s<=r;s++){var u=0,c=0,l=0,f=e.readBits(1);hvcc.fps_fixed=f,f||(l=e.readBits(1)),l?e.readUEG():c=e.readBits(1),c||(u=e.readUEG(e)),i&&this._skip_sub_layer_hrd_parameters(e,u,n),o&&this._skip_sub_layer_hrd_parameters(e,u,n)}}},{key:"getProfileString",value:function(e){switch(e){case 1:return"Main";case 2:return"Main10";case 3:return"MainSP";case 4:return"Rext";case 9:return"SCC";default:return"Unknown"}}},{key:"getLevelString",value:function(e){return(e/30).toFixed(1)}},{key:"getChromaFormatString",value:function(e){switch(e){case 0:return"4:0:0";case 1:return"4:2:0";case 2:return"4:2:2";case 3:return"4:4:4";default:return"Unknown"}}}]),e}(),d=f;r.default=d},{"./exp-golomb":15}],20:[function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,s(n.key),n)}}function a(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e){var t=u(e,"string");return"symbol"===n(t)?t:String(t)}function u(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!==n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var c=function(){function e(){i(this,e)}return a(e,null,[{key:"getSilentFrame",value:function(e){return 1===e?new Uint8Array([0,200,0,128,35,128]):2===e?new Uint8Array([33,0,73,144,2,25,0,35,128]):3===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]):4===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]):5===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]):6===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]):null}}]),e}(),l=c;r.default=l},{}],21:[function(e,t,r){"use strict";t.exports=e("./wfs.js").default},{"./wfs.js":30}],22:[function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=e("../errors"),o=d(e("../events")),a=d(e("../event-handler")),s=d(e("../audio/audio-loader")),u=d(e("../demux/h264-demuxer")),c=d(e("../h265/h265-demuxer")),l=d(e("../utils/webgl-payer")),f=d(e("../wfs"));d(e("../helper/aac"));function d(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,v(n.key),n)}}function y(e,t,r){return t&&p(e.prototype,t),r&&p(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function v(e){var t=m(e,"string");return"symbol"===n(t)?t:String(t)}function m(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!==n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function g(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&b(e,t)}function b(e,t){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},b(e,t)}function _(e){var t=A();return function(){var r,n=S(e);if(t){var i=S(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return w(this,r)}}function w(e,t){if(t&&("object"===n(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return E(e)}function E(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function A(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function S(e){return S=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},S(e)}var T=function(e){g(r,e);var t=_(r);function r(e){var n;return h(this,r),n=t.call(this,e,o.default.WEBSOCKET_ATTACHING,o.default.WEBSOCKET_DATA_UPLOADING),n.buf=null,n.ctx=null,n.h264Demuxer=new u.default(e),n.websocketName=void 0,n.media=void 0,n.mediaType=void 0,n.mediaCode=0,n.isForceClosed=!1,n.timer=void 0,n.lastRecvDataTime=0,n.extraData=void 0,n.isLoaded=!1,n.webglPlayer=null,n.canvas=null,n.processor=null,n.h265Demuxer=null,f.default.isSupportedHEVC()&&(n.h265Demuxer=new c.default(e)),n.audioLoader=void 0,n}return y(r,[{key:"create_timer",value:function(){var e=this;this.lastRecvDataTime=performance.now(),this.timer=setInterval((function(){if(e.lastRecvDataTime>0){var t=performance.now(),r=t-e.lastRecvDataTime;if(r>e.wfs.config.wsMinPacketInterval&&console.log("video Websocket: did not recv data over "+r+" ms"),r>e.wfs.config.wsMaxPacketInterval&&!e.isForceClosed){e.unload(),console.log("video Websocket data not received in "+e.wfs.config.wsMaxPacketInterval/1e3+"s, open again...");var n={type:i.ErrorTypes.NETWORK_ERROR};n.details=i.ErrorDetails.NETWORK_RECV_DATA_TIMEOUT,n.fatal=!0,e.wfs.trigger(o.default.ERROR,n)}}else e.lastRecvDataTime=performance.now()}),this.wfs.config.wsMinPacketInterval)}},{key:"kill_timer",value:function(){this.timer&&(console.log("video Websocket close: clear timer"),clearInterval(this.timer),this.timer=void 0)}},{key:"destroy",value:function(){console.log("WebsocketLoader +++"),this.kill_timer(),this.isForceClosed=!0,this.client&&this.client.close(),this.audioLoader&&this.audioLoader.closeWS(),this.audioLoader&&a.default.prototype.destroy.call(this.audioLoader),this.processor&&this.processor.terminate(),this.processor=null,a.default.prototype.destroy.call(this),console.log("WebsocketLoader ---")}},{key:"onWebsocketAttaching",value:function(e){switch(this.kill_timer(),this.create_timer(),e.mediaType){case"MJPEG":this.mediaCode=1,this.ctx=e.media.ctx.getContext("2d");break;case"H265Raw":this.mediaCode=2,this.ctx=e.media.ctx,this.pts=0,this.processor=this.initH265DecodeWorker();break;case"H264Raw":default:this.mediaCode=0;break}this.media=e.media,this.mediaType=e.mediaType,this.extraData=e.extraData,e.websocket instanceof WebSocket&&(this.client=e.websocket,this.client.onopen=this.initSocketClient.bind(this),this.client.onclose=this.closeSocketClient.bind(this),this.client.onerror=this.errorSocketClient.bind(this)),e.audioInfo&&(this.audioLoader=new s.default(this.wfs),this.audioLoader.onWSAttaching(e.audioInfo))}},{key:"errorSocketClient",value:function(e){this.unload(),console.log("video WebSocket error: ",e)}},{key:"closeSocketClient",value:function(e){this.unload(),console.log("video Websocket closed: ",e)}},{key:"initSocketClient",value:function(e){this.load(),console.log("video Websocket Open!")}},{key:"receiveSocketMessage",value:function(e){if(!this.isForceClosed){this.lastRecvDataTime=performance.now();var t=new Uint8Array(e.data),r=new DataView(t.buffer),n=1414092865,i=16,a=this.lastRecvDataTime;if(r.byteLength>=8){var s=r.getUint32(0,!0),u=r.getUint32(4,!0);s==n&&u+i==r.byteLength?(a=Number(r.getBigUint64(8,!0)/BigInt(1e3)),this.buf=t.subarray(i)):this.buf=t}else this.buf=t;0===this.mediaCode?this.wfs.trigger(o.default.H264_DATA_PARSING,{data:this.buf,pts:a}):1===this.mediaCode?this.procMjpeg(e.data):2===this.mediaCode&&this.procH265(this.buf,a),this.wfs.config.recording&&this.wfs.trigger(o.default.H264_DATA_APPENDING,{data:this.buf,pts:a})}}},{key:"procH265",value:function(e,t){this.h265Demuxer?this.wfs.trigger(o.default.H265_DATA_PARSING,{data:e,pts:t}):this.processor.postMessage({type:"h265",data:e})}},{key:"initH265DecodeWorker",value:function(){var e=this;if(this.h265Demuxer)return null;var t=new Worker("./js/h265_decode_worker.js");return t.onmessage=function(t){var r=t.data,n=r.type,i=new Uint8Array(r.data);switch(n){case"yuv":var o={data:i,width:r.width,height:r.height};e.displayVideoFrame(o);break;default:console.log("do nothing")}},t}},{key:"procMjpeg",value:function(e){var t=this;if(this.extraData){if(!this.extraData.isDrawImg)return;var r=new FileReader;r.onload=function(e){if(e.target.readyState===FileReader.DONE){var r=t.ctx,n=new Image,i=t.extraData.mjpeg_w,o=t.extraData.mjpeg_h,a=t.extraData.sizeOptionInd,s=t.extraData.getObjectFitSize;n.onload=function(){if(r.clearRect(0,0,i,o),1===a){var e=s(a,i,o,this.width,this.height),t=e.sx,u=e.sy,c=e.swidth,l=e.sheight,f=e.x,d=e.y,h=e.width,p=e.height;r.drawImage(n,t,u,c,l,f,d,h,p)}else r.drawImage(n,0,0,i,o)},n.src=e.target.result}},r.readAsDataURL(e)}else console.log("extraData is undefined"),this.extraData=this.wfs.extraData}},{key:"onWebsocketDataUploading",value:function(e){this.client.send(e.data)}},{key:"load",value:function(){0!==this.mediaCode&&2!==this.mediaCode||(this.client.binaryType="arraybuffer"),this.client.onmessage=this.receiveSocketMessage.bind(this),this.isLoaded=!0}},{key:"unload",value:function(){this.isLoaded=!1,1===this.mediaCode&&this.ctx.clearRect(0,0,this.extraData.mjpeg_w,this.extraData.mjpeg_h)}},{key:"displayVideoFrame",value:function(e){var t=this.extraData.mjpeg_w,r=this.extraData.mjpeg_h,n=this.extraData.sizeOptionInd,i=3840;if(!this.webglPlayer){var o=this.ctx;this.webglPlayer=new l.default(o)}if(1===n){var a=this.extraData.getObjectFitSize,s=a(n,t,r,e.width,e.height),u=(s.sx,s.sy,s.swidth,s.sheight,s.x),c=s.y,f=s.width,d=s.height;this.webglPlayer.setSize(t,r,i),this.webglPlayer.renderFrame(e.data,e.width,e.height,u,c,f,d)}else this.webglPlayer.setSize(e.width,e.height,i),this.webglPlayer.renderFrame(e.data,e.width,e.height,0,0,e.width,e.height)}}]),r}(a.default),k=T;r.default=k},{"../audio/audio-loader":7,"../demux/h264-demuxer":11,"../errors":12,"../event-handler":13,"../events":14,"../h265/h265-demuxer":17,"../helper/aac":20,"../utils/webgl-payer":29,"../wfs":30}],23:[function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,s(n.key),n)}}function a(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e){var t=u(e,"string");return"symbol"===n(t)?t:String(t)}function u(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!==n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var c=function(){function e(){i(this,e)}return a(e,null,[{key:"init",value:function(){var t;for(t in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:r,audio:n};var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),o=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=o,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var a=new Uint8Array([105,115,111,109]),s=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,a,u,a,s),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,i))}},{key:"box",value:function(e){var t,r=Array.prototype.slice.call(arguments,1),n=8,i=r.length,o=i;while(i--)n+=r[i].byteLength;for(t=new Uint8Array(n),t[0]=n>>24&255,t[1]=n>>16&255,t[2]=n>>8&255,t[3]=255&n,t.set(e,4),i=0,n=8;i<o;i++)t.set(r[i],n),n+=r[i].byteLength;return t}},{key:"hdlr",value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}},{key:"mdhd",value:function(t,r){return r*=t,e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,85,196,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))}},{key:"mfhd",value:function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"minf",value:function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))}},{key:"moof",value:function(t,r,n){return e.box(e.types.moof,e.mfhd(t),e.traf(n,r))}},{key:"moov",value:function(t){var r=t.length,n=[];while(r--)n[r]=e.trak(t[r]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(n).concat(e.mvex(t)))}},{key:"mvex",value:function(t){var r=t.length,n=[];while(r--)n[r]=e.trex(t[r]);return e.box.apply(null,[e.types.mvex].concat(n))}},{key:"mvhd",value:function(t,r){r=0;var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24&255,r>>16&255,r>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,n)}},{key:"sdtp",value:function(t){var r,n,i=t.samples||[],o=new Uint8Array(4+i.length);for(n=0;n<i.length;n++)r=i[n].flags,o[n+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return e.box(e.types.sdtp,o)}},{key:"stbl",value:function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))}},{key:"avc1",value:function(t){var r,n,i,o=[],a=[];for(r=0;r<t.sps.length;r++)n=t.sps[r],i=n.byteLength,o.push(i>>>8&255),o.push(255&i),o=o.concat(Array.prototype.slice.call(n));for(r=0;r<t.pps.length;r++)n=t.pps[r],i=n.byteLength,a.push(i>>>8&255),a.push(255&i),a=a.concat(Array.prototype.slice.call(n));var s=e.box(e.types.avcC,new Uint8Array([1,o[3],o[4],o[5],255,224|t.sps.length].concat(o).concat([t.pps.length]).concat(a))),u=t.width,c=t.height;return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,255&u,c>>8&255,255&c,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,98,105,110,101,108,112,114,111,46,114,117,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))}},{key:"esds",value:function(e){var t=e.config.byteLength,r=new Uint8Array(26+t+3);return r.set([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5,t]),r.set(e.config,26),r.set([6,1,2],26+t),r}},{key:"mp4a",value:function(t){var r=t.audiosamplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]),e.box(e.types.esds,e.esds(t)))}},{key:"stsd",value:function(t){return"audio"===t.type?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))}},{key:"tkhd",value:function(t){var r=t.id,n=t.duration,i=t.width,o=t.height,a=t.volume;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,0,0,0,0,0,0,0,0,0,a>>0&255,a%1*10>>0&255,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,255&i,0,0,o>>8&255,255&o,0,0]))}},{key:"traf",value:function(t,r){var n=e.sdtp(t),i=t.id;return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),e.box(e.types.tfdt,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),e.trun(t,n.length+16+16+8+16+8+8),n)}},{key:"trak",value:function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))}},{key:"trex",value:function(t){var r=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(t,r){var n,i,o,a,s,u,c=t.samples||[],l=c.length,f=12+16*l,d=new Uint8Array(f);for(r+=8+f,d.set([0,0,15,1,l>>>24&255,l>>>16&255,l>>>8&255,255&l,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0),n=0;n<l;n++)i=c[n],o=i.duration,a=i.size,s=i.flags,u=i.cts,d.set([o>>>24&255,o>>>16&255,o>>>8&255,255&o,a>>>24&255,a>>>16&255,a>>>8&255,255&a,s.isLeading<<2|s.dependsOn,s.isDependedOn<<6|s.hasRedundancy<<4|s.paddingValue<<1|s.isNonSync,61440&s.degradPrio,15&s.degradPrio,u>>>24&255,u>>>16&255,u>>>8&255,255&u],12+16*n);return e.box(e.types.trun,d)}},{key:"initSegment",value:function(t){e.types||e.init();var r,n=e.moov(t);return r=new Uint8Array(e.FTYP.byteLength+n.byteLength),r.set(e.FTYP),r.set(n,e.FTYP.byteLength),r}}]),e}(),l=c;r.default=l},{}],24:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;a(e("../helper/aac"));var n=a(e("../events")),i=(e("../utils/logger"),a(e("../remux/mp4-generator"))),o=e("../errors");function a(e){return e&&e.__esModule?e:{default:e}}function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,f(n.key),n)}}function l(e,t,r){return t&&c(e.prototype,t),r&&c(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function f(e){var t=d(e,"string");return"symbol"===s(t)?t:String(t)}function d(e,t){if("object"!==s(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==s(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}e("../utils/polyfill");var h=function(){function e(t,r,n){u(this,e),this.observer=t,this.id=r,this.config=n,this.ISVedioGenerated=!1,this.PES_TIMESCALE=this.config.timescale,this.H264_TIMEBASE=this.config.mp4Duration,this.genISFailCount=0,this.nextAvcDts=this.PES_TIMESCALE+300,this._initPTS=this._initDTS=void 0,this.lastDTS=0,this.baseDecodeTime=0}return l(e,[{key:"passthrough",get:function(){return!1}},{key:"destroy",value:function(){}},{key:"insertDiscontinuity",value:function(){this._initPTS=this._initDTS=void 0}},{key:"pushVideo",value:function(e,t,r){this.level=e,this.sn=t,this.ISVedioGenerated||this.generateVideoIS(r),this.ISVedioGenerated&&("both"===this.config.mode?this.remuxVideoWithAudio(r):this.remuxVideo_2(r))}},{key:"remuxVideoWithAudio",value:function(e){var t,r,o=8,a=e.samples,s=[];t=new Uint8Array(e.len+4*e.nbNalu+8);var u=new DataView(t.buffer);u.setUint32(0,t.byteLength),t.set(i.default.types.mdat,4);for(var c=0,l=0;l<a.length;l++){var f=a[l],d=0;while(f.units.units.length){var h=f.units.units.shift();u.setUint32(o,h.data.byteLength),o+=4,t.set(h.data,o),o+=h.data.byteLength,d+=4+h.data.byteLength}var p=(f.dts-this.lastDTS)/1e3*this.PES_TIMESCALE;0==this.lastDTS&&(p=500),c+=p,s.push({size:d,duration:p,cts:0,flags:{isLeading:0,hasRedundancy:0,degradPrio:0,dependsOn:f.key?2:1,isDependedOn:f.key?1:0,isNonSync:f.key?0:1}}),this.lastDTS=f.dts}e.len=0,e.samples=s,r=i.default.moof(e.sequenceNumber++,this.baseDecodeTime,e),this.baseDecodeTime+=c,e.samples=[];var y={data1:r,data2:t,type:"video"};return this.observer.trigger(n.default.FRAG_PARSING_DATA,y),y}},{key:"remuxVideo_2",value:function(e){var t,r,o=8,a=e.samples,s=[];t=new Uint8Array(e.len+4*e.nbNalu+8);var u,c,l,f=new DataView(t.buffer);f.setUint32(0,t.byteLength),t.set(i.default.types.mdat,4);for(var d=0;d<a.length;d++){var h=a[d],p=0;while(h.units.units.length){var y=h.units.units.shift();f.setUint32(o,y.data.byteLength),o+=4,t.set(y.data,o),o+=y.data.byteLength,p+=4+y.data.byteLength}var v=h.pts-this._initPTS,m=h.dts-this._initDTS;if(m=Math.min(v,m),void 0!==l)u=this._PTSNormalize(v,l),c=this._PTSNormalize(m,l);else{var g,b=this.nextAvcDts;u=this._PTSNormalize(v,b),c=this._PTSNormalize(m,b),b&&(g=Math.round(c-b),Math.abs(g)<600&&g&&(c=b,u=Math.max(u-g,c))),this.firstPTS=Math.max(0,u),this.firstDTS=Math.max(0,c)}s.push({size:p,duration:this.H264_TIMEBASE,cts:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:h.key?2:1,isNonSync:h.key?0:1}}),l=c}if(this.nextAvcDts=c,e.len=0,e.nbNalu=0,e.dropped=0,s.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var _=s[0].flags;_.dependsOn=2,_.isNonSync=0}e.samples=s,r=i.default.moof(e.sequenceNumber++,c,e),this.config.dtsnorm=c,e.samples=[];var w={data1:r,data2:t,type:"video"};return this.observer.trigger(n.default.FRAG_PARSING_DATA,w),w}},{key:"generateVideoIS",value:function(e){var t,r,a=this.observer,s=e.samples,u={},c=void 0===this._initPTS;if(c&&(t=r=1/0),e.sps&&e.pps&&s.length&&(e.timescale=this.PES_TIMESCALE,e.duration=this.config.mp4Duration,u.video={container:"video/mp4",initSegment:i.default.initSegment([e]),metadata:{width:e.width,height:e.height}},c&&(t=Math.min(t,s[0].pts-this.H264_TIMEBASE),r=Math.min(r,s[0].dts-this.H264_TIMEBASE))),Object.keys(u).length){var l={tracks:u};a.trigger(n.default.FRAG_PARSING_INIT_SEGMENT,l),this.ISVedioGenerated=!0,this.genISFailCount=0,c&&(this._initPTS=t,this._initDTS=r)}else this.genISFailCount++,this.genISFailCount>60&&console.log("generateVideoIS ERROR: ",o.ErrorTypes.MEDIA_ERROR)}},{key:"_PTSNormalize",value:function(e,t){var r;if(void 0===t)return e;r=t<e?-8589934592:8589934592;while(Math.abs(e-t)>4294967296)e+=r;return e}}]),e}(),p=h;r.default=p},{"../errors":12,"../events":14,"../helper/aac":20,"../remux/mp4-generator":23,"../utils/logger":26,"../utils/polyfill":28}],25:[function(e,t,r){(function(t){(function(){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=function(){var r="undefined"!==typeof document&&document.currentScript?document.currentScript.src:void 0;return function(i){i=i||{};var o,a;i="undefined"!=typeof i?i:{};i["ready"]=new Promise((function(e,t){o=e,a=t})),["_malloc","_free","_turn_on_encoder","_pcm_2_aac","_getByteLen","_free_buf","_fflush","___set_stack_limits","onRuntimeInitialized"].forEach((function(e){Object.getOwnPropertyDescriptor(i["ready"],e)||Object.defineProperty(i["ready"],e,{get:function(){return ne("You are getting "+e+" on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")},set:function(){return ne("You are setting "+e+" on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})}));var s=Object.assign({},i),u=[],c=function(e,t){throw t},l=!0,f=!1,d=!1,h=!1;if(i["ENVIRONMENT"])throw new Error("Module.ENVIRONMENT has been deprecated. To force the environment, use the ENVIRONMENT compile-time option (for example, -sENVIRONMENT=web or -sENVIRONMENT=node)");var p,y="";function v(e){return i["locateFile"]?i["locateFile"](e,y):y+e}function m(e){if(!(e instanceof he)){var t=e;e&&"object"==n(e)&&e.stack&&(t=[e,e.stack]),b("exiting due to exception: "+t)}}if(h){if("object"==("undefined"===typeof t?"undefined":n(t))&&"function"===typeof e||"object"==("undefined"===typeof window?"undefined":n(window))||"function"==typeof importScripts)throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");"undefined"!=typeof read&&function(e){return read(e)},p=function(e){var t;return"function"==typeof readbuffer?new Uint8Array(readbuffer(e)):(t=read(e,"binary"),x("object"==n(t)),t)},function(e,t,r){setTimeout((function(){return t(p(e))}),0)},"undefined"!=typeof scriptArgs?u=scriptArgs:"undefined"!=typeof arguments&&(u=arguments),"function"==typeof quit&&(c=function(e,t){m(t),quit(e)}),"undefined"!=typeof print&&("undefined"==typeof console&&(console={}),console.log=print,console.warn=console.error="undefined"!=typeof printErr?printErr:print)}else{if(!l&&!f)throw new Error("environment detection error");if(f?y=self.location.href:"undefined"!=typeof document&&document.currentScript&&(y=document.currentScript.src),r&&(y=r),y=0!==y.indexOf("blob:")?y.substr(0,y.replace(/[?#].*/,"").lastIndexOf("/")+1):"","object"!=("undefined"===typeof window?"undefined":n(window))&&"function"!=typeof importScripts)throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");(function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText}),f&&(p=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){200==n.status||0==n.status&&n.response?t(n.response):r()},n.onerror=r,n.send(null)},function(e){return document.title=e}}var g=i["print"]||console.log.bind(console),b=i["printErr"]||console.warn.bind(console);Object.assign(i,s),s=null,Le(),i["arguments"]&&(u=i["arguments"]),w("arguments","arguments_"),i["thisProgram"]&&i["thisProgram"],w("thisProgram","thisProgram"),i["quit"]&&(c=i["quit"]),w("quit","quit_"),x("undefined"==typeof i["memoryInitializerPrefixURL"],"Module.memoryInitializerPrefixURL option was removed, use Module.locateFile instead"),x("undefined"==typeof i["pthreadMainPrefixURL"],"Module.pthreadMainPrefixURL option was removed, use Module.locateFile instead"),x("undefined"==typeof i["cdInitializerPrefixURL"],"Module.cdInitializerPrefixURL option was removed, use Module.locateFile instead"),x("undefined"==typeof i["filePackagePrefixURL"],"Module.filePackagePrefixURL option was removed, use Module.locateFile instead"),x("undefined"==typeof i["read"],"Module.read option was removed (modify read_ in JS)"),x("undefined"==typeof i["readAsync"],"Module.readAsync option was removed (modify readAsync in JS)"),x("undefined"==typeof i["readBinary"],"Module.readBinary option was removed (modify readBinary in JS)"),x("undefined"==typeof i["setWindowTitle"],"Module.setWindowTitle option was removed (modify setWindowTitle in JS)"),x("undefined"==typeof i["TOTAL_MEMORY"],"Module.TOTAL_MEMORY has been renamed Module.INITIAL_MEMORY"),w("read","read_"),w("readAsync","readAsync"),w("readBinary","readBinary"),w("setWindowTitle","setWindowTitle"),x(!f,"worker environment detected but not enabled at build time.  Add 'worker' to `-sENVIRONMENT` to enable."),x(!d,"node environment detected but not enabled at build time.  Add 'node' to `-sENVIRONMENT` to enable."),x(!h,"shell environment detected but not enabled at build time.  Add 'shell' to `-sENVIRONMENT` to enable.");var _;function w(e,t){Object.getOwnPropertyDescriptor(i,e)||Object.defineProperty(i,e,{configurable:!0,get:function(){ne("Module."+e+" has been replaced with plain "+t+" (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)")}})}function E(e){Object.getOwnPropertyDescriptor(i,e)&&ne("`Module."+e+"` was supplied but `"+e+"` not included in INCOMING_MODULE_JS_API")}function A(e){return"FS_createPath"===e||"FS_createDataFile"===e||"FS_createPreloadedFile"===e||"FS_unlink"===e||"addRunDependency"===e||"FS_createLazyFile"===e||"FS_createDevice"===e||"removeRunDependency"===e}function S(e){"undefined"===typeof globalThis||Object.getOwnPropertyDescriptor(globalThis,e)||Object.defineProperty(globalThis,e,{configurable:!0,get:function(){var t="`"+e+"` is a library symbol and not included by default; add it to your library.js __deps or to DEFAULT_LIBRARY_FUNCS_TO_INCLUDE on the command line";A(e)&&(t+=". Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you"),ye(t)}})}function T(e){Object.getOwnPropertyDescriptor(i,e)||Object.defineProperty(i,e,{configurable:!0,get:function(){var t="'"+e+"' was not exported. add it to EXPORTED_RUNTIME_METHODS (see the FAQ)";A(e)&&(t+=". Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you"),ne(t)}})}i["wasmBinary"]&&(_=i["wasmBinary"]),w("wasmBinary","wasmBinary");var k,R=i["noExitRuntime"]||!0;w("noExitRuntime","noExitRuntime"),"object"!=("undefined"===typeof WebAssembly?"undefined":n(WebAssembly))&&ne("no native wasm support detected");var P,O,L=!1;function x(e,t){e||ne("Assertion failed"+(t?": "+t:""))}function D(e,t,r){var n=t+r,i="";while(!(t>=n)){var o=e[t++];if(!o)return i;if(128&o){var a=63&e[t++];if(192!=(224&o)){var s=63&e[t++];if(224==(240&o)?o=(15&o)<<12|a<<6|s:(240!=(248&o)&&ye("Invalid UTF-8 leading byte 0x"+o.toString(16)+" encountered when deserializing a UTF-8 string in wasm memory to a JS string!"),o=(7&o)<<18|a<<12|s<<6|63&e[t++]),o<65536)i+=String.fromCharCode(o);else{var u=o-65536;i+=String.fromCharCode(55296|u>>10,56320|1023&u)}}else i+=String.fromCharCode((31&o)<<6|a)}else i+=String.fromCharCode(o)}return i}function C(e,t){return e?D(P,e,t):""}function I(e){e,i["HEAP8"]=new Int8Array(e),i["HEAP16"]=new Int16Array(e),i["HEAP32"]=new Int32Array(e),i["HEAPU8"]=P=new Uint8Array(e),i["HEAPU16"]=new Uint16Array(e),i["HEAPU32"]=O=new Uint32Array(e),i["HEAPF32"]=new Float32Array(e),i["HEAPF64"]=new Float64Array(e)}var U=5242880;i["TOTAL_STACK"]&&x(U===i["TOTAL_STACK"],"the stack size can no longer be determined at runtime");var M,F=i["INITIAL_MEMORY"]||67108864;function N(){var e=Ue();x(0==(3&e)),O[e>>2]=34821223,O[e+4>>2]=2310721022,O[0]=1668509029}function j(){if(!L){var e=Ue(),t=O[e>>2],r=O[e+4>>2];34821223==t&&2310721022==r||ne("Stack overflow! Stack cookie has been overwritten at 0x"+e.toString(16)+", expected hex dwords 0x89BACDFE and 0x2135467, but received 0x"+r.toString(16)+" 0x"+t.toString(16)),1668509029!==O[0]&&ne("Runtime error: The application has corrupted its heap memory area (address zero)!")}}w("INITIAL_MEMORY","INITIAL_MEMORY"),x(F>=U,"INITIAL_MEMORY should be larger than TOTAL_STACK, was "+F+"! (TOTAL_STACK="+U+")"),x("undefined"!=typeof Int32Array&&"undefined"!==typeof Float64Array&&void 0!=Int32Array.prototype.subarray&&void 0!=Int32Array.prototype.set,"JS engine does not provide full typed array support"),x(!i["wasmMemory"],"Use of `wasmMemory` detected.  Use -sIMPORTED_MEMORY to define wasmMemory externally"),x(67108864==F,"Detected runtime INITIAL_MEMORY setting.  Use -sIMPORTED_MEMORY to define wasmMemory dynamically"),function(){var e=new Int16Array(1),t=new Int8Array(e.buffer);if(e[0]=25459,115!==t[0]||99!==t[1])throw"Runtime error: expected the system to be little-endian! (Run with -sSUPPORT_BIG_ENDIAN to bypass)"}();var B=[],G=[],W=[],H=!1;function V(){return R}function z(){if(i["preRun"]){"function"==typeof i["preRun"]&&(i["preRun"]=[i["preRun"]]);while(i["preRun"].length)K(i["preRun"].shift())}pe(B)}function Y(){x(!H),H=!0,j(),Me(Ie(),Ue()),pe(G)}function q(){if(j(),i["postRun"]){"function"==typeof i["postRun"]&&(i["postRun"]=[i["postRun"]]);while(i["postRun"].length)J(i["postRun"].shift())}pe(W)}function K(e){B.unshift(e)}function X(e){G.unshift(e)}function J(e){W.unshift(e)}x(Math.imul,"This browser does not support Math.imul(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),x(Math.fround,"This browser does not support Math.fround(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),x(Math.clz32,"This browser does not support Math.clz32(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),x(Math.trunc,"This browser does not support Math.trunc(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill");var Z=0,Q=null,$=null,ee={};function te(e){Z++,i["monitorRunDependencies"]&&i["monitorRunDependencies"](Z),e?(x(!ee[e]),ee[e]=1,null===Q&&"undefined"!=typeof setInterval&&(Q=setInterval((function(){if(L)return clearInterval(Q),void(Q=null);var e=!1;for(var t in ee)e||(e=!0,b("still waiting on run dependencies:")),b("dependency: "+t);e&&b("(end of list)")}),1e4))):b("warning: run dependency added without ID")}function re(e){if(Z--,i["monitorRunDependencies"]&&i["monitorRunDependencies"](Z),e?(x(ee[e]),delete ee[e]):b("warning: run dependency removed without ID"),0==Z&&(null!==Q&&(clearInterval(Q),Q=null),$)){var t=$;$=null,t()}}function ne(e){i["onAbort"]&&i["onAbort"](e),e="Aborted("+e+")",b(e),L=!0,1;var t=new WebAssembly.RuntimeError(e);throw a(t),t}var ie={error:function(){ne("Filesystem support (FS) was not included. The problem is that you are using files from JS, but files were not used from C/C++, so filesystem support was not auto-included. You can force-include filesystem support with -sFORCE_FILESYSTEM")},init:function(){ie.error()},createDataFile:function(){ie.error()},createPreloadedFile:function(){ie.error()},createLazyFile:function(){ie.error()},open:function(){ie.error()},mkdev:function(){ie.error()},registerDevice:function(){ie.error()},analyzePath:function(){ie.error()},loadFilesFromDB:function(){ie.error()},ErrnoError:function(){ie.error()}};i["FS_createDataFile"]=ie.createDataFile,i["FS_createPreloadedFile"]=ie.createPreloadedFile;var oe,ae="data:application/octet-stream;base64,";function se(e){return e.startsWith(ae)}function ue(e){return e.startsWith("file://")}function ce(e,t){return function(){var r=e,n=t;return t||(n=i["asm"]),x(H,"native function `"+r+"` called before runtime initialization"),n[e]||x(n[e],"exported native function `"+r+"` not found"),n[e].apply(null,arguments)}}function le(e){try{if(e==oe&&_)return new Uint8Array(_);if(p)return p(e);throw"both async and sync fetching of the wasm failed"}catch(e){ne(e)}}function fe(){return _||!l&&!f||"function"!=typeof fetch?Promise.resolve().then((function(){return le(oe)})):fetch(oe,{credentials:"same-origin"}).then((function(e){if(!e["ok"])throw"failed to load wasm binary file at '"+oe+"'";return e["arrayBuffer"]()})).catch((function(){return le(oe)}))}function de(){var e={env:xe,wasi_snapshot_preview1:xe};function t(e,t){var r=e.exports;i["asm"]=r,k=i["asm"]["memory"],x(k,"memory not found in wasm exports"),I(k.buffer),M=i["asm"]["__indirect_function_table"],x(M,"table not found in wasm exports"),X(i["asm"]["__wasm_call_ctors"]),re("wasm-instantiate")}te("wasm-instantiate");var r=i;function n(e){x(i===r,"the Module object should not be replaced during async compilation - perhaps the order of HTML elements is wrong?"),r=null,t(e["instance"])}function o(t){return fe().then((function(t){return WebAssembly.instantiate(t,e)})).then((function(e){return e})).then(t,(function(e){b("failed to asynchronously prepare wasm: "+e),ue(oe)&&b("warning: Loading from a file URI ("+oe+") is not supported in most browsers. See https://emscripten.org/docs/getting_started/FAQ.html#how-do-i-run-a-local-webserver-for-testing-why-does-my-program-stall-in-downloading-or-preparing"),ne(e)}))}function s(){return _||"function"!=typeof WebAssembly.instantiateStreaming||se(oe)||"function"!=typeof fetch?o(n):fetch(oe,{credentials:"same-origin"}).then((function(t){var r=WebAssembly.instantiateStreaming(t,e);return r.then(n,(function(e){return b("wasm streaming compile failed: "+e),b("falling back to ArrayBuffer instantiation"),o(n)}))}))}if(i["instantiateWasm"])try{var u=i["instantiateWasm"](e,t);return u}catch(s){return b("Module.instantiateWasm callback failed with error: "+s),!1}return s().catch(a),{}}function he(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function pe(e){while(e.length>0)e.shift()(i)}function ye(e){ye.shown||(ye.shown={}),ye.shown[e]||(ye.shown[e]=1,b(e))}function ve(e,t,r,n){ne("Assertion failed: "+C(e)+", at: "+[t?C(t):"unknown filename",r,n?C(n):"unknown function"])}function me(e){e>>>=0,ne("stack overflow (Attempt to set SP to 0x"+e.toString(16)+", with stack limits [0x"+Ue().toString(16)+" - 0x"+Ie().toString(16)+"])")}function ge(){ne("native code called abort()")}function be(e,t,r){P.copyWithin(e,t,t+r)}function _e(e){P.length;return 0,!1}oe="libfaac.wasm",se(oe)||(oe=v(oe));function we(e){e,V()||(i["onExit"]&&i["onExit"](e),L=!0),c(e,new he(e))}function Ee(e,t){if(e,We(),V()&&!t){var r="program exited (with status: "+e+"), but EXIT_RUNTIME is not set, so halting execution but not exiting the runtime or preventing further async execution (build with EXIT_RUNTIME=1, if you want a true shutdown)";a(r),b(r)}we(e)}var Ae=Ee;function Se(e){ne("fd_close called without SYSCALLS_REQUIRE_FILESYSTEM")}function Te(e,t,r,n,i){return 70}var ke=[null,[],[]];function Re(e,t){var r=ke[e];x(r),0===t||10===t?((1===e?g:b)(D(r,0)),r.length=0):r.push(t)}function Pe(){De(0),ke[1].length&&Re(1,10),ke[2].length&&Re(2,10)}function Oe(e,t,r,n){for(var i=0,o=0;o<r;o++){var a=O[t>>2],s=O[t+4>>2];t+=8;for(var u=0;u<s;u++)Re(e,P[a+u]);i+=s}return O[n>>2]=i,0}function Le(){E("fetchSettings")}var xe={__assert_fail:ve,__handle_stack_overflow:me,abort:ge,emscripten_memcpy_big:be,emscripten_resize_heap:_e,exit:Ae,fd_close:Se,fd_seek:Te,fd_write:Oe},De=(de(),i["___wasm_call_ctors"]=ce("__wasm_call_ctors"),i["_turn_on_encoder"]=ce("turn_on_encoder"),i["_pcm_2_aac"]=ce("pcm_2_aac"),i["_malloc"]=ce("malloc"),i["_free"]=ce("free"),i["_getByteLen"]=ce("getByteLen"),i["_free_buf"]=ce("free_buf"),i["___errno_location"]=ce("__errno_location"),i["_fflush"]=ce("fflush")),Ce=i["_emscripten_stack_init"]=function(){return(Ce=i["_emscripten_stack_init"]=i["asm"]["emscripten_stack_init"]).apply(null,arguments)},Ie=(i["_emscripten_stack_get_free"]=function(){return(i["_emscripten_stack_get_free"]=i["asm"]["emscripten_stack_get_free"]).apply(null,arguments)},i["_emscripten_stack_get_base"]=function(){return(Ie=i["_emscripten_stack_get_base"]=i["asm"]["emscripten_stack_get_base"]).apply(null,arguments)}),Ue=i["_emscripten_stack_get_end"]=function(){return(Ue=i["_emscripten_stack_get_end"]=i["asm"]["emscripten_stack_get_end"]).apply(null,arguments)},Me=(i["stackSave"]=ce("stackSave"),i["stackRestore"]=ce("stackRestore"),i["stackAlloc"]=ce("stackAlloc"),i["___set_stack_limits"]=ce("__set_stack_limits")),Fe=(i["dynCall_jiji"]=ce("dynCall_jiji"),["run","UTF8ArrayToString","UTF8ToString","stringToUTF8Array","stringToUTF8","lengthBytesUTF8","addOnPreRun","addOnInit","addOnPreMain","addOnExit","addOnPostRun","addRunDependency","removeRunDependency","FS_createFolder","FS_createPath","FS_createDataFile","FS_createPreloadedFile","FS_createLazyFile","FS_createLink","FS_createDevice","FS_unlink","getLEB","getFunctionTables","alignFunctionTables","registerFunctions","prettyPrint","getCompilerSetting","print","printErr","callMain","abort","keepRuntimeAlive","wasmMemory","stackAlloc","stackSave","stackRestore","getTempRet0","setTempRet0","writeStackCookie","checkStackCookie","ptrToString","zeroMemory","stringToNewUTF8","exitJS","getHeapMax","emscripten_realloc_buffer","ENV","ERRNO_CODES","ERRNO_MESSAGES","setErrNo","inetPton4","inetNtop4","inetPton6","inetNtop6","readSockaddr","writeSockaddr","DNS","getHostByName","Protocols","Sockets","getRandomDevice","warnOnce","traverseStack","UNWIND_CACHE","convertPCtoSourceLocation","readAsmConstArgsArray","readAsmConstArgs","mainThreadEM_ASM","jstoi_q","jstoi_s","getExecutableName","listenOnce","autoResumeAudioContext","dynCallLegacy","getDynCaller","dynCall","handleException","runtimeKeepalivePush","runtimeKeepalivePop","callUserCallback","maybeExit","safeSetTimeout","asmjsMangle","asyncLoad","alignMemory","mmapAlloc","writeI53ToI64","writeI53ToI64Clamped","writeI53ToI64Signaling","writeI53ToU64Clamped","writeI53ToU64Signaling","readI53FromI64","readI53FromU64","convertI32PairToI53","convertI32PairToI53Checked","convertU32PairToI53","getCFunc","ccall","cwrap","uleb128Encode","sigToWasmTypes","convertJsFunctionToWasm","freeTableIndexes","functionsInTableMap","getEmptyTableSlot","updateTableMap","addFunction","removeFunction","reallyNegative","unSign","strLen","reSign","formatString","setValue","getValue","PATH","PATH_FS","intArrayFromString","intArrayToString","AsciiToString","stringToAscii","UTF16ToString","stringToUTF16","lengthBytesUTF16","UTF32ToString","stringToUTF32","lengthBytesUTF32","allocateUTF8","allocateUTF8OnStack","writeStringToMemory","writeArrayToMemory","writeAsciiToMemory","SYSCALLS","getSocketFromFD","getSocketAddress","JSEvents","registerKeyEventCallback","specialHTMLTargets","maybeCStringToJsString","findEventTarget","findCanvasEventTarget","getBoundingClientRect","fillMouseEventData","registerMouseEventCallback","registerWheelEventCallback","registerUiEventCallback","registerFocusEventCallback","fillDeviceOrientationEventData","registerDeviceOrientationEventCallback","fillDeviceMotionEventData","registerDeviceMotionEventCallback","screenOrientation","fillOrientationChangeEventData","registerOrientationChangeEventCallback","fillFullscreenChangeEventData","registerFullscreenChangeEventCallback","JSEvents_requestFullscreen","JSEvents_resizeCanvasForFullscreen","registerRestoreOldStyle","hideEverythingExceptGivenElement","restoreHiddenElements","setLetterbox","currentFullscreenStrategy","restoreOldWindowedStyle","softFullscreenResizeWebGLRenderTarget","doRequestFullscreen","fillPointerlockChangeEventData","registerPointerlockChangeEventCallback","registerPointerlockErrorEventCallback","requestPointerLock","fillVisibilityChangeEventData","registerVisibilityChangeEventCallback","registerTouchEventCallback","fillGamepadEventData","registerGamepadEventCallback","registerBeforeUnloadEventCallback","fillBatteryEventData","battery","registerBatteryEventCallback","setCanvasElementSize","getCanvasElementSize","demangle","demangleAll","jsStackTrace","stackTrace","ExitStatus","getEnvStrings","checkWasiClock","flush_NO_FILESYSTEM","dlopenMissingError","setImmediateWrapped","clearImmediateWrapped","polyfillSetImmediate","uncaughtExceptionCount","exceptionLast","exceptionCaught","ExceptionInfo","exception_addRef","exception_decRef","Browser","setMainLoop","wget","tempFixedLengthArray","miniTempWebGLFloatBuffers","heapObjectForWebGLType","heapAccessShiftForWebGLHeap","GL","emscriptenWebGLGet","computeUnpackAlignedImageSize","emscriptenWebGLGetTexPixelData","emscriptenWebGLGetUniform","webglGetUniformLocation","webglPrepareUniformLocationsBeforeFirstUse","webglGetLeftBracePos","emscriptenWebGLGetVertexAttrib","writeGLArray","AL","SDL_unicode","SDL_ttfContext","SDL_audio","SDL","SDL_gfx","GLUT","EGL","GLFW_Window","GLFW","GLEW","IDBStore","runAndAbortIfError","ALLOC_NORMAL","ALLOC_STACK","allocate"]);Fe.forEach(T);var Ne,je=["ptrToString","zeroMemory","stringToNewUTF8","emscripten_realloc_buffer","setErrNo","inetPton4","inetNtop4","inetPton6","inetNtop6","readSockaddr","writeSockaddr","getHostByName","getRandomDevice","traverseStack","convertPCtoSourceLocation","readAsmConstArgs","mainThreadEM_ASM","jstoi_q","jstoi_s","getExecutableName","listenOnce","autoResumeAudioContext","dynCallLegacy","getDynCaller","dynCall","runtimeKeepalivePush","runtimeKeepalivePop","callUserCallback","maybeExit","safeSetTimeout","asmjsMangle","asyncLoad","alignMemory","mmapAlloc","writeI53ToI64","writeI53ToI64Clamped","writeI53ToI64Signaling","writeI53ToU64Clamped","writeI53ToU64Signaling","readI53FromI64","readI53FromU64","convertI32PairToI53","convertU32PairToI53","reallyNegative","unSign","strLen","reSign","formatString","getSocketFromFD","getSocketAddress","registerKeyEventCallback","maybeCStringToJsString","findEventTarget","findCanvasEventTarget","getBoundingClientRect","fillMouseEventData","registerMouseEventCallback","registerWheelEventCallback","registerUiEventCallback","registerFocusEventCallback","fillDeviceOrientationEventData","registerDeviceOrientationEventCallback","fillDeviceMotionEventData","registerDeviceMotionEventCallback","screenOrientation","fillOrientationChangeEventData","registerOrientationChangeEventCallback","fillFullscreenChangeEventData","registerFullscreenChangeEventCallback","JSEvents_requestFullscreen","JSEvents_resizeCanvasForFullscreen","registerRestoreOldStyle","hideEverythingExceptGivenElement","restoreHiddenElements","setLetterbox","softFullscreenResizeWebGLRenderTarget","doRequestFullscreen","fillPointerlockChangeEventData","registerPointerlockChangeEventCallback","registerPointerlockErrorEventCallback","requestPointerLock","fillVisibilityChangeEventData","registerVisibilityChangeEventCallback","registerTouchEventCallback","fillGamepadEventData","registerGamepadEventCallback","registerBeforeUnloadEventCallback","fillBatteryEventData","battery","registerBatteryEventCallback","setCanvasElementSize","getCanvasElementSize","getEnvStrings","checkWasiClock","setImmediateWrapped","clearImmediateWrapped","polyfillSetImmediate","ExceptionInfo","exception_addRef","exception_decRef","setMainLoop","heapObjectForWebGLType","heapAccessShiftForWebGLHeap","emscriptenWebGLGet","computeUnpackAlignedImageSize","emscriptenWebGLGetTexPixelData","emscriptenWebGLGetUniform","webglGetUniformLocation","webglPrepareUniformLocationsBeforeFirstUse","webglGetLeftBracePos","emscriptenWebGLGetVertexAttrib","writeGLArray","SDL_unicode","SDL_ttfContext","SDL_audio","GLFW_Window","runAndAbortIfError"];function Be(){Ce(),N()}function Ge(e){function t(){Ne||(Ne=!0,i["calledRun"]=!0,L||(Y(),o(i),i["onRuntimeInitialized"]&&i["onRuntimeInitialized"](),x(!i["_main"],'compiled without a main, but one is present. if you added it from JS, use Module["onRuntimeInitialized"]'),q()))}e=e||u,Z>0||(Be(),z(),Z>0||(i["setStatus"]?(i["setStatus"]("Running..."),setTimeout((function(){setTimeout((function(){i["setStatus"]("")}),1),t()}),1)):t(),j()))}function We(){var e=g,t=b,r=!1;g=b=function(e){r=!0};try{Pe()}catch(e){}g=e,b=t,r&&(ye("stdio streams had content in them that was not flushed. you should set EXIT_RUNTIME to 1 (see the FAQ), or make sure to emit a newline when you printf etc."),ye("(this may also be due to not including full filesystem support - try building with -sFORCE_FILESYSTEM)"))}if(je.forEach(S),$=function e(){Ne||Ge(),Ne||($=e)},i["preInit"]){"function"==typeof i["preInit"]&&(i["preInit"]=[i["preInit"]]);while(i["preInit"].length>0)i["preInit"].pop()()}return Ge(),i.ready}}(),o=i;r.default=o}).call(this)}).call(this,e("_process"))},{_process:2}],26:[function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(){}Object.defineProperty(r,"__esModule",{value:!0}),r.logger=r.enableLogs=void 0;var o={trace:i,debug:i,log:i,warn:i,info:i,error:i},a=o;function s(e,t){return t="["+e+"] > "+t,t}function u(e){var t=window.console[e];return t?function(){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];n[0]&&(n[0]=s(e,n[0])),t.apply(window.console,n)}:i}function c(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];r.forEach((function(t){a[t]=e[t]?e[t].bind(e):u(t)}))}var l=function(t){if(!0===t||"object"===n(t)){c(t,"debug","log","info","warn","error");try{a.log()}catch(e){a=o}}else a=o};r.enableLogs=l;var f=a;r.logger=f},{}],27:[function(e,t,r){(function(e){(function(){"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}Object.defineProperty(r,"__esModule",{value:!0}),r.createEncoderWithModule=a,r.createFile=o,r.default=void 0;var n=function(){var r="undefined"!==typeof document&&document.currentScript?document.currentScript.src:void 0;return function(n){n=n||{};var i,o;n="undefined"!=typeof n?n:{};n["ready"]=new Promise((function(e,t){i=e,o=t})),n["createEncoder"]=function(e,t){return a(n,e,t)};var s,u=Object.assign({},n),c=[],l="object"==("undefined"===typeof window?"undefined":t(window)),f="function"==typeof importScripts,d=("object"==("undefined"===typeof e?"undefined":t(e))&&"object"==t(e.versions)&&e.versions.node,"");function h(e){return n["locateFile"]?n["locateFile"](e,d):d+e}(l||f)&&(f?d=self.location.href:"undefined"!=typeof document&&document.currentScript&&(d=document.currentScript.src),r&&(d=r),d=0!==d.indexOf("blob:")?d.substr(0,d.replace(/[?#].*/,"").lastIndexOf("/")+1):"",function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},f&&(s=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){200==n.status||0==n.status&&n.response?t(n.response):r()},n.onerror=r,n.send(null)});n["print"]||console.log.bind(console);var p=n["printErr"]||console.warn.bind(console);Object.assign(n,u),u=null,n["arguments"]&&(c=n["arguments"]),n["thisProgram"]&&n["thisProgram"],n["quit"]&&n["quit"];var y,v=4;n["wasmBinary"]&&(y=n["wasmBinary"]);var m;n["noExitRuntime"];"object"!=("undefined"===typeof WebAssembly?"undefined":t(WebAssembly))&&X("no native wasm support detected");var g,b,_,w,E,A,S,T,k,R=!1;function P(e,t,r){var n=t+r,i="";while(!(t>=n)){var o=e[t++];if(!o)return i;if(128&o){var a=63&e[t++];if(192!=(224&o)){var s=63&e[t++];if(o=224==(240&o)?(15&o)<<12|a<<6|s:(7&o)<<18|a<<12|s<<6|63&e[t++],o<65536)i+=String.fromCharCode(o);else{var u=o-65536;i+=String.fromCharCode(55296|u>>10,56320|1023&u)}}else i+=String.fromCharCode((31&o)<<6|a)}else i+=String.fromCharCode(o)}return i}function O(e,t){return e?P(_,e,t):""}function L(e,t,r,n){if(!(n>0))return 0;for(var i=r,o=r+n-1,a=0;a<e.length;++a){var s=e.charCodeAt(a);if(s>=55296&&s<=57343){var u=e.charCodeAt(++a);s=65536+((1023&s)<<10)|1023&u}if(s<=127){if(r>=o)break;t[r++]=s}else if(s<=2047){if(r+1>=o)break;t[r++]=192|s>>6,t[r++]=128|63&s}else if(s<=65535){if(r+2>=o)break;t[r++]=224|s>>12,t[r++]=128|s>>6&63,t[r++]=128|63&s}else{if(r+3>=o)break;t[r++]=240|s>>18,t[r++]=128|s>>12&63,t[r++]=128|s>>6&63,t[r++]=128|63&s}}return t[r]=0,r-i}function x(e,t,r){return L(e,_,t,r)}function D(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n<=127?t++:n<=2047?t+=2:n>=55296&&n<=57343?(t+=4,++r):t+=3}return t}function C(e){g=e,n["HEAP8"]=b=new Int8Array(e),n["HEAP16"]=w=new Int16Array(e),n["HEAP32"]=A=new Int32Array(e),n["HEAPU8"]=_=new Uint8Array(e),n["HEAPU16"]=E=new Uint16Array(e),n["HEAPU32"]=S=new Uint32Array(e),n["HEAPF32"]=T=new Float32Array(e),n["HEAPF64"]=k=new Float64Array(e)}n["INITIAL_MEMORY"];var I,U=[],M=[],F=[];function N(){if(n["preRun"]){"function"==typeof n["preRun"]&&(n["preRun"]=[n["preRun"]]);while(n["preRun"].length)G(n["preRun"].shift())}re(U)}function j(){!0,re(M)}function B(){if(n["postRun"]){"function"==typeof n["postRun"]&&(n["postRun"]=[n["postRun"]]);while(n["postRun"].length)H(n["postRun"].shift())}re(F)}function G(e){U.unshift(e)}function W(e){M.unshift(e)}function H(e){F.unshift(e)}var V=0,z=null,Y=null;function q(e){V++,n["monitorRunDependencies"]&&n["monitorRunDependencies"](V)}function K(e){if(V--,n["monitorRunDependencies"]&&n["monitorRunDependencies"](V),0==V&&(null!==z&&(clearInterval(z),z=null),Y)){var t=Y;Y=null,t()}}function X(e){n["onAbort"]&&n["onAbort"](e),e="Aborted("+e+")",p(e),R=!0,1,e+=". Build with -sASSERTIONS for more info.";var t=new WebAssembly.RuntimeError(e);throw o(t),t}var J,Z="data:application/octet-stream;base64,";function Q(e){return e.startsWith(Z)}function $(e){try{if(e==J&&y)return new Uint8Array(y);if(s)return s(e);throw"both async and sync fetching of the wasm failed"}catch(e){X(e)}}function ee(){return y||!l&&!f||"function"!=typeof fetch?Promise.resolve().then((function(){return $(J)})):fetch(J,{credentials:"same-origin"}).then((function(e){if(!e["ok"])throw"failed to load wasm binary file at '"+J+"'";return e["arrayBuffer"]()})).catch((function(){return $(J)}))}function te(){var e={a:Pt};function t(e,t){var r=e.exports;n["asm"]=r,m=n["asm"]["x"],C(m.buffer),I=n["asm"]["B"],W(n["asm"]["y"]),K("wasm-instantiate")}function r(e){t(e["instance"])}function i(t){return ee().then((function(t){return WebAssembly.instantiate(t,e)})).then((function(e){return e})).then(t,(function(e){p("failed to asynchronously prepare wasm: "+e),X(e)}))}function a(){return y||"function"!=typeof WebAssembly.instantiateStreaming||Q(J)||"function"!=typeof fetch?i(r):fetch(J,{credentials:"same-origin"}).then((function(t){var n=WebAssembly.instantiateStreaming(t,e);return n.then(r,(function(e){return p("wasm streaming compile failed: "+e),p("falling back to ArrayBuffer instantiation"),i(r)}))}))}if(q("wasm-instantiate"),n["instantiateWasm"])try{var s=n["instantiateWasm"](e,t);return s}catch(a){return p("Module.instantiateWasm callback failed with error: "+a),!1}return a().catch(o),{}}function re(e){while(e.length>0)e.shift()(n)}function ne(e,t,r,n){X("Assertion failed: "+O(e)+", at: "+[t?O(t):"unknown filename",r,n?O(n):"unknown function"])}function ie(e,t,r,n,i){}function oe(e){switch(e){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+e)}}function ae(){for(var e=new Array(256),t=0;t<256;++t)e[t]=String.fromCharCode(t);se=e}J="mp4-encoder.wasm",Q(J)||(J=h(J));var se=void 0;function ue(e){var t="",r=e;while(_[r])t+=se[_[r++]];return t}var ce={},le={},fe={},de=48,he=57;function pe(e){if(void 0===e)return"_unknown";e=e.replace(/[^a-zA-Z0-9_]/g,"$");var t=e.charCodeAt(0);return t>=de&&t<=he?"_"+e:e}function ye(e,t){return e=pe(e),new Function("body","return function "+e+'() {\n    "use strict";    return body.apply(this, arguments);\n};\n')(t)}function ve(e,t){var r=ye(t,(function(e){this.name=t,this.message=e;var r=new Error(e).stack;void 0!==r&&(this.stack=this.toString()+"\n"+r.replace(/^Error(:[^\n]*)?\n/,""))}));return r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.prototype.toString=function(){return void 0===this.message?this.name:this.name+": "+this.message},r}var me=void 0;function ge(e){throw new me(e)}var be=void 0;function _e(e){throw new be(e)}function we(e,t,r){function n(t){var n=r(t);n.length!==e.length&&_e("Mismatched type converter count");for(var i=0;i<e.length;++i)Ee(e[i],n[i])}e.forEach((function(e){fe[e]=t}));var i=new Array(t.length),o=[],a=0;t.forEach((function(e,t){le.hasOwnProperty(e)?i[t]=le[e]:(o.push(e),ce.hasOwnProperty(e)||(ce[e]=[]),ce[e].push((function(){i[t]=le[e],++a,a===o.length&&n(i)})))})),0===o.length&&n(i)}function Ee(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!("argPackAdvance"in t))throw new TypeError("registerType registeredInstance requires argPackAdvance");var n=t.name;if(e||ge('type "'+n+'" must have a positive integer typeid pointer'),le.hasOwnProperty(e)){if(r.ignoreDuplicateRegistrations)return;ge("Cannot register type '"+n+"' twice")}if(le[e]=t,delete fe[e],ce.hasOwnProperty(e)){var i=ce[e];delete ce[e],i.forEach((function(e){return e()}))}}function Ae(e,t,r,n,i){var o=oe(r);t=ue(t),Ee(e,{name:t,fromWireType:function(e){return!!e},toWireType:function(e,t){return t?n:i},argPackAdvance:8,readValueFromPointer:function(e){var n;if(1===r)n=b;else if(2===r)n=w;else{if(4!==r)throw new TypeError("Unknown boolean type size: "+t);n=A}return this["fromWireType"](n[e>>o])},destructorFunction:null})}var Se=[],Te=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function ke(e){e>4&&0===--Te[e].refcount&&(Te[e]=void 0,Se.push(e))}function Re(){for(var e=0,t=5;t<Te.length;++t)void 0!==Te[t]&&++e;return e}function Pe(){for(var e=5;e<Te.length;++e)if(void 0!==Te[e])return Te[e];return null}function Oe(){n["count_emval_handles"]=Re,n["get_first_emval"]=Pe}var Le={toValue:function(e){return e||ge("Cannot use deleted val. handle = "+e),Te[e].value},toHandle:function(e){switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var t=Se.length?Se.pop():Te.length;return Te[t]={refcount:1,value:e},t}}};function xe(e){return this["fromWireType"](A[e>>2])}function De(e,t){t=ue(t),Ee(e,{name:t,fromWireType:function(e){var t=Le.toValue(e);return ke(e),t},toWireType:function(e,t){return Le.toHandle(t)},argPackAdvance:8,readValueFromPointer:xe,destructorFunction:null})}function Ce(e,t){switch(t){case 2:return function(e){return this["fromWireType"](T[e>>2])};case 3:return function(e){return this["fromWireType"](k[e>>3])};default:throw new TypeError("Unknown float type: "+e)}}function Ie(e,t,r){var n=oe(r);t=ue(t),Ee(e,{name:t,fromWireType:function(e){return e},toWireType:function(e,t){return t},argPackAdvance:8,readValueFromPointer:Ce(t,n),destructorFunction:null})}function Ue(e,r){if(!(e instanceof Function))throw new TypeError("new_ called with constructor type "+t(e)+" which is not a function");var n=ye(e.name||"unknownFunctionName",(function(){}));n.prototype=e.prototype;var i=new n,o=e.apply(i,r);return o instanceof Object?o:i}function Me(e){while(e.length){var t=e.pop(),r=e.pop();r(t)}}function Fe(e,t,r,n,i){var o=t.length;o<2&&ge("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var a=null!==t[1]&&null!==r,s=!1,u=1;u<t.length;++u)if(null!==t[u]&&void 0===t[u].destructorFunction){s=!0;break}var c="void"!==t[0].name,l="",f="";for(u=0;u<o-2;++u)l+=(0!==u?", ":"")+"arg"+u,f+=(0!==u?", ":"")+"arg"+u+"Wired";var d="return function "+pe(e)+"("+l+") {\nif (arguments.length !== "+(o-2)+") {\nthrowBindingError('function "+e+" called with ' + arguments.length + ' arguments, expected "+(o-2)+" args!');\n}\n";s&&(d+="var destructors = [];\n");var h=s?"destructors":"null",p=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],y=[ge,n,i,Me,t[0],t[1]];a&&(d+="var thisWired = classParam.toWireType("+h+", this);\n");for(u=0;u<o-2;++u)d+="var arg"+u+"Wired = argType"+u+".toWireType("+h+", arg"+u+"); // "+t[u+2].name+"\n",p.push("argType"+u),y.push(t[u+2]);if(a&&(f="thisWired"+(f.length>0?", ":"")+f),d+=(c?"var rv = ":"")+"invoker(fn"+(f.length>0?", ":"")+f+");\n",s)d+="runDestructors(destructors);\n";else for(u=a?1:2;u<t.length;++u){var v=1===u?"thisWired":"arg"+(u-2)+"Wired";null!==t[u].destructorFunction&&(d+=v+"_dtor("+v+"); // "+t[u].name+"\n",p.push(v+"_dtor"),y.push(t[u].destructorFunction))}c&&(d+="var ret = retType.fromWireType(rv);\nreturn ret;\n"),d+="}\n",p.push(d);var m=Ue(Function,p).apply(null,y);return m}function Ne(e,t,r){if(void 0===e[t].overloadTable){var n=e[t];e[t]=function(){return e[t].overloadTable.hasOwnProperty(arguments.length)||ge("Function '"+r+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+e[t].overloadTable+")!"),e[t].overloadTable[arguments.length].apply(this,arguments)},e[t].overloadTable=[],e[t].overloadTable[n.argCount]=n}}function je(e,t,r){n.hasOwnProperty(e)?((void 0===r||void 0!==n[e].overloadTable&&void 0!==n[e].overloadTable[r])&&ge("Cannot register public name '"+e+"' twice"),Ne(n,e,e),n.hasOwnProperty(r)&&ge("Cannot register multiple overloads of a function with the same number of arguments ("+r+")!"),n[e].overloadTable[r]=t):(n[e]=t,void 0!==r&&(n[e].numArguments=r))}function Be(e,t){for(var r=[],n=0;n<e;n++)r.push(S[t+4*n>>2]);return r}function Ge(e,t,r){n.hasOwnProperty(e)||_e("Replacing nonexistant public symbol"),void 0!==n[e].overloadTable&&void 0!==r?n[e].overloadTable[r]=t:(n[e]=t,n[e].argCount=r)}function We(e,t,r){var i=n["dynCall_"+e];return r&&r.length?i.apply(null,[t].concat(r)):i.call(null,t)}var He=[];function Ve(e){var t=He[e];return t||(e>=He.length&&(He.length=e+1),He[e]=t=I.get(e)),t}function ze(e,t,r){if(e.includes("j"))return We(e,t,r);var n=Ve(t).apply(null,r);return n}function Ye(e,t){var r=[];return function(){return r.length=0,Object.assign(r,arguments),ze(e,t,r)}}function qe(e,t){function r(){return e.includes("j")?Ye(e,t):Ve(t)}e=ue(e);var n=r();return"function"!=typeof n&&ge("unknown function pointer with signature "+e+": "+t),n}var Ke=void 0;function Xe(e){var t=xt(e),r=ue(t);return Lt(t),r}function Je(e,t){var r=[],n={};function i(e){n[e]||le[e]||(fe[e]?fe[e].forEach(i):(r.push(e),n[e]=!0))}throw t.forEach(i),new Ke(e+": "+r.map(Xe).join([", "]))}function Ze(e,t,r,n,i,o){var a=Be(t,r);e=ue(e),i=qe(n,i),je(e,(function(){Je("Cannot call "+e+" due to unbound types",a)}),t-1),we([],a,(function(r){var n=[r[0],null].concat(r.slice(1));return Ge(e,Fe(e,n,null,i,o),t-1),[]}))}function Qe(e,t,r){switch(t){case 0:return r?function(e){return b[e]}:function(e){return _[e]};case 1:return r?function(e){return w[e>>1]}:function(e){return E[e>>1]};case 2:return r?function(e){return A[e>>2]}:function(e){return S[e>>2]};default:throw new TypeError("Unknown integer type: "+e)}}function $e(e,t,r,n,i){t=ue(t),-1===i&&(i=4294967295);var o=oe(r),a=function(e){return e};if(0===n){var s=32-8*r;a=function(e){return e<<s>>>s}}var u,c=t.includes("unsigned"),l=function(e,t){};u=c?function(e,t){return l(t,this.name),t>>>0}:function(e,t){return l(t,this.name),t},Ee(e,{name:t,fromWireType:a,toWireType:u,argPackAdvance:8,readValueFromPointer:Qe(t,o,0!==n),destructorFunction:null})}function et(e,t,r){var n=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],i=n[t];function o(e){e>>=2;var t=S,r=t[e],n=t[e+1];return new i(g,n,r)}r=ue(r),Ee(e,{name:r,fromWireType:o,argPackAdvance:8,readValueFromPointer:o},{ignoreDuplicateRegistrations:!0})}function tt(e,t){t=ue(t);var r="std::string"===t;Ee(e,{name:t,fromWireType:function(e){var t,n=S[e>>2],i=e+4;if(r)for(var o=i,a=0;a<=n;++a){var s=i+a;if(a==n||0==_[s]){var u=s-o,c=O(o,u);void 0===t?t=c:(t+=String.fromCharCode(0),t+=c),o=s+1}}else{var l=new Array(n);for(a=0;a<n;++a)l[a]=String.fromCharCode(_[i+a]);t=l.join("")}return Lt(e),t},toWireType:function(e,t){var n;t instanceof ArrayBuffer&&(t=new Uint8Array(t));var i="string"==typeof t;i||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int8Array||ge("Cannot pass non-string to std::string"),n=r&&i?D(t):t.length;var o=Ot(4+n+1),a=o+4;if(S[o>>2]=n,r&&i)x(t,a,n+1);else if(i)for(var s=0;s<n;++s){var u=t.charCodeAt(s);u>255&&(Lt(a),ge("String has UTF-16 code units that do not fit in 8 bits")),_[a+s]=u}else for(s=0;s<n;++s)_[a+s]=t[s];return null!==e&&e.push(Lt,o),o},argPackAdvance:8,readValueFromPointer:xe,destructorFunction:function(e){Lt(e)}})}function rt(e,t){for(var r="",n=0;!(n>=t/2);++n){var i=w[e+2*n>>1];if(0==i)break;r+=String.fromCharCode(i)}return r}function nt(e,t,r){if(void 0===r&&(r=2147483647),r<2)return 0;r-=2;for(var n=t,i=r<2*e.length?r/2:e.length,o=0;o<i;++o){var a=e.charCodeAt(o);w[t>>1]=a,t+=2}return w[t>>1]=0,t-n}function it(e){return 2*e.length}function ot(e,t){var r=0,n="";while(!(r>=t/4)){var i=A[e+4*r>>2];if(0==i)break;if(++r,i>=65536){var o=i-65536;n+=String.fromCharCode(55296|o>>10,56320|1023&o)}else n+=String.fromCharCode(i)}return n}function at(e,t,r){if(void 0===r&&(r=2147483647),r<4)return 0;for(var n=t,i=n+r-4,o=0;o<e.length;++o){var a=e.charCodeAt(o);if(a>=55296&&a<=57343){var s=e.charCodeAt(++o);a=65536+((1023&a)<<10)|1023&s}if(A[t>>2]=a,t+=4,t+4>i)break}return A[t>>2]=0,t-n}function st(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n>=55296&&n<=57343&&++r,t+=4}return t}function ut(e,t,r){var n,i,o,a,s;r=ue(r),2===t?(n=rt,i=nt,a=it,o=function(){return E},s=1):4===t&&(n=ot,i=at,a=st,o=function(){return S},s=2),Ee(e,{name:r,fromWireType:function(e){for(var r,i=S[e>>2],a=o(),u=e+4,c=0;c<=i;++c){var l=e+4+c*t;if(c==i||0==a[l>>s]){var f=l-u,d=n(u,f);void 0===r?r=d:(r+=String.fromCharCode(0),r+=d),u=l+t}}return Lt(e),r},toWireType:function(e,n){"string"!=typeof n&&ge("Cannot pass non-string to C++ string type "+r);var o=a(n),u=Ot(4+o+t);return S[u>>2]=o>>s,i(n,u+4,o+t),null!==e&&e.push(Lt,u),u},argPackAdvance:8,readValueFromPointer:xe,destructorFunction:function(e){Lt(e)}})}function ct(e,t){t=ue(t),Ee(e,{isVoid:!0,name:t,argPackAdvance:0,fromWireType:function(){},toWireType:function(e,t){}})}function lt(e,t){var r=le[e];return void 0===r&&ge(t+" has unknown type "+Xe(e)),r}function ft(e,t,r){e=Le.toValue(e),t=lt(t,"emval::as");var n=[],i=Le.toHandle(n);return S[r>>2]=i,t["toWireType"](n,e)}function dt(e,t){for(var r=new Array(e),n=0;n<e;++n)r[n]=lt(S[t+n*v>>2],"parameter "+n);return r}function ht(e,t,r,n){e=Le.toValue(e);for(var i=dt(t,r),o=new Array(t),a=0;a<t;++a){var s=i[a];o[a]=s["readValueFromPointer"](n),n+=s["argPackAdvance"]}var u=e.apply(void 0,o);return Le.toHandle(u)}function pt(e,t){return e=Le.toValue(e),t=Le.toValue(t),Le.toHandle(e[t])}function yt(e){e>4&&(Te[e].refcount+=1)}function vt(e){return e=Le.toValue(e),"number"==typeof e}var mt={};function gt(e){var t=mt[e];return void 0===t?ue(e):t}function bt(e){return Le.toHandle(gt(e))}function _t(e){var t=Le.toValue(e);Me(t),ke(e)}function wt(e,t){e=lt(e,"_emval_take_value");var r=e["readValueFromPointer"](t);return Le.toHandle(r)}function Et(){X("")}function At(e,t,r){_.copyWithin(e,t,t+r)}function St(){return 2147483648}function Tt(e){try{return m.grow(e-g.byteLength+65535>>>16),C(m.buffer),1}catch(e){}}function kt(e){var t=_.length;e>>>=0;var r=St();if(e>r)return!1;for(var n=function(e,t){return e+(t-e%t)%t},i=1;i<=4;i*=2){var o=t*(1+.2/i);o=Math.min(o,e+100663296);var a=Math.min(r,n(Math.max(e,o),65536)),s=Tt(a);if(s)return!0}return!1}ae(),me=n["BindingError"]=ve(Error,"BindingError"),be=n["InternalError"]=ve(Error,"InternalError"),Oe(),Ke=n["UnboundTypeError"]=ve(Error,"UnboundTypeError");var Rt,Pt={b:ne,q:ie,u:Ae,t:De,o:Ie,f:Ze,d:$e,c:et,n:tt,l:ut,v:ct,j:ft,w:ht,a:ke,e:pt,h:yt,p:vt,g:bt,i:_t,k:wt,m:Et,s:At,r:kt},Ot=(te(),n["___wasm_call_ctors"]=function(){return(n["___wasm_call_ctors"]=n["asm"]["y"]).apply(null,arguments)},n["_malloc"]=function(){return(Ot=n["_malloc"]=n["asm"]["z"]).apply(null,arguments)}),Lt=n["_free"]=function(){return(Lt=n["_free"]=n["asm"]["A"]).apply(null,arguments)},xt=n["___getTypeName"]=function(){return(xt=n["___getTypeName"]=n["asm"]["C"]).apply(null,arguments)};n["__embind_initialize_bindings"]=function(){return(n["__embind_initialize_bindings"]=n["asm"]["D"]).apply(null,arguments)},n["dynCall_ijiii"]=function(){return(n["dynCall_ijiii"]=n["asm"]["E"]).apply(null,arguments)};function Dt(e){function t(){Rt||(Rt=!0,n["calledRun"]=!0,R||(j(),i(n),n["onRuntimeInitialized"]&&n["onRuntimeInitialized"](),B()))}e=e||c,V>0||(N(),V>0||(n["setStatus"]?(n["setStatus"]("Running..."),setTimeout((function(){setTimeout((function(){n["setStatus"]("")}),1),t()}),1)):t()))}if(Y=function e(){Rt||Dt(),Rt||(Y=e)},n["preInit"]){"function"==typeof n["preInit"]&&(n["preInit"]=[n["preInit"]]);while(n["preInit"].length>0)n["preInit"].pop()()}return Dt(),n.ready}}(),i=n;function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:256,t=0,r=0,n=new Uint8Array(e);return{contents:function(){return n.slice(0,r)},seek:function(e){t=e},write:function(e){var o=e.byteLength;return i(t+o),n.set(e,t),t+=o,r=Math.max(r,t),o}};function i(e){var t=n.length;if(!(t>=e)){var i=1048576;e=Math.max(e,t*(t<i?2:1.125)>>>0),0!=t&&(e=Math.max(e,256));var o=n;n=new Uint8Array(e),r>0&&n.set(o.subarray(0,r),0)}}}function a(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=t.width,i=t.height,a=t.fps,s=void 0===a?30:a,u=t.fragmentation,c=void 0!==u&&u,l=t.sequential,f=void 0!==l&&l,d=t.hevc,h=void 0!==d&&d,p=t.audio_channel_count,y=void 0===p?0:p;if("number"!==typeof n||"number"!==typeof i)throw new Error("Must specify { width, height } options");if(!isFinite(n)||n<0||!isFinite(i)||i<0)throw new Error("{ width, height } options must be positive integers");var v=o(),m=null,g=0;y>0&&(g=r.byteLength,m=e._malloc(r.byteLength),e.HEAPU8.set(r,m));var b=e.create_muxer({width:n,height:i,fps:s,fragmentation:c,sequential:f,hevc:h,audio_channel_count:y},_,m,g);return m&&e._free(m),{end:function(){return e.finalize_muxer(b),v.contents()},addNalu:function(t,r){var n=e._malloc(t.byteLength);e.HEAPU8.set(t,n),e.mux_nal(b,n,t.byteLength,r),e._free(n)},addAAC:function(t,r){var n=e._malloc(t.byteLength);e.HEAPU8.set(t,n),e.mux_aac(b,n,t.byteLength,r),e._free(n)}};function _(t,r,n){v.seek(n);var i=e.HEAPU8.subarray(t,t+r);return v.write(i)!==i.byteLength}}r.default=i,n.createFile=o}).call(this)}).call(this,e("_process"))},{_process:2}],28:[function(e,t,r){"use strict";"undefined"===typeof ArrayBuffer||ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(e,t){var r=new Uint8Array(this);void 0===t&&(t=r.length);for(var n=new ArrayBuffer(t-e),i=new Uint8Array(n),o=0;o<i.length;o++)i[o]=r[o+e];return n})},{}],29:[function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,s(n.key),n)}}function a(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e){var t=u(e,"string");return"symbol"===n(t)?t:String(t)}function u(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!==n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var c=["attribute vec4 vertexPos;","attribute vec2 texturePos;","varying vec2 textureCoord;","void main() {","    gl_Position = vertexPos;","    textureCoord = texturePos;","}"].join("\n"),l=["precision highp float;","varying highp vec2 textureCoord;","uniform sampler2D ySampler;","uniform sampler2D uSampler;","uniform sampler2D vSampler;","const mat4 YUV2RGB = mat4(","    1.1643828125, 0, 1.59602734375, -.87078515625,","    1.1643828125, -.39176171875, -.81296875, .52959375,","    1.1643828125, 2.017234375, 0, -1.081390625,","    0, 0, 0, 1",");","void main(void) {","    highp float y = texture2D(ySampler,  textureCoord).r;","    highp float u = texture2D(uSampler,  textureCoord).r;","    highp float v = texture2D(vSampler,  textureCoord).r;","    gl_FragColor = vec4(y, u, v, 1) * YUV2RGB;","}"].join("\n");function f(e){var t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),t}var d=function(){function e(t){i(this,e),this.canvas=t,this.gl=this.canvas.getContext("webgl")||this.canvas.getContext("experimental-webgl"),this.initGL()}return a(e,[{key:"initGL",value:function(){if(this.gl){var e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,1);var t=e.createShader(e.VERTEX_SHADER),r=e.createShader(e.FRAGMENT_SHADER),n=e.createProgram();t&&r&&n||console.warn("shaders create failed"),e.shaderSource(t,c),e.compileShader(t),e.getShaderParameter(t,e.COMPILE_STATUS)||console.warn("Vertex shader failed to compile: ",e.getShaderInfoLog(t)),e.shaderSource(r,l),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)||console.log("Fragment shader failed to compile: ",e.getShaderInfoLog(r)),e.attachShader(n,t),e.attachShader(n,r),e.linkProgram(n),e.getProgramParameter(n,e.LINK_STATUS)||console.log("Program failed to compile: ",e.getProgramInfoLog(n)),e.useProgram(n),e.bindBuffer(e.ARRAY_BUFFER,e.createBuffer()),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,1,-1,-1,1,-1,-1]),e.STATIC_DRAW);var i=e.getAttribLocation(n,"vertexPos");e.enableVertexAttribArray(i),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,e.createBuffer()),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,1,0,1,1,0,1,0,0,1,0,0]),e.STATIC_DRAW);var o=e.getAttribLocation(n,"texturePos");e.enableVertexAttribArray(o),e.vertexAttribPointer(o,2,e.FLOAT,!1,0,0),this.yTexture=f(e);var a=e.getUniformLocation(n,"ySampler");e.uniform1i(a,0),this.uTexture=f(e);var s=e.getUniformLocation(n,"uSampler");e.uniform1i(s,1),this.vTexture=f(e);var u=e.getUniformLocation(n,"vSampler");e.uniform1i(u,2)}else console.log("[ER] WebGL not supported.")}},{key:"renderFrame",value:function(e,t,r,n,i,o,a){if(this.gl){var s=this.gl,u=t*r;s.viewport(n,i,o,a);var c=u,l=e.subarray(0,c);s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.yTexture),s.texImage2D(s.TEXTURE_2D,0,s.LUMINANCE,t,r,0,s.LUMINANCE,s.UNSIGNED_BYTE,l);var f=u/4,d=e.subarray(c,c+f);s.activeTexture(s.TEXTURE1),s.bindTexture(s.TEXTURE_2D,this.uTexture),s.texImage2D(s.TEXTURE_2D,0,s.LUMINANCE,t/2,r/2,0,s.LUMINANCE,s.UNSIGNED_BYTE,d);var h=f,p=e.subarray(c+f,c+f+h);s.activeTexture(s.TEXTURE2),s.bindTexture(s.TEXTURE_2D,this.vTexture),s.texImage2D(s.TEXTURE_2D,0,s.LUMINANCE,t/2,r/2,0,s.LUMINANCE,s.UNSIGNED_BYTE,p),s.drawArrays(s.TRIANGLES,0,6)}else console.log("[ER] Render frame failed due to WebGL not supported.")}},{key:"fullscreen",value:function(){var e=this.canvas;e.RequestFullScreen?e.RequestFullScreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():alert("This browser doesn't supporter fullscreen")}},{key:"exitfullscreen",value:function(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():alert("Exit fullscreen doesn't work")}},{key:"setSize",value:function(e,t,r){var n=Math.min(r,e);this.canvas.width=n,this.canvas.height=n*t/e}}]),e}();r.default=d},{}],30:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("./errors"),i=c(e("./events")),o=c(e("./controller/flow-controller")),a=c(e("./controller/buffer-controller")),s=c(e("events")),u=c(e("./loader/websocket-loader"));function c(e){return e&&e.__esModule?e:{default:e}}function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,p(n.key),n)}}function h(e,t,r){return t&&d(e.prototype,t),r&&d(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function p(e){var t=y(e,"string");return"symbol"===l(t)?t:String(t)}function y(e,t){if("object"!==l(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==l(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var v=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};f(this,e);var r=e.DefaultConfig;for(var n in r)n in t||(t[n]=r[n]);this.config=t;var i=this.observer=new s.default;i.trigger=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];i.emit.apply(i,[e,e].concat(r))},i.off=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];i.removeListener.apply(i,[e].concat(r))},this.on=i.on.bind(i),this.off=i.off.bind(i),this.trigger=i.trigger.bind(i),this.flowController=new o.default(this),this.bufferController=new a.default(this),this.websocketLoader=new u.default(this),this.mediaType=void 0,this.extraData=void 0,this.audioInfo={client:null,websocketName:"",mediaType:"aac",sampleRate:16e3,numChannels:this.aenc_num_channels,bitWidth:this.aenc_bit_width}}return h(e,[{key:"destroy",value:function(){console.log("wfs destroy +++"),this.flowController.destroy(),this.bufferController.destroy(),this.websocketLoader.destroy(),console.log("wfs destroy ---")}},{key:"attachMedia",value:function(t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"H264Raw",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"play2",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0;this.mediaType=r,this.media=t,this.extraData=o,this.audioInfo=a;var s=void 0;switch(r){case"MJPEG":s=i.default.MEDIA_ATTACHED;break;case"H265Raw":s=e.isSupportedHEVC()?i.default.MEDIA_ATTACHING:i.default.MEDIA_ATTACHED;break;case"H264Raw":default:s=i.default.MEDIA_ATTACHING;break}this.trigger(s,{media:t,mediaType:r,websocketName:n,extraData:this.extraData,audioInfo:this.audioInfo})}},{key:"attachWebsocket",value:function(e,t){console.log("attachWebsocket: mediaType="+this.mediaType),this.trigger(i.default.WEBSOCKET_ATTACHING,{websocket:e,media:this.media,mediaType:this.mediaType,extraData:this.extraData,audioInfo:t})}},{key:"start_recording",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1073741824,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;this.trigger(i.default.RECORDING_START,{rec_file_threshold:e,result_cb:t,state_cb:r})}},{key:"playerSeekNow",value:function(){this.trigger(i.default.PLAYER_SEEK_NOW)}},{key:"stop_recording",value:function(){this.trigger(i.default.RECORDING_STOP)}}],[{key:"version",get:function(){return"v.0.0.0.1"}},{key:"isSupported",value:function(){return window.MediaSource&&"function"===typeof window.MediaSource.isTypeSupported&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42c01f,mp4a.40.2"')}},{key:"isSupportedHEVC",value:function(){return window.MediaSource&&"function"===typeof window.MediaSource.isTypeSupported&&window.MediaSource.isTypeSupported('video/mp4; codecs="hvc1.1.6.L93.B0"')}},{key:"canPlayByVideo",value:function(t){var r=!0;return"MJPEG"===t?r=!1:"H265Raw"===t&&(r=e.isSupportedHEVC()),r}},{key:"Events",get:function(){return i.default}},{key:"ErrorTypes",get:function(){return n.ErrorTypes}},{key:"ErrorDetails",get:function(){return n.ErrorDetails}},{key:"DefaultConfig",get:function(){return e.defaultConfig||(e.defaultConfig={debug:!1,videoReady:!1,forceKeyFrameOnDiscontinuity:!0,appendErrorMaxRetry:3,wsMinPacketInterval:3e3,wsMaxPacketInterval:3e4,mode:"both",mp4Duration:1e3,fps:30,timescale:9e4,recording:!1,audioCodecs:"mp4a.40.2"}),e.defaultConfig},set:function(t){e.defaultConfig=t}}]),e}(),m=v;r.default=m},{"./controller/buffer-controller":8,"./controller/flow-controller":9,"./errors":12,"./events":14,"./loader/websocket-loader":22,events:1}]},{},[21])(21)}))},3013:function(e){e.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},260:function(e,t,r){"use strict";var n,i,o,a=r(3013),s=r(9781),u=r(7854),c=r(614),l=r(111),f=r(2597),d=r(648),h=r(6330),p=r(8880),y=r(8052),v=r(3070).f,m=r(7976),g=r(9518),b=r(7674),_=r(5112),w=r(9711),E=r(9909),A=E.enforce,S=E.get,T=u.Int8Array,k=T&&T.prototype,R=u.Uint8ClampedArray,P=R&&R.prototype,O=T&&g(T),L=k&&g(k),x=Object.prototype,D=u.TypeError,C=_("toStringTag"),I=w("TYPED_ARRAY_TAG"),U="TypedArrayConstructor",M=a&&!!b&&"Opera"!==d(u.opera),F=!1,N={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},j={BigInt64Array:8,BigUint64Array:8},B=function(e){if(!l(e))return!1;var t=d(e);return"DataView"===t||f(N,t)||f(j,t)},G=function(e){var t=g(e);if(l(t)){var r=S(t);return r&&f(r,U)?r[U]:G(t)}},W=function(e){if(!l(e))return!1;var t=d(e);return f(N,t)||f(j,t)},H=function(e){if(W(e))return e;throw D("Target is not a typed array")},V=function(e){if(c(e)&&(!b||m(O,e)))return e;throw D(h(e)+" is not a typed array constructor")},z=function(e,t,r,n){if(s){if(r)for(var i in N){var o=u[i];if(o&&f(o.prototype,e))try{delete o.prototype[e]}catch(a){try{o.prototype[e]=t}catch(c){}}}L[e]&&!r||y(L,e,r?t:M&&k[e]||t,n)}},Y=function(e,t,r){var n,i;if(s){if(b){if(r)for(n in N)if(i=u[n],i&&f(i,e))try{delete i[e]}catch(o){}if(O[e]&&!r)return;try{return y(O,e,r?t:M&&O[e]||t)}catch(o){}}for(n in N)i=u[n],!i||i[e]&&!r||y(i,e,t)}};for(n in N)i=u[n],o=i&&i.prototype,o?A(o)[U]=i:M=!1;for(n in j)i=u[n],o=i&&i.prototype,o&&(A(o)[U]=i);if((!M||!c(O)||O===Function.prototype)&&(O=function(){throw D("Incorrect invocation")},M))for(n in N)u[n]&&b(u[n],O);if((!M||!L||L===x)&&(L=O.prototype,M))for(n in N)u[n]&&b(u[n].prototype,L);if(M&&g(P)!==L&&b(P,L),s&&!f(L,C))for(n in F=!0,v(L,C,{get:function(){return l(this)?this[I]:void 0}}),N)u[n]&&p(u[n],I,n);e.exports={NATIVE_ARRAY_BUFFER_VIEWS:M,TYPED_ARRAY_TAG:F&&I,aTypedArray:H,aTypedArrayConstructor:V,exportTypedArrayMethod:z,exportTypedArrayStaticMethod:Y,getTypedArrayConstructor:G,isView:B,isTypedArray:W,TypedArray:O,TypedArrayPrototype:L}},7745:function(e,t,r){var n=r(6244);e.exports=function(e,t){var r=0,i=n(t),o=new e(i);while(i>r)o[r]=t[r++];return o}},9671:function(e,t,r){var n=r(9974),i=r(8361),o=r(7908),a=r(6244),s=function(e){var t=1==e;return function(r,s,u){var c,l,f=o(r),d=i(f),h=n(s,u),p=a(d);while(p-- >0)if(c=d[p],l=h(c,p,f),l)switch(e){case 0:return c;case 1:return p}return t?-1:void 0}};e.exports={findLast:s(0),findLastIndex:s(1)}},1843:function(e,t,r){var n=r(6244);e.exports=function(e,t){for(var r=n(e),i=new t(r),o=0;o<r;o++)i[o]=e[r-o-1];return i}},1572:function(e,t,r){var n=r(6244),i=r(9303),o=RangeError;e.exports=function(e,t,r,a){var s=n(e),u=i(r),c=u<0?s+u:u;if(c>=s||c<0)throw o("Incorrect index");for(var l=new t(s),f=0;f<s;f++)l[f]=f===c?a:e[f];return l}},8544:function(e,t,r){var n=r(7293);e.exports=!n((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},7045:function(e,t,r){var n=r(6339),i=r(3070);e.exports=function(e,t,r){return r.get&&n(r.get,t,{getter:!0}),r.set&&n(r.set,t,{setter:!0}),i.f(e,t,r)}},5117:function(e,t,r){"use strict";var n=r(6330),i=TypeError;e.exports=function(e,t){if(!delete e[t])throw i("Cannot delete property "+n(t)+" of "+n(e))}},9974:function(e,t,r){var n=r(1702),i=r(9662),o=r(4374),a=n(n.bind);e.exports=function(e,t){return i(e),void 0===t?e:o?a(e,t):function(){return e.apply(t,arguments)}}},4067:function(e,t,r){var n=r(648),i=r(1702),o=i("".slice);e.exports=function(e){return"Big"===o(n(e),0,3)}},9518:function(e,t,r){var n=r(2597),i=r(614),o=r(7908),a=r(6200),s=r(8544),u=a("IE_PROTO"),c=Object,l=c.prototype;e.exports=s?c.getPrototypeOf:function(e){var t=o(e);if(n(t,u))return t[u];var r=t.constructor;return i(r)&&t instanceof r?r.prototype:t instanceof c?l:null}},7066:function(e,t,r){"use strict";var n=r(9670);e.exports=function(){var e=n(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}},4599:function(e,t,r){var n=r(7593),i=TypeError;e.exports=function(e){var t=n(e,"number");if("number"==typeof t)throw i("Can't convert number to bigint");return BigInt(t)}},541:function(e,t,r){"use strict";var n=r(2109),i=r(7908),o=r(6244),a=r(3658),s=r(5117),u=r(7207),c=1!==[].unshift(0),l=!function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(e){return e instanceof TypeError}}();n({target:"Array",proto:!0,arity:1,forced:c||l},{unshift:function(e){var t=i(this),r=o(t),n=arguments.length;if(n){u(r+n);var c=r;while(c--){var l=c+n;c in t?t[l]=t[c]:s(t,l)}for(var f=0;f<n;f++)t[f]=arguments[f]}return a(t,r+n)}})},2087:function(e,t,r){var n=r(7854),i=r(9781),o=r(7045),a=r(7066),s=r(7293),u=n.RegExp,c=u.prototype,l=i&&s((function(){var e=!0;try{u(".","d")}catch(l){e=!1}var t={},r="",n=e?"dgimsy":"gimsy",i=function(e,n){Object.defineProperty(t,e,{get:function(){return r+=n,!0}})},o={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var a in e&&(o.hasIndices="d"),o)i(a,o[a]);var s=Object.getOwnPropertyDescriptor(c,"flags").get.call(t);return s!==n||r!==n}));l&&o(c,"flags",{configurable:!0,get:a})},8675:function(e,t,r){"use strict";var n=r(260),i=r(6244),o=r(9303),a=n.aTypedArray,s=n.exportTypedArrayMethod;s("at",(function(e){var t=a(this),r=i(t),n=o(e),s=n>=0?n:r+n;return s<0||s>=r?void 0:t[s]}))},4590:function(e,t,r){"use strict";var n=r(260),i=r(9671).findLastIndex,o=n.aTypedArray,a=n.exportTypedArrayMethod;a("findLastIndex",(function(e){return i(o(this),e,arguments.length>1?arguments[1]:void 0)}))},3408:function(e,t,r){"use strict";var n=r(260),i=r(9671).findLast,o=n.aTypedArray,a=n.exportTypedArrayMethod;a("findLast",(function(e){return i(o(this),e,arguments.length>1?arguments[1]:void 0)}))},3767:function(e,t,r){"use strict";var n=r(1843),i=r(260),o=i.aTypedArray,a=i.exportTypedArrayMethod,s=i.getTypedArrayConstructor;a("toReversed",(function(){return n(o(this),s(this))}))},8585:function(e,t,r){"use strict";var n=r(260),i=r(1702),o=r(9662),a=r(7745),s=n.aTypedArray,u=n.getTypedArrayConstructor,c=n.exportTypedArrayMethod,l=i(n.TypedArrayPrototype.sort);c("toSorted",(function(e){void 0!==e&&o(e);var t=s(this),r=a(u(t),t);return l(r,e)}))},8696:function(e,t,r){"use strict";var n=r(1572),i=r(260),o=r(4067),a=r(9303),s=r(4599),u=i.aTypedArray,c=i.getTypedArrayConstructor,l=i.exportTypedArrayMethod,f=!!function(){try{new Int8Array(1)["with"](2,{valueOf:function(){throw 8}})}catch(e){return 8===e}}();l("with",{with:function(e,t){var r=u(this),i=a(e),l=o(r)?s(t):+t;return n(r,c(r),i,l)}}["with"],!f)}}]);
(self["webpackChunkwebapp"]=self["webpackChunkwebapp"]||[]).push([[559],{1028:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return E}});var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"total_container"},[t("el-container",{staticClass:"preview_outside_container"},[t("el-container",{class:"ai"==e.mode_option?e.snapshotEnable&&e.flashEnable?"preview_main_container_ai_2cap":e.snapshotEnable||e.flashEnable?"preview_main_container_ai_1cap":"preview_main_container_ai":e.snapshotEnable&&e.flashEnable?"preview_main_container_normal_2cap":e.snapshotEnable||e.flashEnable?"preview_main_container_normal_1cap":"preview_main_container_normal"},[t("el-main",{staticClass:"preview_capture_left_container"},[t("el-container",{staticClass:"preview_container",attrs:{id:"video_container_0"}},[t("el-main",{ref:"axMain0",staticClass:"video_container"},[t("video",{directives:[{name:"show",rawName:"v-show",value:e.streamOptions[0].showVideoStatus,expression:"streamOptions[0].showVideoStatus"}],ref:"axVideoRef0",staticClass:"axVideo",attrs:{id:"myVideo0",muted:"isMuted",autoplay:"",playsinline:"",oncontextmenu:"return false;"},domProps:{muted:!0}}),t("canvas",{directives:[{name:"show",rawName:"v-show",value:!e.streamOptions[0].showVideoStatus,expression:"!streamOptions[0].showVideoStatus"}],staticClass:"axVideo2",attrs:{id:"myMjpeg0"}})]),t("el-footer",{staticClass:"video_controls_container",attrs:{height:"30px"}},[t("div",{staticClass:"left_controls_container"},[t("div",{staticClass:"size_option"},[t("el-dropdown",{attrs:{size:"mini",placement:"top-start",trigger:"click"},on:{command:e.changeSizeOption0}},[t("el-button",{staticClass:"el-dropdown-link",attrs:{size:"mini",type:"text"}},[e._v(e._s(e.sizeOptions[e.streamOptions[0].sizeOptionInd].label))]),t("el-dropdown-menu",{attrs:{slot:"dropdown","append-to-body":!1},slot:"dropdown"},e._l(e.sizeOptions,(function(s){return t("el-dropdown-item",{key:s.id,attrs:{command:s.id+"",icon:s.icon}},[e._v(e._s(s.label))])})),1)],1)],1),t("div",[t("el-dropdown",{attrs:{size:"mini",placement:"top",trigger:"click"},on:{command:e.changeStream0}},[t("el-button",{staticClass:"el-dropdown-link",attrs:{size:"mini",type:"text"}},[e._v(e._s(e.streamOptions[0].videoInfo[e.streamOptions[0].streamInd].label))]),t("el-dropdown-menu",{attrs:{slot:"dropdown","-to-body":!1},slot:"dropdown"},e._l(e.streamOptions[0].videoInfo,(function(s){return t("el-dropdown-item",{key:s.id,attrs:{command:s.id+"",icon:s.icon}},[e._v(e._s(s.label))])})),1)],1)],1),t("div",{staticClass:"size_info"},[t("span",[e._v(e._s(this.streamOptions[0].encInfo))])])]),t("div",{staticClass:"right_controls_container"},[t("div",{staticClass:"draw_option"},[t("el-tooltip",{attrs:{effect:"dark",content:e.isEnable3ASR?"关闭3A Sync Ratio":"开启3A Sync Ratio",placement:"top-end",enterable:!1}},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:0===e.pano_sns_id,expression:"pano_sns_id === 0"}],class:{draw_button_enable:e.isEnable3ASR,draw_button_disable:!e.isEnable3ASR},attrs:{icon:"el-icon-refresh"},on:{click:e.change3ASR}})],1)],1),t("div",{staticClass:"draw_option"},[t("el-tooltip",{attrs:{effect:"dark",content:e.isTalking?"停止对讲":"开始对讲",placement:"top-end",enterable:!1}},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.aenc_enable,expression:"aenc_enable"}],class:{draw_button_enable:!e.isTalking,draw_button_disable:e.isTalking},attrs:{size:"mini",icon:"el-icon-microphone"},on:{click:function(t){return e.onStartTalk()}}})],1)],1),t("div",{staticClass:"draw_option"},[t("el-tooltip",{attrs:{effect:"dark",content:e.isMuted?"播音":"静音",placement:"top-end",enterable:!1}},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.aenc_enable,expression:"aenc_enable"}],class:{draw_button_enable:e.isMuted,draw_button_disable:!e.isMuted},attrs:{size:"mini",icon:"el-icon-bell"},on:{click:function(t){return e.onMute()}}})],1)],1),t("div",{staticClass:"trigger_flash"},[t("el-tooltip",{attrs:{effect:"dark",content:"爆闪",placement:"top-end"}},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.streamOptions[0].trigger_attr.trigger_enable,expression:"streamOptions[0].trigger_attr.trigger_enable"}],class:{draw_button_enable:!0,draw_button_disable:!1},attrs:{size:"mini",icon:"el-icon-thumb"},on:{click:function(t){return e.doTriggerFlash(0)}}})],1)],1),t("div",{staticClass:"draw_option"},[t("el-tooltip",{attrs:{effect:"dark",content:"抓拍",placement:"top-end"}},[t("el-button",{class:{draw_button_enable:!0,draw_button_disable:!1},attrs:{size:"mini",icon:"el-icon-camera-solid"},on:{click:function(t){return e.onSnapshot(0)}}})],1)],1),t("div",{staticClass:"draw_option"},[t("el-tooltip",{attrs:{effect:"dark",content:"录入人像信息",placement:"top-end",enterable:!1}},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.isSearchImg&&"facehuman"==e.detect_mode,expression:"isSearchImg && detect_mode == 'facehuman'"}],class:{draw_button_enable:!0,draw_button_disable:!1},attrs:{size:"mini",icon:"el-icon-user-solid"},on:{click:function(t){return e.recordFaceinfo(0)}}})],1)],1),t("div",{staticClass:"draw_option"},[t("el-tooltip",{attrs:{effect:"dark",content:e.streamOptions[0].isRecStart?"停止录像":"开启录像",placement:"top-end",enterable:!1}},[t("el-button",{class:{draw_button_enable:e.streamOptions[0].recEnable,draw_button_disable:!e.streamOptions[0].recEnable},attrs:{size:"mini",disabled:!e.streamOptions[0].recEnable,icon:e.streamOptions[0].recIcon},on:{click:function(t){return e.onRecording(0)}}})],1)],1),t("div",{staticClass:"full_option"},[t("el-tooltip",{attrs:{effect:"dark",content:e.isFullScreen?"退出全屏":"进入全屏",placement:"top-end",enterable:!1}},[t("el-button",{staticClass:"full_button",attrs:{size:"mini",icon:e.screenIcon},on:{click:function(t){return e.doScreen(0)}}})],1)],1)])])],1)],1),t("div",{directives:[{name:"show",rawName:"v-show",value:1===e.home_dual_mode,expression:"home_dual_mode === 1"}],staticClass:"preview_seperator_line"}),t("el-main",{directives:[{name:"show",rawName:"v-show",value:1===e.home_dual_mode,expression:"home_dual_mode === 1"}],staticClass:"preview_capture_left_container"},[t("el-container",{staticClass:"preview_container",attrs:{id:"video_container_1"}},[t("el-main",{ref:"axMain1",staticClass:"video_container"},[t("video",{directives:[{name:"show",rawName:"v-show",value:e.streamOptions[1].showVideoStatus,expression:"streamOptions[1].showVideoStatus"}],ref:"axVideoRef1",staticClass:"axVideo",attrs:{id:"myVideo1",autoplay:"",playsinline:"",oncontextmenu:"return false;"}}),t("canvas",{directives:[{name:"show",rawName:"v-show",value:!e.streamOptions[1].showVideoStatus,expression:"!streamOptions[1].showVideoStatus"}],staticClass:"axVideo2",attrs:{id:"myMjpeg1"}})]),t("el-footer",{staticClass:"video_controls_container",attrs:{height:"30px"}},[t("div",{staticClass:"left_controls_container"},[t("div",{staticClass:"size_option"},[t("el-dropdown",{attrs:{size:"mini",placement:"top-start",trigger:"click"},on:{command:e.changeSizeOption1}},[t("el-button",{staticClass:"el-dropdown-link",attrs:{size:"mini",type:"text",disabled:1==e.sns_num}},[e._v(e._s(e.sizeOptions[e.streamOptions[1].sizeOptionInd].label))]),t("el-dropdown-menu",{attrs:{slot:"dropdown","append-to-body":!1},slot:"dropdown"},e._l(e.sizeOptions,(function(s){return t("el-dropdown-item",{key:s.id,attrs:{command:s.id+"",icon:s.icon}},[e._v(e._s(s.label))])})),1)],1)],1),t("div",[t("el-dropdown",{attrs:{size:"mini",placement:"top",trigger:"click"},on:{command:e.changeStream1}},[t("el-button",{staticClass:"el-dropdown-link",attrs:{size:"mini",type:"text",disabled:1==e.sns_num}},[e._v(e._s(e.streamOptions[1].videoInfo[e.streamOptions[1].streamInd].label))]),t("el-dropdown-menu",{attrs:{slot:"dropdown","append-to-body":!1},slot:"dropdown"},e._l(e.streamOptions[1].videoInfo,(function(s){return t("el-dropdown-item",{key:s.id,attrs:{command:s.id+"",icon:s.icon}},[e._v(e._s(s.label))])})),1)],1)],1),t("div",{staticClass:"size_info"},[t("span",[e._v(e._s(this.streamOptions[1].encInfo))])])]),t("div",{staticClass:"right_controls_container"},[t("div",{staticClass:"draw_option"},[t("el-tooltip",{attrs:{effect:"dark",content:e.isEnable3ASR?"关闭3A Sync Ratio":"开启3A Sync Ratio",placement:"top-end",enterable:!1}},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:1===e.pano_sns_id,expression:"pano_sns_id === 1"}],class:{draw_button_enable:e.isEnable3ASR,draw_button_disable:!e.isEnable3ASR},attrs:{icon:"el-icon-refresh"},on:{click:e.change3ASR}})],1)],1),t("div",{staticClass:"draw_option"},[t("el-tooltip",{attrs:{effect:"dark",content:"抓拍",placement:"top-end"}},[t("el-button",{class:{draw_button_enable:!0,draw_button_disable:!1},attrs:{size:"mini",icon:"el-icon-camera-solid"},on:{click:function(t){return e.onSnapshot(1)}}})],1)],1),t("div",{staticClass:"draw_option"},[t("el-tooltip",{attrs:{effect:"dark",content:"录入人像信息",placement:"top-end",enterable:!1}},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.isSearchImg&&"facehuman"==e.detect_mode,expression:"isSearchImg && detect_mode == 'facehuman'"}],class:{draw_button_enable:!0,draw_button_disable:!1},attrs:{size:"mini",icon:"el-icon-user-solid"},on:{click:function(t){return e.recordFaceinfo(1)}}})],1)],1),t("div",{staticClass:"draw_option"},[t("el-tooltip",{attrs:{effect:"dark",content:e.streamOptions[1].isRecStart?"停止录像":"开启录像",placement:"top-end",enterable:!1}},[t("el-button",{class:{draw_button_enable:e.streamOptions[1].recEnable,draw_button_disable:!e.streamOptions[1].recEnable},attrs:{size:"mini",disabled:!e.streamOptions[1].recEnable,icon:e.streamOptions[1].recIcon},on:{click:function(t){return e.onRecording(1)}}})],1)],1),t("div",{staticClass:"full_option"},[t("el-tooltip",{attrs:{effect:"dark",content:e.isFullScreen?"退出全屏":"进入全屏",placement:"top-end",enterable:!1}},[t("el-button",{staticClass:"full_button",attrs:{size:"mini",icon:e.screenIcon,disabled:1==e.sns_num},on:{click:function(t){return e.doScreen(1)}}})],1)],1)])])],1)],1),t("el-aside",{directives:[{name:"show",rawName:"v-show",value:"ai"==e.mode_option,expression:"mode_option == 'ai'"}],staticClass:"side_identify_events_container",attrs:{width:"335px"}},[t("el-container",{staticClass:"identify_events_container"},[t("el-header",{staticClass:"identify_container"},[t("el-row",{staticClass:"image_info_container"},[t("el-col",{staticClass:"image_col",attrs:{span:10}},[t("div",{staticClass:"image-large"},[""==e.currentImg.src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.currentImg.src?t("img",{staticClass:"image-large",attrs:{src:e.currentImg.src,crossOrigin:"anonymous"},on:{click:function(t){return e.look(e.currentImg)}}}):e._e()])]),t("el-col",{staticClass:"info_col",attrs:{span:14}},[t("div",{staticClass:"info_container"},[t("div",{directives:[{name:"show",rawName:"v-show",value:"facehuman"==e.detect_mode,expression:"detect_mode == 'facehuman'"}],staticClass:"info_text"},[e._v(" 性别： "+e._s(e.currentImg.info.gender)+" ")]),t("div",{directives:[{name:"show",rawName:"v-show",value:"facehuman"==e.detect_mode,expression:"detect_mode == 'facehuman'"}],staticClass:"info_text"},[e._v(" 年龄： "+e._s(e.currentImg.info.age)+" ")]),t("div",{directives:[{name:"show",rawName:"v-show",value:"facehuman"==e.detect_mode,expression:"detect_mode == 'facehuman'"}],staticClass:"info_text"},[e._v(" 口罩： "+e._s(e.currentImg.info.mask)+" ")]),t("div",{directives:[{name:"show",rawName:"v-show",value:"facehuman"==e.detect_mode,expression:"detect_mode == 'facehuman'"}],staticClass:"info_text"},[e._v(" 识别： "+e._s(e.currentImg.info.info)+" ")]),t("div",{directives:[{name:"show",rawName:"v-show",value:"hvcfp"==e.detect_mode,expression:"detect_mode == 'hvcfp'"}],staticClass:"info_text"},[e._v(" 车牌号码："+e._s(e.currentImg.info.number)+" ")]),t("div",{directives:[{name:"show",rawName:"v-show",value:"hvcfp"==e.detect_mode,expression:"detect_mode == 'hvcfp'"}],staticClass:"info_text"},[e._v(" 车牌颜色："+e._s(e.currentImg.info.color)+" ")])])])],1)],1),t("el-main",{staticClass:"events_container"},[t("el-table",{staticClass:"events_table",staticStyle:{"font-size":"10px"},attrs:{"header-cell-style":{background:"#2C2C2C",color:"#B0B0B0",border:"none",fontSize:"10px",padding:"4px"},"cell-style":{padding:"4px"},"row-style":{height:"16px"},height:"150",data:e.eventList,"highlight-current-row":""}},[t("el-table-column",{attrs:{type:"index",label:"#",width:"50"}}),t("el-table-column",{attrs:{property:"date",label:"发生时间",width:"105"}}),t("el-table-column",{attrs:{property:"sensor",label:"Camera",width:"85"}}),t("el-table-column",{attrs:{property:"type",label:"事件类型",width:"85"}})],1)],1)],1)],1)],1),t("el-footer",{directives:[{name:"show",rawName:"v-show",value:e.snapshotEnable||e.flashEnable,expression:"snapshotEnable || flashEnable"}],class:e.snapshotEnable&&!e.flashEnable||!e.snapshotEnable&&e.flashEnable?"snapshot_img_container_half":"snapshot_img_container"},[t("el-row",{directives:[{name:"show",rawName:"v-show",value:e.snapshotEnable,expression:"snapshotEnable"}],staticClass:"img_list_top"},[t("el-col",{staticClass:"hvcfp_img_col",attrs:{span:2}},[t("div",{staticClass:"type_text"},[e._v("抓拍")])]),t("el-col",{staticClass:"hvcfp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"hvcfp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-small"},[""==e.pushSnapshots.img[s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushSnapshots.img[s-1].src?t("img",{staticClass:"image-small",attrs:{src:e.pushSnapshots.img[s-1].src},on:{click:function(t){return e.look(e.pushSnapshots.img[s-1])}}}):e._e()])])})),1),t("el-col",{staticClass:"hvcfp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"hvcfp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-small"},[""==e.pushSnapshots.img[e.image_count/2+s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushSnapshots.img[e.image_count/2+s-1].src?t("img",{staticClass:"image-small",attrs:{src:e.pushSnapshots.img[e.image_count/2+s-1].src},on:{click:function(t){return e.look(e.pushSnapshots.img[e.image_count/2+s-1])}}}):e._e()])])})),1)],1),t("el-row",{directives:[{name:"show",rawName:"v-show",value:e.flashEnable,expression:"flashEnable"}],class:e.snapshotEnable?"img_list":"img_list_top"},[t("el-col",{staticClass:"hvcfp_img_col",attrs:{span:2}},[t("div",{staticClass:"type_text"},[e._v("爆闪")])]),t("el-col",{staticClass:"hvcfp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"hvcfp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-small"},[""==e.pushSnapshots.flash[s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushSnapshots.flash[s-1].src?t("img",{staticClass:"image-small",attrs:{src:e.pushSnapshots.flash[s-1].src},on:{click:function(t){return e.look(e.pushSnapshots.flash[s-1])}}}):e._e()])])})),1),t("el-col",{staticClass:"hvcfp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"hvcfp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-small"},[""==e.pushSnapshots.flash[e.image_count/2+s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushSnapshots.flash[e.image_count/2+s-1].src?t("img",{staticClass:"image-small",attrs:{src:e.pushSnapshots.flash[e.image_count/2+s-1].src},on:{click:function(t){return e.look(e.pushSnapshots.flash[e.image_count/2+s-1])}}}):e._e()])])})),1)],1)],1),t("el-footer",{directives:[{name:"show",rawName:"v-show",value:"hvcfp"==e.detect_mode&&"ai"==e.mode_option,expression:"detect_mode == 'hvcfp' && mode_option == 'ai'"}],staticClass:"hvcfp_img_container"},[t("el-row",{staticClass:"img_list_top"},[t("el-col",{staticClass:"hvcfp_img_col",attrs:{span:2}},[t("div",{staticClass:"type_text"},[e._v("人脸")])]),t("el-col",{staticClass:"hvcfp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"hvcfp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-small"},[""==e.pushHCVFPImages.face[s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushHCVFPImages.face[s-1].src?t("img",{staticClass:"image-small",attrs:{src:e.pushHCVFPImages.face[s-1].src},on:{click:function(t){return e.look(e.pushHCVFPImages.face[s-1])}}}):e._e()])])})),1),t("el-col",{staticClass:"hvcfp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"hvcfp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-small"},[""==e.pushHCVFPImages.face[e.image_count/2+s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushHCVFPImages.face[e.image_count/2+s-1].src?t("img",{staticClass:"image-small",attrs:{src:e.pushHCVFPImages.face[e.image_count/2+s-1].src},on:{click:function(t){return e.look(e.pushHCVFPImages.face[e.image_count/2+s-1])}}}):e._e()])])})),1)],1),t("el-row",{staticClass:"img_list"},[t("el-col",{staticClass:"hvcfp_img_col",attrs:{span:2}},[t("div",{staticClass:"type_text"},[e._v("人形")])]),t("el-col",{staticClass:"hvcfp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"hvcfp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-small"},[""==e.pushHCVFPImages.body[s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushHCVFPImages.body[s-1].src?t("img",{staticClass:"image-small",attrs:{src:e.pushHCVFPImages.body[s-1].src},on:{click:function(t){return e.look(e.pushHCVFPImages.body[s-1])}}}):e._e()])])})),1),t("el-col",{staticClass:"hvcfp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"hvcfp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-small"},[""==e.pushHCVFPImages.body[e.image_count/2+s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushHCVFPImages.body[e.image_count/2+s-1].src?t("img",{staticClass:"image-small",attrs:{src:e.pushHCVFPImages.body[e.image_count/2+s-1].src},on:{click:function(t){return e.look(e.pushHCVFPImages.body[e.image_count/2+s-1])}}}):e._e()])])})),1)],1),t("el-row",{staticClass:"img_list"},[t("el-col",{staticClass:"hvcfp_img_col",attrs:{span:2}},[t("div",{staticClass:"type_text"},[e._v("非机动车")])]),t("el-col",{staticClass:"hvcfp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"hvcfp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-small"},[""==e.pushHCVFPImages.cycle[s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushHCVFPImages.cycle[s-1].src?t("img",{staticClass:"image-small",attrs:{src:e.pushHCVFPImages.cycle[s-1].src},on:{click:function(t){return e.look(e.pushHCVFPImages.cycle[s-1])}}}):e._e()])])})),1),t("el-col",{staticClass:"hvcfp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"hvcfp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-small"},[""==e.pushHCVFPImages.cycle[e.image_count/2+s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushHCVFPImages.cycle[e.image_count/2+s-1].src?t("img",{staticClass:"image-small",attrs:{src:e.pushHCVFPImages.cycle[e.image_count/2+s-1].src},on:{click:function(t){return e.look(e.pushHCVFPImages.cycle[e.image_count/2+s-1])}}}):e._e()])])})),1)],1),t("el-row",{staticClass:"img_list"},[t("el-col",{staticClass:"hvcfp_img_col",attrs:{span:2}},[t("div",{staticClass:"type_text"},[e._v("机动车")])]),t("el-col",{staticClass:"hvcfp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"hvcfp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-small"},[""==e.pushHCVFPImages.vechicle[s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushHCVFPImages.vechicle[s-1].src?t("img",{staticClass:"image-small",attrs:{src:e.pushHCVFPImages.vechicle[s-1].src},on:{click:function(t){return e.look(e.pushHCVFPImages.vechicle[s-1])}}}):e._e()])])})),1),t("el-col",{staticClass:"hvcfp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"hvcfp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-small"},[""==e.pushHCVFPImages.vechicle[e.image_count/2+s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushHCVFPImages.vechicle[e.image_count/2+s-1].src?t("img",{staticClass:"image-small",attrs:{src:e.pushHCVFPImages.vechicle[e.image_count/2+s-1].src},on:{click:function(t){return e.look(e.pushHCVFPImages.vechicle[e.image_count/2+s-1])}}}):e._e()])])})),1)],1),t("el-row",{staticClass:"img_list_bottom"},[t("el-col",{staticClass:"hvcfp_img_col",attrs:{span:2}},[t("div",{staticClass:"type_text"},[e._v("车牌")])]),t("el-col",{staticClass:"hvcfp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"hvcfp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-small"},[""==e.pushHCVFPImages.plate[s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushHCVFPImages.plate[s-1].src?t("img",{staticClass:"image-small",attrs:{src:e.pushHCVFPImages.plate[s-1].src},on:{click:function(t){return e.look(e.pushHCVFPImages.plate[s-1])}}}):e._e()])])})),1),t("el-col",{staticClass:"hvcfp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"hvcfp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-small"},[""==e.pushHCVFPImages.plate[e.image_count/2+s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushHCVFPImages.plate[e.image_count/2+s-1].src?t("img",{staticClass:"image-small",attrs:{src:e.pushHCVFPImages.plate[e.image_count/2+s-1].src},on:{click:function(t){return e.look(e.pushHCVFPImages.plate[e.image_count/2+s-1])}}}):e._e()])])})),1)],1)],1),t("el-footer",{directives:[{name:"show",rawName:"v-show",value:"facehuman"==e.detect_mode&&"ai"==e.mode_option,expression:"detect_mode == 'facehuman' && mode_option == 'ai'"}],staticClass:"fh_img_container"},[t("el-row",{staticClass:"img_list_top"},[t("el-col",{staticClass:"fp_img_col",attrs:{span:2}},[t("div",{staticClass:"type_text_fh"},[e._v("人脸")])]),t("el-col",{staticClass:"fp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"fp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-medium"},[""==e.pushFHImages.face[s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushFHImages.face[s-1].src?t("img",{staticClass:"image-medium",attrs:{src:e.pushFHImages.face[s-1].src},on:{click:function(t){return e.look(e.pushFHImages.face[s-1])}}}):e._e()])])})),1),t("el-col",{staticClass:"fp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"fp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-medium"},[""==e.pushFHImages.face[e.image_count/2+s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushFHImages.face[e.image_count/2+s-1].src?t("img",{staticClass:"image-medium",attrs:{src:e.pushFHImages.face[e.image_count/2+s-1].src},on:{click:function(t){return e.look(e.pushFHImages.face[e.image_count/2+s-1])}}}):e._e()])])})),1)],1),t("el-row",{staticClass:"img_list"},[t("el-col",{staticClass:"fp_img_col",attrs:{span:2}},[t("div",{staticClass:"type_text_fh"},[e._v("人脸")])]),t("el-col",{staticClass:"fp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"fp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-medium"},[""==e.pushFHImages.face[e.image_count+s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushFHImages.face[e.image_count+s-1].src?t("img",{staticClass:"image-medium",attrs:{src:e.pushFHImages.face[e.image_count+s-1].src},on:{click:function(t){return e.look(e.pushFHImages.face[e.image_count+s-1])}}}):e._e()])])})),1),t("el-col",{staticClass:"fp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"fp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-medium"},[""==e.pushFHImages.face[e.image_count/2+e.image_count+s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushFHImages.face[e.image_count/2+e.image_count+s-1].src?t("img",{staticClass:"image-medium",attrs:{src:e.pushFHImages.face[e.image_count/2+e.image_count+s-1].src},on:{click:function(t){return e.look(e.pushFHImages.face[e.image_count/2+e.image_count+s-1])}}}):e._e()])])})),1)],1),t("el-row",{staticClass:"img_list"},[t("el-col",{staticClass:"fp_img_col",attrs:{span:2}},[t("div",{staticClass:"type_text_fh"},[e._v("人形")])]),t("el-col",{staticClass:"fp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"fp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-medium"},[""==e.pushFHImages.body[s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushFHImages.body[s-1].src?t("img",{staticClass:"image-medium",attrs:{src:e.pushFHImages.body[s-1].src},on:{click:function(t){return e.look(e.pushFHImages.body[s-1])}}}):e._e()])])})),1),t("el-col",{staticClass:"fp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"fp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-medium"},[""==e.pushFHImages.body[e.image_count/2+s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushFHImages.body[e.image_count/2+s-1].src?t("img",{staticClass:"image-medium",attrs:{src:e.pushFHImages.body[e.image_count/2+s-1].src},on:{click:function(t){return e.look(e.pushFHImages.body[e.image_count/2+s-1])}}}):e._e()])])})),1)],1),t("el-row",{staticClass:"img_list_bottom"},[t("el-col",{staticClass:"fp_img_col",attrs:{span:2}},[t("div",{staticClass:"type_text_fh"},[e._v("人形")])]),t("el-col",{staticClass:"fp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"fp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-medium"},[""==e.pushFHImages.body[e.image_count+s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushFHImages.body[e.image_count+s-1].src?t("img",{staticClass:"image-medium",attrs:{src:e.pushFHImages.body[e.image_count+s-1].src},on:{click:function(t){return e.look(e.pushFHImages.body[e.image_count+s-1])}}}):e._e()])])})),1),t("el-col",{staticClass:"fp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"fp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-medium"},[""==e.pushFHImages.body[e.image_count/2+e.image_count+s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushFHImages.body[e.image_count/2+e.image_count+s-1].src?t("img",{staticClass:"image-medium",attrs:{src:e.pushFHImages.body[e.image_count/2+e.image_count+s-1].src},on:{click:function(t){return e.look(e.pushFHImages.body[e.image_count/2+e.image_count+s-1])}}}):e._e()])])})),1)],1)],1),t("div",{directives:[{name:"show",rawName:"v-show",value:e.showViewer,expression:"showViewer"}],staticClass:"view_container"},[t("el-dialog",{attrs:{visible:e.showViewer,width:"800px","before-close":e.handleViewerClose},on:{"update:visible":function(t){e.showViewer=t}}},[t("span",{staticClass:"dialog-title",attrs:{slot:"title"},slot:"title"},[e._v(" "+e._s(e.image_types[e.viewerImg.type]+"详细信息-"+e.viewerImg.date)+" ")]),t("el-row",{staticClass:"view_image_info_container"},[t("el-col",{staticClass:"view_image_col",attrs:{span:12}},[t("el-image",{staticClass:"image-view",attrs:{src:e.viewerImg.src,"preview-src-list":[e.viewerImg.src],fit:"fill"}},[t("div",{staticClass:"image-slot-large",attrs:{slot:"error"},slot:"error"},[t("i",{staticClass:"el-icon-picture-outline"})])])],1),t("el-col",{staticClass:"info_col",attrs:{span:12}},[t("div",{staticClass:"view_info_container"},[t("div",{staticClass:"view_info_text"},[e._v(" 视频源： "+e._s(e.viewerImg.snsId)+" ")]),t("div",{directives:[{name:"show",rawName:"v-show",value:3==e.viewerImg.type&&"facehuman"==e.detect_mode,expression:"viewerImg.type == 3 && detect_mode == 'facehuman'"}],staticClass:"view_info_text"},[e._v(" 性别： "+e._s(e.viewerImg.info.gender)+" ")]),t("div",{directives:[{name:"show",rawName:"v-show",value:3==e.viewerImg.type&&"facehuman"==e.detect_mode,expression:"viewerImg.type == 3 && detect_mode == 'facehuman'"}],staticClass:"view_info_text"},[e._v(" 年龄： "+e._s(e.viewerImg.info.age)+" ")]),t("div",{directives:[{name:"show",rawName:"v-show",value:3==e.viewerImg.type&&"facehuman"==e.detect_mode,expression:"viewerImg.type == 3 && detect_mode == 'facehuman'"}],staticClass:"view_info_text"},[e._v(" 口罩： "+e._s(e.viewerImg.info.mask)+" ")]),t("div",{directives:[{name:"show",rawName:"v-show",value:3==e.viewerImg.type&&"facehuman"==e.detect_mode,expression:"viewerImg.type == 3 && detect_mode == 'facehuman'"}],staticClass:"view_info_text"},[e._v(" 识别： "+e._s(e.viewerImg.info.info)+" ")]),t("div",{directives:[{name:"show",rawName:"v-show",value:4==e.viewerImg.type&&"hvcfp"==e.detect_mode,expression:"viewerImg.type == 4 && detect_mode == 'hvcfp'"}],staticClass:"view_info_text"},[e._v(" 车牌号码："+e._s(e.viewerImg.info.number)+" ")]),t("div",{directives:[{name:"show",rawName:"v-show",value:4==e.viewerImg.type&&"hvcfp"==e.detect_mode,expression:"viewerImg.type == 4 && detect_mode == 'hvcfp'"}],staticClass:"view_info_text"},[e._v(" 车牌颜色："+e._s(e.viewerImg.info.color)+" ")]),t("div",{directives:[{name:"show",rawName:"v-show",value:"facehuman"==e.detect_mode&&3!=e.viewerImg.type||"hvcfp"==e.detect_mode&&4!=e.viewerImg.type,expression:"detect_mode == 'facehuman' && viewerImg.type != 3 || detect_mode == 'hvcfp' && viewerImg.type != 4"}],staticClass:"view_info_text"},[e._v(" 无属性信息 ")])])])],1)],1)],1)],1)],1)},a=[];s(7658),s(541),s(8675),s(3408),s(4590),s(3767),s(8585),s(8696),s(1703);function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,t,s){return t&&o(e.prototype,t),s&&o(e,s),Object.defineProperty(e,"prototype",{writable:!1}),e}function c(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function l(e,t){for(var s=new Float32Array(t),i=0,a=0;i<e.length;a+=e[i].length,i+=1)s.set(e[i],a);return s}function m(e,t,s){if(t<s)throw new Error('Invalid parameter: "inputSampleRate" must be greater than "outputSampleRate"');var i=e.length;t+=0,s+=0;for(var a=t/s,n=Math.ceil(i*s/t),o=new Float32Array(n),r=0,c=0;c<n;c+=1)o[c]=e[Math.floor(r)],r+=a;return o}function h(e,t){if(-1===[8,16].indexOf(t))throw new Error('Invalid parameter: "sampleBits" must be 8 or 16');for(var s=e.length*(t/8),i=new ArrayBuffer(s),a=new DataView(i),n=0,o=0;n<e.length;n+=1,o+=t/8){var r=Math.max(-1,Math.min(1,e[n])),c=r<0?32768*r:32767*r;8===t?a.setInt8(o,parseInt(255/(65535/(c+32768)),10),!0):a.setInt16(o,c,!0)}return a.buffer}function p(e,t,s){if(-1===[8,16].indexOf(t))throw new Error('Invalid parameter: "sampleBits" must be 8 or 16');var i=e.length*(t/8),a=new ArrayBuffer(44+i),n=new DataView(a),o=1,r=0,c=function(e){for(var t=0;t<e.length;t+=1)n.setUint8(r+t,e.charCodeAt(t))};c("RIFF"),r+=4,n.setUint32(r,36+i,!0),r+=4,c("WAVE"),r+=4,c("fmt "),r+=4,n.setUint32(r,16,!0),r+=4,n.setUint16(r,1,!0),r+=2,n.setUint16(r,o,!0),r+=2,n.setUint32(r,s,!0),r+=4,n.setUint32(r,o*s*(t/8),!0),r+=4,n.setUint16(r,o*(t/8),!0),r+=2,n.setUint16(r,t,!0),r+=2,c("data"),r+=4,n.setUint32(r,i,!0),r+=4;for(var l=0;l<e.length;l+=1,r+=t/8){var m=Math.max(-1,Math.min(1,e[l])),h=m<0?32768*m:32767*m;8===t?n.setInt8(r,parseInt(255/(65535/(h+32768)),10),!0):n.setInt16(r,h,!0)}return new Blob([n],{type:"audio/wav"})}function d(){void 0!==window&&void 0!==navigator&&(void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(e){var t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return t?new Promise((function(s,i){t.call(navigator,e,s,i)})):Promise.reject(new Error("getUserMedia is not implemented in this environment"))}))}var u={recordable:!0,sampleRate:16e3,sampleBits:16,bufferSize:16384},g={READY:0,RECORDING:1},f={RAW:"raw",PCM:"pcm",WAV:"wav"},_=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u,s=t.recordable,i=void 0===s?u.recordable:s,a=t.bufferSize,o=void 0===a?u.bufferSize:a,r=t.sampleRate,l=void 0===r?u.sampleRate:r,m=t.sampleBits,h=void 0===m?u.sampleBits:m;n(this,e),c(this,"state",g.READY),c(this,"ctx",new(window.AudioContext||window.webkitAudioContext)),c(this,"sampleRate",u.sampleRate),c(this,"sampleBits",u.sampleBits),c(this,"recordable",u.recordable),c(this,"recorder",null),c(this,"source",null),c(this,"stream",null),c(this,"buffer",[]),c(this,"bufferSize",0);var p=this.ctx,d=p.createScriptProcessor||p.createJavaScriptNode;this.recorder=d.call(p,o,1,1),this.recordable=i,this.sampleRate=l,this.sampleBits=h}return r(e,[{key:"start",value:function(e){var t=this;return this.ctx.resume(),new Promise((function(s,i){navigator.mediaDevices.getUserMedia({audio:!0}).then((function(i){var a=t.recorder,n=t.ctx.createMediaStreamSource(i);t.stream=i,t.source=n,a.onaudioprocess=function(s){var i=s.inputBuffer.getChannelData(0);t.recordable&&(t.buffer.push(i.slice(0)),t.bufferSize+=i.length),"function"===typeof e&&e(i)},n.connect(a),a.connect(t.ctx.destination),t.state=g.RECORDING,s(i)}))["catch"]((function(e){i(e)}))}))}},{key:"pause",value:function(){this.stream.getAudioTracks()[0].stop(),this.recorder.disconnect(),this.source.disconnect(),this.ctx.suspend(),this.state=g.READY}},{key:"clear",value:function(){this.buffer=[],this.bufferSize=0}},{key:"getRecord",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{encodeTo:f.RAW,compressible:!1},t=e.encodeTo,s=void 0===t?f.RAW:t,i=e.compressible,a=void 0!==i&&i;if(this.recordable){var n=l(this.buffer,this.bufferSize),o=this.ctx.sampleRate;a=a&&this.sampleRate<o;var r=a?this.sampleRate:o;switch(a&&(n=m(n,o,r)),s){case f.RAW:return n;case f.PCM:return h(n,this.sampleBits);case f.WAV:return p(n,this.sampleBits,r);default:throw new Error('Invalid parameter: "encodeTo" must be ENCODE_TYPE')}}throw new Error('Configuration error: "recordable" must be set to true')}}]),e}();d();var v=_,w=s(4053),I=s.n(w),b=s(577),C=s.n(b),y=s(3162),k={props:["mode_option","home_dual_mode","pano_sns_id"],data(){return{image_count:16,detect_mode:"hvcfp",pushFHImages:{face:[],body:[]},pushSnapshots:{img:[],flash:[]},pushHCVFPImages:{face:[],body:[],vechicle:[],cycle:[],plate:[]},currentImg:{snsId:0,type:0,src:"",date:"",info:{age:"--",gender:"--",mask:"--",info:"--",number:"--",color:"--"}},viewerImg:{snsId:0,type:0,src:"",date:"",info:{age:"--",gender:"--",mask:"--",info:"--",number:"--",color:"--"}},eventList:[],image_types:["人形","机动车","非机动车","人脸","车牌","抓拍","爆闪"],genderOptions:["女","男"],respiratorOptions:{no_respirator:"未戴口罩",surgical:"医用口罩","anti-pollution":"防雾霾口罩",common:"普通口罩",kitchen_transparent:"厨房透明口罩",unknown:"未知"},plateColorOptions:{blue:"蓝色",yellow:"黄色",black:"黑色",white:"白色",green:"绿色",small_new_energy:"新能源",large_new_energy:"新能源",absence:"未知",unknown:"未知"},sizeOptions:[{id:0,label:"自适应",value:"0:0",icon:"el-icon-full-screen"},{id:1,label:"原比例",value:"1:1",icon:"el-icon-full-screen"}],sns_num:2,streamOptions:[{streamInd:0,sizeOptionInd:1,recEnable:!1,isRecStart:!1,isWfsError:!1,showVideoStatus:!1,wfsObj:null,encInfo:"",timerEncInfo:void 0,recIcon:"el-icon-video-camera-solid",videoInfo:[{id:0,label:"主码流0",icon:"el-icon-full-screen",mediaType:"H264Raw",mediaFPS:25},{id:1,label:"子码流1",icon:"el-icon-full-screen",mediaType:"H264Raw",mediaFPS:25},{id:2,label:"子码流2",icon:"el-icon-full-screen",mediaType:"H264Raw",mediaFPS:25}],mjpegCtx:{isDrawImg:!0,mjpegW:0,mjpegH:0,sizeOptionInd:0,getObjectFitSize:this.getObjectFitSize,timerDraw:void 0},trigger_attr:{trigger_enable:!1,trigger:!1}},{streamInd:0,sizeOptionInd:1,recEnable:!1,isRecStart:!1,isWfsError:!1,showVideoStatus:!1,wfsObj:null,encInfo:"",timerEncInfo:void 0,recIcon:"el-icon-video-camera-solid",videoInfo:[{id:0,label:"主码流0",icon:"el-icon-full-screen",mediaType:"H264Raw",mediaFPS:25},{id:1,label:"子码流1",icon:"el-icon-full-screen",mediaType:"H264Raw",mediaFPS:25},{id:2,label:"子码流2",icon:"el-icon-full-screen",mediaType:"H264Raw",mediaFPS:25}],mjpegCtx:{mjpeg_w:0,mjpeg_h:0,sizeOptionInd:0,getObjectFitSize:this.getObjectFitSize,isDrawImg:!0,timerDraw:void 0}}],screenIcon:"vjs-icon-fullscreen-enter",isAiEnable:!1,isSearchImg:!1,isFullScreen:!1,isForceStop:!1,snapshotEnable:!0,flashEnable:!0,aenc_enable:!1,aenc_type:"aac",aenc_sample_rate:16e4,aenc_num_channels:1,isTalking:!1,isMuted:!0,wsCapture:[null,null],timerCapture:[void 0,void 0],lastRecvDataTime:[0,0],wsEvents:null,timerEvents:void 0,curImgInd:{fh:[0,0],hcvfp:[0,0,0,0,0],snapshot:0,flash:0},max_try_num:3,showViewer:!1,full_scr_id:void 0,isEnable3ASR:!0}},created(){console.log("preview created ++"),this.getInfo(!1,0);for(var e=0;e<this.image_count;e++)this.pushFHImages.face.push({snsId:0,type:3,src:"",date:"",info:{gender:"--",age:"--",mask:"--",info:"--"}}),this.pushFHImages.face.push({snsId:0,type:3,src:"",date:"",info:{gender:"--",age:"--",mask:"--",info:"--"}}),this.pushFHImages.body.push({snsId:0,type:0,src:"",date:"",info:{}}),this.pushFHImages.body.push({snsId:0,type:0,src:"",date:"",info:{}}),this.pushHCVFPImages.face.push({snsId:0,type:3,src:"",date:"",info:{}}),this.pushHCVFPImages.body.push({snsId:0,type:0,src:"",date:"",info:{}}),this.pushHCVFPImages.vechicle.push({snsId:0,type:1,src:"",date:"",info:{}}),this.pushHCVFPImages.cycle.push({snsId:0,type:2,src:"",date:"",info:{}}),this.pushHCVFPImages.plate.push({snsId:0,type:4,src:"",date:"",info:{number:"--",color:"--"}}),this.pushSnapshots.img.push({snsId:0,type:5,src:"",date:"",info:{}}),this.pushSnapshots.flash.push({snsId:0,type:6,src:"",date:"",info:{}});this.$nextTick((function(){this.resizeCanvas()})),console.log("preview created --")},mounted(){console.log("preview mounted ++");const e=this;C().isEnabled&&C().on("change",(()=>{e.checkFull()})),window.addEventListener("visibilitychange",(()=>{if("visible"===document.visibilityState)for(var e=0;e<this.streamOptions.length;e++)this.streamOptions[e].wfsObj&&this.streamOptions[e].showVideoStatus&&this.streamOptions[e].wfsObj.playerSeekNow();else this.onStopTalk()})),console.log("preview mounted --")},destroyed(){this.stopMedia()},methods:{startMedia(){this.startPlay(),this.startCapture(0),this.startCapture(1),this.startRecvEvents()},stopMedia(){this.isForceStop=!0,this.stopEncInfoQuery(0),this.stop(0),2===this.sns_num&&(this.stopEncInfoQuery(1),this.stop(1)),this.onStopTalk(),this.stopCatpure(0),this.stopCatpure(1),this.stopRecvEvents(),C().off("change",(()=>{}))},async startPlay(){await this.startSensorPlay(0),2===this.sns_num&&await this.startSensorPlay(1)},startSensorPreview(e){this.startSensorPlay(e),this.startCapture(0),this.startCapture(1)},stopSensorPreview(e){this.isForceStop=!0,this.stopEncInfoQuery(e),this.stop(e),this.stopCatpure(0),this.stopCatpure(1)},async startSensorPlay(e){for(var t=!1,s=0;s<this.max_try_num;s++){if(t)break;try{await this.changeStream(e,this.streamOptions[e].streamInd,!0,!0),t=!0}catch(i){t=!1,s==this.max_try_num-1&&console.log("startSensorPlay catch except: "+i)}}t||this.$message.error("网络请求码流失败")},play(e){console.log("play++, snsid: "+e);try{this.stop(e);let t=this.streamOptions[e].sizeOptionInd,s=this.streamOptions[e].streamInd,i=this.streamOptions[e].videoInfo[s].mediaFPS;this.changeSizeOption(e,t);const a=window.sessionStorage.getItem("token");if(I().isSupported()){let t={wsMinPacketInterval:2e3,wsMaxPacketInterval:8e3,fps:i},s=this.getDisplayInfo(e);console.log("new wfs obj, sns id: "+e+", mediaType: "+s.mediaType),this.streamOptions[e].wfsObj=new(I())(t);let n={video:s.video,ctx:s.mjpeg},o=null;this.aenc_enable&&0==e&&(o={websocketName:"ws/audio_"+e+"?token="+a,mediaType:this.aenc_type,sampleRate:this.aenc_sample_rate,numChannels:this.aenc_num_channels,bitWidth:this.aenc_bit_width}),this.streamOptions[e].wfsObj.attachMedia(n,"ch"+e,s.mediaType,"ws/preview_"+e+"?token="+a,s.extra,o),this.streamOptions[e].wfsObj.on(I().Events.ERROR,((t,s)=>0===e?this.handleWfsEvent0(t,s):this.handleWfsEvent1(t,s))),this.streamOptions[e].isRecStart&&s.showVideo&&(this.streamOptions[e].isRecStart=!1,this.onRecording(e)),"MJPEG"==s.mediaType&&this.resizeCanvas(),this.startEncInfoQuery(e)}else console.log("wfs is not supported")}catch(t){console.log("play catch except: "+t)}console.log("play--, snsId: "+e)},stop(e){console.log("stop++, sns id: "+e),null!=this.streamOptions[e].wfsObj&&(this.streamOptions[e].isRecStart&&(this.streamOptions[e].wfsObj.stop_recording(),this.streamOptions[e].isWfsError||(this.streamOptions[e].isRecStart=!1,this.streamOptions[e].recIcon="el-icon-video-camera-solid")),this.streamOptions[e].wfsObj.destroy(),this.streamOptions[e].wfsObj=null),console.log("stop--, sns id: "+e)},getMediatype(e){return 0===e?"H264Raw":1===e?"MJPEG":2===e?"H265Raw":"H264Raw"},getDisplayInfo(e){const t=[document.getElementById("myVideo0"),document.getElementById("myVideo1")],s=[document.getElementById("myMjpeg0"),document.getElementById("myMjpeg1")];let i=this.streamOptions[e].streamInd,a=this.streamOptions[e].videoInfo[i].mediaType;this.streamOptions[e].mjpegCtx.sizeOptionInd=this.streamOptions[e].sizeOptionInd;let n=this.streamOptions[e].mjpegCtx,o=I().canPlayByVideo(a);return this.streamOptions[e].showVideoStatus=o,{video:t[e],mjpeg:s[e],mediaType:a,extra:n,showVideo:o}},changeSizeOption0(e){this.changeSizeOption(0,Number(e))},changeSizeOption1(e){this.changeSizeOption(1,Number(e))},changeSizeOption(e,t){this.streamOptions[e].sizeOptionInd=t,0===this.streamOptions[e].sizeOptionInd?document.getElementById("myVideo"+e).style.setProperty("object-fit","fill","important"):document.getElementById("myVideo"+e).style.setProperty("object-fit","contain","important"),console.log("sns "+e+" old objectFit: ",document.getElementById("myVideo"+e).style.objectFit),this.streamOptions[e].mjpegCtx.sizeOptionInd=this.streamOptions[e].sizeOptionInd,window.localStorage.setItem("size_"+ +e,this.streamOptions[e].sizeOptionInd)},async changeStream0(e,t=!0,s=!0){await this.changeStream(0,Number(e),t,s)},async changeStream1(e,t=!0,s=!0){await this.changeStream(1,Number(e),t,s)},async changeStream(e,t,s=!0,i=!0){console.log("video "+e+" change stream to "+this.streamOptions[e].videoInfo[t].id);const{data:a}=await this.$http.post("preview/stream",{src_id:e,stream:this.streamOptions[e].videoInfo[t].id});if(console.log("post stream return: ",a),!a||200!==a.meta.status)return this.$message.error("设置码流失败");if(i){this.streamOptions[e].streamInd=t;let s=this.streamOptions[e].videoInfo[t].mediaType;this.streamOptions[e].recEnable=I().canPlayByVideo(s),window.localStorage.setItem("stream_"+e,this.streamOptions[e].videoInfo[t].id)}this.clearEncInfo(e),s&&this.play(e)},async recordFaceinfo(e){console.log("record faceinfo, sns id: "+e),this.stop(e);const{data:t}=await this.$http.post("preview/faceinfo",{src_id:e,faceinfo:!0});return this.play(e),console.log("post record faceinfo: ",t),200!==t.meta.status?this.$message.error("人像信息录入失败"):0==t.data.faceinfo.status?this.$message.success("人像信息录入成功"):2==t.data.faceinfo.status?this.$message.warning("不支持此功能"):3==t.data.faceinfo.status?this.$message.warning("数据加载中，请稍后再试"):this.$message.error("人像信息录入失败，请重试")},async getInfo(e,t){try{const{data:r}=await this.$http.get("preview/info");if(console.log("preview info get return: ",r),200===r.meta.status){this.sns_num=r.data.info.sns_num,this.sns_num>2&&(this.sns_num=2),this.streamOptions[0].videoInfo=[];for(var s=0;s<r.data.info.stream0_list.length;s++){var i=r.data.info.stream0_list[s],a={id:i,label:0===i?"主码流0":"子码流"+i,icon:"el-icon-full-screen",mediaType:this.getMediatype(r.data.info.sns0_codec[s]),mediaFPS:r.data.info.sns0_video_fps[s]};this.streamOptions[0].videoInfo.push(a),this.streamOptions[0].trigger_attr.trigger_enable=r.data.info.trigger_enable}if(this.sns_num>1){this.streamOptions[1].videoInfo=[];for(s=0;s<r.data.info.stream1_list.length;s++){i=r.data.info.stream1_list[s],a={id:i,label:0===i?"主码流0":"子码流"+i,icon:"el-icon-full-screen",mediaType:this.getMediatype(r.data.info.sns1_codec[s]),mediaFPS:r.data.info.sns1_video_fps[s]};this.streamOptions[1].videoInfo.push(a)}}this.snapshotEnable=r.data.info.capture_enable,this.flashEnable=r.data.info.flash_enable,this.aenc_enable=r.data.info.aenc_enable,this.aenc_type=r.data.info.aenc_type,this.aenc_sample_rate=r.data.info.aenc_sample_rate,this.aenc_bit_width=r.data.info.aenc_bit_width,this.isSearchImg=r.data.info.searchimg,this.isAiEnable=r.data.info.ai_enable,this.detect_mode=r.data.info.detect_mode,console.log("1detect_mode: "+this.detect_mode),this.detect_mode||(this.detect_mode="facehuman",console.log("set detect_mode to default: "+this.detect_mode));var n=window.localStorage.getItem("stream_0"),o=r.data.info.stream0_list.length-1;void 0==n?this.streamOptions[0].streamInd=Math.min(1,o):(n=parseInt(n),this.streamOptions[0].streamInd=n>o?Math.min(1,o):n),console.log("this.sns_num:"+this.sns_num),this.sns_num>1&&(n=window.localStorage.getItem("stream_1"),o=r.data.info.stream1_list.length-1,void 0==n?this.streamOptions[1].streamInd=Math.min(1,o):(n=parseInt(n),this.streamOptions[1].streamInd=n>o?Math.min(1,o):n)),n=window.localStorage.getItem("size_0"),this.streamOptions[0].sizeOptionInd=void 0==n?0:parseInt(n),this.sns_num>1&&(n=window.localStorage.getItem("size_1"),this.streamOptions[1].sizeOptionInd=void 0==n?0:parseInt(n)),this.streamOptions[0].mjpegCtx.sizeOptionInd=this.streamOptions[0].sizeOptionInd,this.streamOptions[0].showVideoStatus=I().canPlayByVideo(this.streamOptions[0].videoInfo[this.streamOptions[0].streamInd].mediaType),this.streamOptions[0].recEnable=!!this.streamOptions[0].showVideoStatus,this.sns_num>1&&(this.streamOptions[1].mjpegCtx.sizeOptionInd=this.streamOptions[1].sizeOptionInd,this.streamOptions[1].showVideoStatus=I().canPlayByVideo(this.streamOptions[1].videoInfo[this.streamOptions[1].streamInd].mediaType),this.streamOptions[1].recEnable=!!this.streamOptions[1].showVideoStatus),e?this.startSensorPreview(t):this.startMedia()}}catch(r){console.log("getInfo exception: "+r),this.$message.error("获取信息失败")}},recResultCallback0(e){this.streamOptions[0].recEnable=!0,e?(this.streamOptions[0].isRecStart=!0,this.streamOptions[0].recIcon="el-icon-menu"):this.$message.error("开启录像失败")},recResultCallback1(e){this.streamOptions[1].recEnable=!0,e?(this.streamOptions[1].isRecStart=!0,this.streamOptions[1].recIcon="el-icon-menu"):this.$message.error("开启录像失败")},recStateCallback0(e){this.streamOptions[0].recEnable=e},recStateCallback1(e){this.streamOptions[1].recEnable=e},async doTriggerFlash(e){console.log("doTriggerFlash.",e);try{this.streamOptions[e].trigger_attr.trigger=!0;const{data:t}=await this.$http.post("preview/trigger",{src_id:e,trigger_attr:this.streamOptions[e].trigger_attr});console.log("trigger get return: ",t),200===t.meta.status?this.$message.success("触发成功"):this.$message.error("触发失败")}catch(t){this.$message.error("触发失败")}this.streamOptions[e].trigger_attr.trigger=!1},async onSnapshot(e){let t=this.streamOptions[e].videoInfo[this.streamOptions[e].streamInd].id;try{const{data:s}=await this.$http.post("preview/snapshot",{src_id:e,stream:t});200===s.meta.status&&console.log("send snapshot cmd succ")}catch(s){console.log("onSnapshot exception: "+s),this.$message.error("发送命令失败")}},async onRecording(e){if(this.streamOptions[e].wfsObj){var t=this.streamOptions[e].isRecStart;if(t)this.streamOptions[e].wfsObj.stop_recording(),this.streamOptions[e].isRecStart=!1,this.streamOptions[e].recIcon="el-icon-video-camera-solid";else{this.streamOptions[e].recEnable=!1;var s=window.localStorage.getItem("rec_threshold_web");void 0==s&&(s=1024),console.log("sns["+e+"] recording - threshold: "+s+" MB"),this.streamOptions[e].wfsObj.start_recording(1024*s*1024,0===e?this.recResultCallback0:this.recResultCallback1,0===e?this.recStateCallback0:this.recStateCallback1)}}},async getEncInfo(e){try{let t=this.streamOptions[e].videoInfo[this.streamOptions[e].streamInd].id,s=this.streamOptions[e].videoInfo[this.streamOptions[e].streamInd].mediaType;const{data:i}=await this.$http.get("preview/assist",{params:{src_id:e,stream:t}});if(200===i.meta.status){let t="";switch(s){case"MJPEG":t="MJPEG";break;case"H265Raw":t="H265";break;case"H264Raw":default:t="H264";break}this.streamOptions[e].encInfo="Camera"+e+"        编码格式: "+t+"        分辨率: "+i.data.assist_res+"        码率: "+i.data.assist_bitrate}}catch(t){console.log("getEncInfo exception: "+t),this.$message.error("获取信息失败")}},async clearEncInfo(e){this.streamOptions[e].encInfo=""},async onStartTalk(){this.isTalking?this.onStopTalk():(this.startAudioComm(),this.isForceStopTalk=!1,this.rc||(this.rc=new v({recordable:!0,sampleRate:this.aenc_sample_rate,sampleBits:8*(this.aenc_bit_width+1),bufferSize:2048})),this.rc&&this.rc.state===g.READY&&(this.isTalking=!0,this.rc.clear(),this.rc.start((e=>{if(this.isTalking){const e=this.rc.getRecord({encodeTo:f.PCM,compressible:!0});this.rc.clear();let t=this.wsTalk;this.isTalking&&t&&t.readyState===WebSocket.OPEN&&e&&e.byteLength&&(t.send(e),console.log("ws talk send data len: "+e.byteLength))}})).then((()=>{console.log("start talk")})).catch((e=>{console.log("talk failed.",e)}))))},async onStopTalk(){this.isForceStopTalk=!0,this.rc&&this.rc.state===g.RECORDING&&this.rc.pause(),this.isTalking&&(this.stopAudioComm(),this.isTalking=!1,this.rc=null,console.log("stop talk"))},async onMute(){this.isMuted=!this.isMuted;var e=document.getElementById("myVideo0");e.muted=this.isMuted},startEncInfoQuery(e){this.stopEncInfoQuery(e),this.streamOptions[e].timerEncInfo=setInterval((()=>{this.getEncInfo(e)}),1e3)},stopEncInfoQuery(e){this.streamOptions[e].timerEncInfo&&(clearInterval(this.streamOptions[e].timerEncInfo),this.streamOptions[e].timerEncInfo=void 0)},async change3ASR(e=!0){if(e){console.log("enable 3ASR:"+!this.isEnable3ASR);const{data:e}=await this.$http.post("preview/sync_ratio_3a",{sr3a:!this.isEnable3ASR});if(console.log("post enable 3ASR return: ",e),200!==e.meta.status)return this.$message.error("设置3ASR状态失败");this.isEnable3ASR=!this.isEnable3ASR}else{console.log("enable 3ASR:"+this.isEnable3ASR);const{data:e}=await this.$http.post("preview/sync_ratio_3a",{sr3a:this.isEnable3ASR});if(console.log("post enable 3ASR return: ",e),200!==e.meta.status)return this.$message.error("设置3ASR状态失败")}},doScreen(e){const t=0===e?document.getElementById("video_container_0"):document.getElementById("video_container_1");this.isFullScreen?(C().exit(t),this.screenIcon="vjs-icon-fullscreen-enter",this.resumePlay(0===e?1:0)):(C().request(t),this.screenIcon="vjs-icon-fullscreen-exit",this.full_scr_id=e),this.isFullScreen=!this.isFullScreen},checkFull(){C().isFullscreen||(this.isFullScreen=!1,this.screenIcon="vjs-icon-fullscreen-enter",this.resumePlay(0===this.full_scr_id?1:0))},resumePlay(e){this.streamOptions[e].showVideoStatus&&this.streamOptions[e].wfsObj.playerSeekNow()},handleWfsEvent0(e,t){this.handleWfsEvent(0,e,t)},handleWfsEvent1(e,t){this.handleWfsEvent(1,e,t)},handleWfsEvent(e,t,s){try{if(s.fatal){switch(this.streamOptions[e].isWfsError=!0,console.warn("sns["+e+"] fatal error :"+s.details),s.type){case I().ErrorTypes.MEDIA_ERROR:console.log("sns["+e+"] a media error occurred");break;case I().ErrorTypes.NETWORK_ERROR:console.log("sns["+e+"] a network error occurred");break;default:console.log("sns["+e+"] an unrecoverable error occurred");break}this.play(e)}}catch(i){console.log("sns["+e+"] handleWfsEvent catch except: "+i)}},startCapture(e){if(1===e&&!this.snapshotEnable)return;this.stopCatpure(e);const t=window.sessionStorage.getItem("token");var s="ws://"+window.location.host+"/ws/capture_"+e+"?token="+t,i="binary";this.wsCapture[e]=new WebSocket(s,i),this.wsCapture[e].onopen=()=>{console.log("cap["+e+"] ws capture connected"),this.createCaptureTimer(e)},this.wsCapture[e].onclose=t=>{console.log("cap["+e+"] ws capture disconnected",t),this.isForceStop||this.startCapture(e)},this.wsCapture[e].onmessage=t=>{if("string"===typeof t.data)console.log("cap["+e+"] capture got a message: "+t.data);else try{if(this.lastRecvDataTime[e]=performance.now(),0===e){var s=new FileReader;s.onload=e=>{e.target.readyState===FileReader.DONE&&this.parseJpgDataWithHead(e.target.result)},s.readAsArrayBuffer(t.data)}else if(1===e){const e=new Blob([t.data],{type:"image/jpeg"}),s="snapshot_"+this.getCurrentTime()+".jpg";(0,y.saveAs)(e,s)}}catch(i){console.log("cap["+e+"] capture image catch except: "+i)}},this.wsCapture[e].onerror=t=>{console.log("cap["+e+"] capture occure error",t)}},startAudioComm(){this.wsTalkBufList=[],this.wsTalkBufSize=0;const e=window.sessionStorage.getItem("token");var t="ws://"+window.location.host+"/ws/talk?token="+e,s="binary";this.wsTalk=new WebSocket(t,s),this.wsTalk.onopen=()=>{console.log("ws talk connected")},this.wsTalk.onclose=e=>{console.log("ws talk disconnected: ",e),this.isForceStopTalk?this.onStopTalk():(this.wsTalk=null,this.startAudioComm())},this.wsTalk.onmessage=e=>{"string"===typeof e.data&&console.log("got a wscapture message: "+e.data)},this.wsTalk.onerror=e=>{console.log("ws talk occure error: ",e)}},stopAudioComm(){this.wsTalk&&(this.wsTalk.close(),this.wsTalk=null)},stopCatpure(e){(1!==e||this.snapshotEnable)&&(this.clearCaptureTimer(e),this.wsCapture[e]&&this.wsCapture[e].close())},createCaptureTimer(e){this.clearCaptureTimer(e),this.timerCapture[e]=setInterval((()=>{this.wsCapture[e]&&this.wsCapture[e].readyState===WebSocket.OPEN&&this.wsCapture[e].send("keep-alive")}),3e3)},clearCaptureTimer(e){this.timerCapture[e]&&(clearInterval(this.timerCapture[e]),this.timerCapture[e]=void 0)},startRecvEvents(){console.log("startRecvEvents ++"),this.stopRecvEvents();const e=window.sessionStorage.getItem("token");var t="ws://"+window.location.host+"/ws/events?token="+e,s="binary";this.wsEvents=new WebSocket(t,s),this.wsEvents.onopen=()=>{console.log("ws events connected"),this.createEventstimer()},this.wsEvents.onclose=e=>{console.log("ws events disconnected",e),this.isForceStop||this.startRecvEvents()},this.wsEvents.onmessage=e=>{if("string"===typeof e.data)console.log("got a ws events message: "+e.data);else try{var t=new FileReader;t.onload=e=>{if(e.target.readyState===FileReader.DONE){for(var t=JSON.parse(e.target.result),s=0;s<t.events.length;s++)1===t.events[s].type?this.eventList.unshift({type:"移动",date:t.events[s].date,sensor:t.events[s].sensor}):2===t.events[s].type?this.eventList.unshift({type:"遮挡",date:t.events[s].date,sensor:t.events[s].sensor}):3===t.events[s].type?this.eventList.unshift({type:"场景变更",date:t.events[s].date,sensor:t.events[s].sensor}):0===t.events[s].type&&(console.log("got a video change event: "+e.target.result),this.resetVideoStream(t.events[s].sensor));this.eventList.length>32&&this.eventList.splice(32,this.eventList.length-32)}},t.readAsText(e.data)}catch(s){console.log("ws events catch except: "+s)}},this.wsEvents.onerror=e=>{console.log("ws events occure error",e)},console.log("startRecvEvents --")},resetVideoStream(e){this.stopSensorPreview(e),this.getInfo(!0,e)},stopRecvEvents(){console.log("stopRecvEvents ++"),this.clearEventstimer(),this.wsEvents&&this.wsEvents.close(),console.log("stopRecvEvents --")},createEventstimer(){this.clearEventstimer(),this.timerEvents=setInterval((()=>{this.wsEvents&&this.wsEvents.readyState===WebSocket.OPEN&&this.wsEvents.send("keep-alive")}),3e3)},clearEventstimer(){this.timerEvents&&(clearInterval(this.timerEvents),this.timerEvents=void 0)},parseJpgDataWithHead(e){try{var t=new Uint8Array(e.slice(0,16));if(t&&65===t[0]&&88===t[1]&&73===t[2]&&84===t[3]){var s=this.bytesToIntLittleEndian(t.subarray(4,8));if(74===t[8]&&83===t[9]&&79===t[10]&&78===t[11]){var i=this.bytesToIntLittleEndian(t.subarray(12,16)),a=new TextDecoder("utf-8"),n=new Uint8Array(e.slice(16,16+i-1)),o=a.decode(n),r=JSON.parse(o),c=new Blob([e.slice(s)],{type:"image/jpeg"}),l=(URL||webkitURL).createObjectURL(c);if(r&&l){if("facehuman"===this.detect_mode){if(3===r.type){var m=this.curImgInd.fh[0];this.pushFHImages.face[m].snsId=r.snsId,this.pushFHImages.face[m].src=l,this.pushFHImages.face[m].date=this.getCurrentTime(),this.pushFHImages.face[m].info.gender=this.genderOptions[r.attribute.face.gender],this.pushFHImages.face[m].info.age=r.attribute.face.age,this.pushFHImages.face[m].info.mask=this.respiratorOptions[r.attribute.face.mask],this.pushFHImages.face[m].info.info=r.attribute.face.info,this.curImgInd.fh[0]=(m+1)%this.pushFHImages.face.length,this.currentImg.snsId=r.snsId,this.currentImg.src=l,this.currentImg.type=3,this.currentImg.date=this.pushFHImages.face[m].date,this.currentImg.info.gender=this.pushFHImages.face[m].info.gender,this.currentImg.info.age=this.pushFHImages.face[m].info.age,this.currentImg.info.mask=this.pushFHImages.face[m].info.mask,this.currentImg.info.info=this.pushFHImages.face[m].info.info}else if(0===r.type){m=this.curImgInd.fh[1];this.pushFHImages.body[m].snsId=r.snsId,this.pushFHImages.body[m].src=l,this.pushFHImages.body[m].date=this.getCurrentTime(),this.pushFHImages.face[m].info={},this.curImgInd.fh[1]=(m+1)%this.pushFHImages.body.length}}else if("hvcfp"===this.detect_mode)if(3===r.type){m=this.curImgInd.hcvfp[0];this.pushHCVFPImages.face[m].snsId=r.snsId,this.pushHCVFPImages.face[m].src=l,this.pushHCVFPImages.face[m].date=this.getCurrentTime(),this.pushHCVFPImages.face[m].info={},this.curImgInd.hcvfp[0]=(m+1)%this.pushHCVFPImages.face.length}else if(0===r.type){m=this.curImgInd.hcvfp[1];this.pushHCVFPImages.body[m].snsId=r.snsId,this.pushHCVFPImages.body[m].src=l,this.pushHCVFPImages.body[m].date=this.getCurrentTime(),this.pushHCVFPImages.body[m].info={},this.curImgInd.hcvfp[1]=(m+1)%this.pushHCVFPImages.body.length}else if(1===r.type){m=this.curImgInd.hcvfp[2];this.pushHCVFPImages.vechicle[m].snsId=r.snsId,this.pushHCVFPImages.vechicle[m].src=l,this.pushHCVFPImages.vechicle[m].date=this.getCurrentTime(),this.pushHCVFPImages.vechicle[m].info={},this.curImgInd.hcvfp[2]=(m+1)%this.pushHCVFPImages.vechicle.length}else if(2===r.type){m=this.curImgInd.hcvfp[3];this.pushHCVFPImages.cycle[m].snsId=r.snsId,this.pushHCVFPImages.cycle[m].src=l,this.pushHCVFPImages.cycle[m].date=this.getCurrentTime(),this.pushHCVFPImages.cycle[m].info={},this.curImgInd.hcvfp[3]=(m+1)%this.pushHCVFPImages.cycle.length}else if(4===r.type){m=this.curImgInd.hcvfp[4];this.pushHCVFPImages.plate[m].snsId=r.snsId,this.pushHCVFPImages.plate[m].src=l,this.pushHCVFPImages.plate[m].date=this.getCurrentTime(),this.pushHCVFPImages.plate[m].info.number=r.attribute.plate.number,this.pushHCVFPImages.plate[m].info.color=this.plateColorOptions[r.attribute.plate.color],this.curImgInd.hcvfp[4]=(m+1)%this.pushHCVFPImages.plate.length,this.currentImg.snsId=r.snsId,this.currentImg.src=l,this.currentImg.type=4,this.currentImg.date=this.pushHCVFPImages.plate[m].date,this.currentImg.info.number=this.pushHCVFPImages.plate[m].info.number,this.currentImg.info.color=this.pushHCVFPImages.plate[m].info.color}if(5===r.type){m=this.curImgInd.snapshot;this.pushSnapshots.img[m].snsId=r.snsId,this.pushSnapshots.img[m].src=l,this.pushSnapshots.img[m].date=this.getCurrentTime(),this.pushSnapshots.img[m].info={},this.curImgInd.snapshot=(m+1)%this.pushSnapshots.img.length}else if(6===r.type){m=this.curImgInd.flash;this.pushSnapshots.flash[m].snsId=r.snsId,this.pushSnapshots.flash[m].src=l,this.pushSnapshots.flash[m].date=this.getCurrentTime(),this.pushSnapshots.flash[m].info={},this.curImgInd.flash=(m+1)%this.pushSnapshots.flash.length}}}}}catch(h){console.log("ws parse jpg with header catch except: "+h)}},refreshMjpegCanvas(e){var t=document.getElementById(0==e?"myMjpeg0":"myMjpeg1");t&&(this.streamOptions[e].mjpegCtx.mjpeg_w=0==e?this.$refs.axMain0.$el.offsetWidth:this.$refs.axMain1.$el.offsetWidth,this.streamOptions[e].mjpegCtx.mjpeg_h=0==e?this.$refs.axMain0.$el.offsetHeight:this.$refs.axMain1.$el.offsetHeight,t.setAttribute("width",this.streamOptions[e].mjpegCtx.mjpeg_w),t.setAttribute("height",this.streamOptions[e].mjpegCtx.mjpeg_h),console.log("sns["+e+"]: canvas_w="+this.streamOptions[e].mjpegCtx.mjpeg_w+",canvas_h="+this.streamOptions[e].mjpegCtx.mjpeg_h),this.streamOptions[e].mjpegCtx.isDrawImg=!1,this.streamOptions[e].mjpegCtx.timerDraw&&clearInterval(this.streamOptions[e].mjpegCtx.timerDraw),this.streamOptions[e].mjpegCtx.timerDraw=setInterval((()=>{this.streamOptions[e].mjpegCtx.isDrawImg=!0,clearInterval(this.streamOptions[e].mjpegCtx.timerDraw)}),300))},resizeCanvas(){this.refreshMjpegCanvas(0),this.refreshMjpegCanvas(1)},getObjectFitSize(e=0,t,s,i,a){let n=1,o=0,r=0,c=i,l=a,m=0,h=0,p=t,d=s,u=t/s,g=i/a;return 0===e?g>=u?(n=s/a,o=(i-t/n)/2,c=t/n,l=a):(n=t/i,r=(a-s/n)/2,c=i,l=s/n):1===e&&(g>=u?(n=t/i,h=(s-a*n)/2,d=a*n):(n=s/a,m=(t-i*n)/2,p=i*n)),{sx:o,sy:r,swidth:c,sheight:l,x:m,y:h,width:p,height:d}},getCurrentTime(){var e=new Date,t=this.zeroFill(e.getMonth()+1),s=this.zeroFill(e.getDate()),i=this.zeroFill(e.getHours()),a=this.zeroFill(e.getMinutes()),n=this.zeroFill(e.getSeconds()),o=e.getMilliseconds();o<=9?o="00"+o:o<=99&&(o="0"+o);var r=e.getFullYear()+"-"+t+"-"+s+" "+i+":"+a+":"+n+"."+o;return r},zeroFill(e){return e>=0&&e<=9?"0"+e:e},bytesToIntLittleEndian(e){for(var t=0,s=e.length-1;s>=0;s--)t+=e[s],0!=s&&(t<<=8);return t},handleViewerClose(){this.showViewer=!1},look(e){("facehuman"===this.detect_mode&&3===e.type||"hvcfp"===this.detect_mode&&4===e.type)&&(this.currentImg.snsId=e.snsId,this.currentImg.type=e.type,this.currentImg.src=e.src,this.currentImg.date=e.date,this.currentImg.info.age=e.info.age,this.currentImg.info.gender=e.info.gender,this.currentImg.info.mask=e.info.mask,this.currentImg.info.info=e.info.info,this.currentImg.info.number=e.info.number,this.currentImg.info.color=e.info.color),this.viewerImg.snsId=e.snsId,this.viewerImg.type=e.type,this.viewerImg.src=e.src,this.viewerImg.date=e.date,this.viewerImg.info.age=e.info.age,this.viewerImg.info.gender=e.info.gender,this.viewerImg.info.mask=e.info.mask,this.viewerImg.info.info=e.info.info,this.viewerImg.info.number=e.info.number,this.viewerImg.info.color=e.info.color,this.showViewer=!0}}},O=k,S=s(1001),F=(0,S.Z)(O,i,a,!1,null,"3c2f81bd",null),E=F.exports},3162:function(e,t,s){var i,a,n;(function(s,o){a=[],i=o,n="function"===typeof i?i.apply(t,a):i,void 0===n||(e.exports=n)})(0,(function(){"use strict";function t(e,t){return"undefined"==typeof t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}function i(e,t,s){var i=new XMLHttpRequest;i.open("GET",e),i.responseType="blob",i.onload=function(){c(i.response,t,s)},i.onerror=function(){console.error("could not download file")},i.send()}function a(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function n(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(i){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var o="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof s.g&&s.g.global===s.g?s.g:void 0,r=o.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),c=o.saveAs||("object"!=typeof window||window!==o?function(){}:"download"in HTMLAnchorElement.prototype&&!r?function(e,t,s){var r=o.URL||o.webkitURL,c=document.createElement("a");t=t||e.name||"download",c.download=t,c.rel="noopener","string"==typeof e?(c.href=e,c.origin===location.origin?n(c):a(c.href)?i(e,t,s):n(c,c.target="_blank")):(c.href=r.createObjectURL(e),setTimeout((function(){r.revokeObjectURL(c.href)}),4e4),setTimeout((function(){n(c)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,s,o){if(s=s||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(t(e,o),s);else if(a(e))i(e,s,o);else{var r=document.createElement("a");r.href=e,r.target="_blank",setTimeout((function(){n(r)}))}}:function(e,t,s,a){if(a=a||open("","_blank"),a&&(a.document.title=a.document.body.innerText="downloading..."),"string"==typeof e)return i(e,t,s);var n="application/octet-stream"===e.type,c=/constructor/i.test(o.HTMLElement)||o.safari,l=/CriOS\/[\d]+/.test(navigator.userAgent);if((l||n&&c||r)&&"undefined"!=typeof FileReader){var m=new FileReader;m.onloadend=function(){var e=m.result;e=l?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=e:location=e,a=null},m.readAsDataURL(e)}else{var h=o.URL||o.webkitURL,p=h.createObjectURL(e);a?a.location=p:location.href=p,a=null,setTimeout((function(){h.revokeObjectURL(p)}),4e4)}});o.saveAs=c.saveAs=c,e.exports=c}))},577:function(e){
/*!
* screenfull
* v5.2.0 - 2021-11-03
* (c) Sindre Sorhus; MIT License
*/
(function(){"use strict";var t="undefined"!==typeof window&&"undefined"!==typeof window.document?window.document:{},s=e.exports,i=function(){for(var e,s=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],i=0,a=s.length,n={};i<a;i++)if(e=s[i],e&&e[1]in t){for(i=0;i<e.length;i++)n[s[0][i]]=e[i];return n}return!1}(),a={change:i.fullscreenchange,error:i.fullscreenerror},n={request:function(e,s){return new Promise(function(a,n){var o=function(){this.off("change",o),a()}.bind(this);this.on("change",o),e=e||t.documentElement;var r=e[i.requestFullscreen](s);r instanceof Promise&&r.then(o).catch(n)}.bind(this))},exit:function(){return new Promise(function(e,s){if(this.isFullscreen){var a=function(){this.off("change",a),e()}.bind(this);this.on("change",a);var n=t[i.exitFullscreen]();n instanceof Promise&&n.then(a).catch(s)}else e()}.bind(this))},toggle:function(e,t){return this.isFullscreen?this.exit():this.request(e,t)},onchange:function(e){this.on("change",e)},onerror:function(e){this.on("error",e)},on:function(e,s){var i=a[e];i&&t.addEventListener(i,s,!1)},off:function(e,s){var i=a[e];i&&t.removeEventListener(i,s,!1)},raw:i};i?(Object.defineProperties(n,{isFullscreen:{get:function(){return Boolean(t[i.fullscreenElement])}},element:{enumerable:!0,get:function(){return t[i.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return Boolean(t[i.fullscreenEnabled])}}}),s?e.exports=n:window.screenfull=n):s?e.exports={isEnabled:!1}:window.screenfull={isEnabled:!1}})()}}]);